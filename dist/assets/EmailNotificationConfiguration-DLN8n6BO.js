import{m as X,r as o,j as e,X as q,U as Z,t as m,ap as Q,q as ee,aq as se,Y as te}from"./index-Cwl2suO6.js";import{S as O}from"./send-DQswmW6a.js";import{L as $}from"./loader-circle-Cneib8HD.js";import{C as ae}from"./circle-check-big-DqFW6Yzj.js";import{C as z}from"./circle-alert-GQfJtxRP.js";import{C as H}from"./calendar-DYUvDC7j.js";import{T as W}from"./truck-Cw5Taszc.js";import{P as V}from"./package-CP0BQ5WR.js";import{M as E}from"./mail-57hnyO2F.js";import{f as re,u as U,d as le,c as ne}from"./automationApi-BY_Gwlgx.js";import{B as C}from"./bell-BbpknVFD.js";import{P as M}from"./plus-BEp39JcG.js";import{T as F,a as L}from"./toggle-right-Dm3A5vQD.js";import{C as Y}from"./clock-BWW0STCM.js";import{S as J}from"./square-pen-BWrye9pe.js";import{T as K}from"./trash-2-CrhnqiEh.js";import{U as ie}from"./users-FL7a-Yux.js";import{G as de}from"./gift-C4Z-RcwU.js";import{Z as oe}from"./zap-C74sPpju.js";import{M as R}from"./message-square-C8OKpjAC.js";import{C as ce}from"./chevron-up-DWUFsM7p.js";import{R as me}from"./rotate-ccw-BmyrgUB0.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],ge=X("building",xe),he={userName:"John Smith",userEmail:"john.smith@example.com",companyName:"Acme Corporation",siteName:"Holiday Celebration 2026",orderNumber:"ORD-2026-001234",orderTotal:"$149.99",giftName:"Premium Wireless Headphones",trackingNumber:"1Z999AA10123456784",magicLink:"https://app.wecelebrate.com/access/abc123xyz",expiryDate:"December 31, 2026",supportEmail:"support@wecelebrate.com",logoUrl:"https://example.com/logo.png"},ue={userName:Z,userEmail:E,companyName:ge,giftName:V,trackingNumber:W,expiryDate:H};function be({template:n,onClose:j}){const[d,f]=o.useState(""),[N,S]=o.useState(he),[u,v]=o.useState(!1),[T,w]=o.useState("idle"),[k,y]=o.useState(""),l=(()=>{const i=new Set,c=/\{\{(\w+)\}\}/g;return[n.subject,n.htmlContent,n.textContent].forEach(g=>{if(g){let b;for(;(b=c.exec(g))!==null;)i.add(b[1])}}),Array.from(i)})(),A=async()=>{if(!d.trim()){m.error("Please enter a test email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)){m.error("Please enter a valid email address");return}v(!0),w("idle"),y("");try{await Q(n.id,d,N),w("success"),m.success(`Test email sent to ${d}`)}catch(c){w("error"),y(c instanceof Error?c.message:"Failed to send test email"),m.error(c instanceof Error?c.message:"Failed to send test email")}finally{v(!1)}},D=i=>{let c=i;return Object.entries(N).forEach(([g,b])=>{const p=new RegExp(`\\{\\{${g}\\}\\}`,"g");c=c.replace(p,`<span class="bg-yellow-100 px-1 font-semibold">${b}</span>`)}),c};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"w-6 h-6 text-[#D91C81]"}),"Test Email: ",n.name]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Send a test email to verify the template looks correct"})]}),e.jsx("button",{onClick:j,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Send Test Email To"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"email",value:d,onChange:i=>f(i.target.value),placeholder:"your.email@example.com",className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",onKeyDown:i=>{i.key==="Enter"&&A()}}),e.jsx("button",{onClick:A,disabled:u,className:"inline-flex items-center gap-2 bg-[#D91C81] text-white px-6 py-2.5 rounded-lg font-semibold hover:bg-[#B71569] transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-5 h-5"}),"Send Test"]})})]}),T==="success"&&e.jsxs("div",{className:"mt-3 flex items-start gap-2 bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx(ae,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Test email sent successfully!"}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["Check your inbox at ",d]})]})]}),T==="error"&&e.jsxs("div",{className:"mt-3 flex items-start gap-2 bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx(z,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"Failed to send test email"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:k})]})]})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Template Variables"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Customize the sample data that will be used in the test email"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l.map(i=>{const c=ue[i]||Z;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-gray-500"}),i]}),e.jsx("input",{type:"text",value:N[i]||"",onChange:g=>S({...N,[i]:g.target.value}),placeholder:`Enter ${i}...`,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none text-sm"})]},i)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Email Preview"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Subject Line"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm text-gray-900",dangerouslySetInnerHTML:{__html:D(n.subject)}})]}),n.emailEnabled&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Email Body"}),e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-6 max-h-96 overflow-auto",children:e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:D(n.htmlContent)}})})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"About Test Emails"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-800",children:[e.jsx("li",{children:"Test emails use sample data to show how the template will look"}),e.jsx("li",{children:"Highlighted text shows where variables are replaced"}),e.jsx("li",{children:"Test emails are sent via your configured email service (Resend)"}),e.jsx("li",{children:"Test emails don't count toward usage statistics"})]})]})]})})]}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-end",children:e.jsx("button",{onClick:j,className:"px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-100 transition-all",children:"Close"})})]})})}const G=[{value:"employee_added",label:"Employee Added",description:"Send when an employee is added to the site",icon:ie,color:"blue"},{value:"gift_selected",label:"Gift Selected",description:"Send when employee selects their gift",icon:de,color:"green"},{value:"order_placed",label:"Order Placed",description:"Send order confirmation immediately",icon:V,color:"purple"},{value:"order_shipped",label:"Order Shipped",description:"Send when order ships with tracking",icon:W,color:"orange"},{value:"order_delivered",label:"Order Delivered",description:"Send delivery confirmation",icon:V,color:"green"},{value:"selection_expiring",label:"Selection Expiring",description:"Remind employees before deadline",icon:Y,color:"yellow"},{value:"anniversary_approaching",label:"Anniversary Approaching",description:"Send before service anniversary",icon:H,color:"pink"}];function pe({siteId:n,templates:j}){const[d,f]=o.useState([]),[N,S]=o.useState(!0),[u,v]=o.useState(null),[T,w]=o.useState(!1),[k,y]=o.useState(!1),[a,l]=o.useState({name:"",description:"",trigger:"",templateId:"",enabled:!0,daysBeforeExpiry:"",daysBeforeAnniversary:""});o.useEffect(()=>{(async()=>{try{const r=await re(n);f(r)}catch{m.error("Failed to fetch automation rules")}finally{S(!1)}})()},[n]);const A=t=>G.find(r=>r.value===t),D=t=>({blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",purple:"bg-purple-100 text-purple-600",orange:"bg-orange-100 text-orange-600",yellow:"bg-yellow-100 text-yellow-600",pink:"bg-pink-100 text-pink-600"})[t]||"bg-gray-100 text-gray-600",i=async t=>{try{const r=d.find(s=>s.id===t);if(!r)return;const x=await U(t,{enabled:!r.enabled});f(d.map(s=>s.id===t?x:s)),m.success(`Rule ${x.enabled?"enabled":"disabled"} successfully`)}catch{m.error("Failed to toggle rule")}},c=async t=>{if(confirm("Are you sure you want to delete this automation rule?"))try{await le(t),f(d.filter(r=>r.id!==t)),m.success("Rule deleted successfully")}catch{m.error("Failed to delete rule")}},g=t=>{const r=j.find(x=>x.id===t);return(r==null?void 0:r.name)||"No template selected"},b=()=>{v(null),l({name:"",description:"",trigger:"",templateId:"",enabled:!0,daysBeforeExpiry:"",daysBeforeAnniversary:""}),w(!0)},p=t=>{var r,x,s,h;v(t),l({name:t.name,description:t.description,trigger:t.trigger,templateId:t.templateId,enabled:t.enabled,daysBeforeExpiry:((x=(r=t.conditions)==null?void 0:r.daysBeforeExpiry)==null?void 0:x.toString())||"",daysBeforeAnniversary:((h=(s=t.conditions)==null?void 0:s.daysBeforeAnniversary)==null?void 0:h.toString())||""}),w(!0)},B=()=>{w(!1),v(null),l({name:"",description:"",trigger:"",templateId:"",enabled:!0,daysBeforeExpiry:"",daysBeforeAnniversary:""})},I=async()=>{if(!a.name.trim()){m.error("Please enter a rule name");return}if(!a.trigger){m.error("Please select a trigger event");return}if(!a.templateId){m.error("Please select an email template");return}y(!0);try{const t={siteId:n,name:a.name.trim(),description:a.description.trim(),trigger:a.trigger,templateId:a.templateId,enabled:a.enabled},r={};if(a.trigger==="selection_expiring"&&a.daysBeforeExpiry&&(r.daysBeforeExpiry=parseInt(a.daysBeforeExpiry)),a.trigger==="anniversary_approaching"&&a.daysBeforeAnniversary&&(r.daysBeforeAnniversary=parseInt(a.daysBeforeAnniversary)),Object.keys(r).length>0&&(t.conditions=r),u){const x=await U(u.id,t);f(d.map(s=>s.id===u.id?x:s)),m.success("Automation rule updated successfully")}else{const x=await ne(t);f([...d,x]),m.success("Automation rule created successfully")}B()}catch(t){m.error(t instanceof Error?t.message:"Failed to save automation rule")}finally{y(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#D91C81] to-[#B71569] rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(C,{className:"w-7 h-7"}),"Email Automation"]}),e.jsx("p",{className:"mt-2 text-pink-100",children:"Configure when emails are automatically sent to employees"})]}),e.jsxs("button",{onClick:b,className:"inline-flex items-center gap-2 bg-white text-[#D91C81] px-4 py-2.5 rounded-lg font-semibold hover:bg-pink-50 transition-all",children:[e.jsx(M,{className:"w-5 h-5"}),"Add Rule"]})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"About Email Automation"}),e.jsx("p",{className:"text-blue-800",children:"Automation rules trigger emails based on specific events in your gifting program. Enable rules to automate your communication workflow and ensure timely notifications."})]})]})}),e.jsx("div",{className:"space-y-3",children:N?e.jsxs("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-xl p-12 text-center",children:[e.jsx($,{className:"w-16 h-16 text-gray-300 mx-auto mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-600 text-lg mb-2",children:"Loading automation rules"})]}):d.length===0?e.jsxs("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-xl p-12 text-center",children:[e.jsx(C,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg mb-2",children:"No automation rules configured"}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Add your first rule to get started"}),e.jsxs("button",{onClick:b,className:"inline-flex items-center gap-2 bg-[#D91C81] text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-[#B71569] transition-all",children:[e.jsx(M,{className:"w-5 h-5"}),"Add Rule"]})]}):d.map(t=>{var s,h;const r=A(t.trigger),x=(r==null?void 0:r.icon)||C;return e.jsx("div",{className:`bg-white border-2 rounded-xl p-6 transition-all ${t.enabled?"border-gray-200":"border-gray-200 opacity-60"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${D((r==null?void 0:r.color)||"gray")}`,children:e.jsx(x,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t.name}),t.enabled?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium px-2 py-1 bg-green-100 text-green-700 rounded",children:[e.jsx(F,{className:"w-3 h-3"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium px-2 py-1 bg-gray-100 text-gray-600 rounded",children:[e.jsx(L,{className:"w-3 h-3"}),"Inactive"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Trigger:"}),e.jsx("span",{className:"font-medium text-gray-900",children:r==null?void 0:r.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Template:"}),e.jsx("span",{className:"font-medium text-gray-900",children:g(t.templateId)})]}),((s=t.conditions)==null?void 0:s.daysBeforeExpiry)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.conditions.daysBeforeExpiry," days before"]})]}),((h=t.conditions)==null?void 0:h.daysBeforeAnniversary)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.conditions.daysBeforeAnniversary," days before"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(t.id),className:`p-2 rounded-lg transition-colors ${t.enabled?"text-green-600 hover:bg-green-50":"text-gray-400 hover:bg-gray-100"}`,title:t.enabled?"Disable rule":"Enable rule",children:t.enabled?e.jsx(F,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>p(t),className:"p-2 text-gray-600 hover:text-[#D91C81] hover:bg-pink-50 rounded-lg transition-colors",title:"Edit rule",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>c(t.id),className:"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete rule",children:e.jsx(K,{className:"w-5 h-5"})})]})]})},t.id)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-900",children:d.filter(t=>t.enabled).length}),e.jsx("p",{className:"text-sm text-green-700",children:"Active Rules"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-500 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:d.filter(t=>!t.enabled).length}),e.jsx("p",{className:"text-sm text-gray-700",children:"Inactive Rules"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:d.length}),e.jsx("p",{className:"text-sm text-blue-700",children:"Total Rules"})]})]})})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:u?"Edit Automation Rule":"Create Automation Rule"}),e.jsx("button",{onClick:B,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Rule Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>l({...a,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",placeholder:"e.g., Welcome Email on Employee Added"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:t=>l({...a,description:t.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",placeholder:"Brief description of when this rule applies..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Trigger Event *"}),e.jsxs("select",{value:a.trigger,onChange:t=>l({...a,trigger:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a trigger event..."}),G.map(t=>e.jsxs("option",{value:t.value,children:[t.label," - ",t.description]},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Email Template *"}),e.jsxs("select",{value:a.templateId,onChange:t=>l({...a,templateId:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select an email template..."}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),a.trigger==="selection_expiring"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Days Before Expiry"}),e.jsx("input",{type:"number",min:"1",value:a.daysBeforeExpiry,onChange:t=>l({...a,daysBeforeExpiry:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",placeholder:"e.g., 7"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Send email this many days before selection deadline"})]}),a.trigger==="anniversary_approaching"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Days Before Anniversary"}),e.jsx("input",{type:"number",min:"1",value:a.daysBeforeAnniversary,onChange:t=>l({...a,daysBeforeAnniversary:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",placeholder:"e.g., 30"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Send email this many days before anniversary date"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"enabled",checked:a.enabled,onChange:t=>l({...a,enabled:t.target.checked}),className:"w-4 h-4 text-[#D91C81] border-gray-300 rounded focus:ring-[#D91C81]"}),e.jsx("label",{htmlFor:"enabled",className:"text-sm font-medium text-gray-700",children:"Enable this rule immediately"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:B,disabled:k,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:I,disabled:k,className:"inline-flex items-center gap-2 px-4 py-2 bg-[#D91C81] text-white rounded-lg hover:bg-[#B71569] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:k?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):e.jsx(e.Fragment,{children:u?"Update Rule":"Create Rule"})})]})]})})]})}function $e(){const{currentSite:n}=ee(),{globalTemplates:j,siteTemplates:d,getSiteTemplatesBySite:f,addSiteTemplate:N,updateSiteTemplate:S,deleteSiteTemplate:u,resetSiteTemplateToDefault:v,refreshSiteTemplates:T,isLoadingSite:w}=se(),[k,y]=o.useState(!1),[a,l]=o.useState(null),[A,D]=o.useState(null),[i,c]=o.useState(null),[g,b]=o.useState("templates");if(o.useEffect(()=>{n&&T(n.id)},[n==null?void 0:n.id]),!n)return e.jsx("div",{className:"p-8",children:e.jsx("div",{className:"text-center text-gray-500",children:e.jsx("p",{children:"Please select a site to configure email and notification templates."})})});const p=f(n.id),B=j.filter(s=>!p.some(h=>h.globalTemplateId===s.id)),I=async s=>{await N(n.id,s),y(!1)},t=async s=>{confirm("Are you sure you want to remove this template from the site?")&&await u(s)},r=s=>{confirm("Reset this template to default settings? All customizations will be lost.")&&(v(s),m.success("Template reset to defaults"))},x=s=>{switch(s){case"transactional":return"bg-blue-100 text-blue-700";case"marketing":return"bg-purple-100 text-purple-700";case"system":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}};return e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Email & Notifications"}),e.jsxs("p",{className:"text-gray-600",children:["Manage email templates, push notifications, and SMS messages for ",e.jsx("span",{className:"font-semibold",children:n.name})]})]}),e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsxs("button",{onClick:()=>b("templates"),className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all ${g==="templates"?"bg-[#D91C81] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(E,{className:"w-5 h-5"}),"Templates"]}),e.jsxs("button",{onClick:()=>b("automation"),className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-all ${g==="automation"?"bg-[#D91C81] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(oe,{className:"w-5 h-5"}),"Automation"]})]}),g==="templates"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Active Templates"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[p.length," template",p.length!==1?"s":""," configured for this site"]})]}),e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center gap-2 bg-[#D91C81] text-white px-4 py-2 rounded-lg font-semibold hover:bg-[#B71569] transition-all",children:[e.jsx(M,{className:"w-5 h-5"}),"Add Template"]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:p.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(E,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"No templates added yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:'Click "Add Template" to get started'})]}):p.map(s=>{const h=j.find(_=>_.id===s.globalTemplateId),P=A===s.id;return e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),h&&e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${x(h.category)}`,children:h.category})]}),h&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:h.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:`w-4 h-4 ${s.emailEnabled?"text-green-600":"text-gray-400"}`}),e.jsxs("span",{className:s.emailEnabled?"text-green-600 font-medium":"text-gray-400",children:["Email ",s.emailEnabled?"ON":"OFF"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:`w-4 h-4 ${s.pushEnabled?"text-green-600":"text-gray-400"}`}),e.jsxs("span",{className:s.pushEnabled?"text-green-600 font-medium":"text-gray-400",children:["Push ",s.pushEnabled?"ON":"OFF"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:`w-4 h-4 ${s.smsEnabled?"text-green-600":"text-gray-400"}`}),e.jsxs("span",{className:s.smsEnabled?"text-green-600 font-medium":"text-gray-400",children:["SMS ",s.smsEnabled?"ON":"OFF"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:_=>S(s.id,{enabled:_.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#D91C81]"})]}),e.jsx("button",{onClick:()=>D(P?null:s.id),className:"p-2 text-gray-600 hover:text-[#D91C81] hover:bg-pink-50 rounded-lg transition-colors",children:P?e.jsx(ce,{className:"w-5 h-5"}):e.jsx(te,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>l(s),className:"p-2 text-gray-600 hover:text-[#D91C81] hover:bg-pink-50 rounded-lg transition-colors",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>r(s.id),className:"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Reset to defaults",children:e.jsx(me,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>t(s.id),className:"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>c(s),className:"p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Test Email",children:e.jsx(O,{className:"w-5 h-5"})})]})]})}),P&&e.jsx("div",{className:"px-6 pb-6 border-t border-gray-100",children:e.jsxs("div",{className:"mt-4 space-y-4",children:[s.emailEnabled&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Email Preview"]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("strong",{children:"Subject:"})," ",s.subject]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded p-3 text-sm text-gray-700 max-h-48 overflow-auto",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.htmlContent}})})]}),s.pushEnabled&&s.pushTitle&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Push Notification Preview"]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded p-3",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm mb-1",children:s.pushTitle}),e.jsx("div",{className:"text-sm text-gray-600",children:s.pushBody})]})]}),s.smsEnabled&&s.smsContent&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"SMS Preview"]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded p-3 text-sm text-gray-700",children:s.smsContent})]})]})})]},s.id)})})]}),g==="automation"&&e.jsx(pe,{siteId:n.id,templates:p}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-3xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Add Template"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Select a template to add to this site. You can customize it after adding."}),e.jsx("div",{className:"space-y-3",children:B.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"All available templates have been added to this site."})}):B.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-[#D91C81] hover:bg-pink-50 transition-all cursor-pointer",onClick:()=>I(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${x(s.category)}`,children:s.category})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),e.jsx(M,{className:"w-5 h-5 text-[#D91C81] flex-shrink-0 ml-4"})]})},s.id))}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:()=>y(!1),className:"px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all",children:"Close"})})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:["Edit Template: ",a.name]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Enabled Channels"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:a.emailEnabled,onChange:s=>l({...a,emailEnabled:s.target.checked}),className:"rounded border-gray-300 text-[#D91C81] focus:ring-[#D91C81]"}),e.jsx(E,{className:"w-4 h-4"}),"Email"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:a.pushEnabled,onChange:s=>l({...a,pushEnabled:s.target.checked}),className:"rounded border-gray-300 text-[#D91C81] focus:ring-[#D91C81]"}),e.jsx(C,{className:"w-4 h-4"}),"Push Notifications"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:a.smsEnabled,onChange:s=>l({...a,smsEnabled:s.target.checked}),className:"rounded border-gray-300 text-[#D91C81] focus:ring-[#D91C81]"}),e.jsx(R,{className:"w-4 h-4"}),"SMS"]})]})]}),a.emailEnabled&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Email Settings"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject Line"}),e.jsx("input",{type:"text",value:a.subject,onChange:s=>l({...a,subject:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HTML Content"}),e.jsx("textarea",{value:a.htmlContent,onChange:s=>l({...a,htmlContent:s.target.value}),rows:10,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none font-mono text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plain Text Content"}),e.jsx("textarea",{value:a.textContent,onChange:s=>l({...a,textContent:s.target.value}),rows:5,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]})]})]}),a.pushEnabled&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Push Notification Settings"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Push Title"}),e.jsx("input",{type:"text",value:a.pushTitle||"",onChange:s=>l({...a,pushTitle:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Push Body"}),e.jsx("textarea",{value:a.pushBody||"",onChange:s=>l({...a,pushBody:s.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]})]})]}),a.smsEnabled&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"SMS Settings"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SMS Content (160 chars recommended)"}),e.jsx("textarea",{value:a.smsContent||"",onChange:s=>l({...a,smsContent:s.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",maxLength:320}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(a.smsContent||"").length," / 320 characters"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>l(null),className:"px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-all",children:"Cancel"}),e.jsx("button",{onClick:()=>{S(a.id,a),l(null),m.success("Template updated successfully")},className:"px-6 py-2.5 bg-[#D91C81] text-white rounded-lg font-semibold hover:bg-[#B71569] transition-all",children:"Save Changes"})]})]})}),i&&e.jsx(be,{template:i,onClose:()=>c(null)})]})})}export{$e as EmailNotificationConfiguration};
