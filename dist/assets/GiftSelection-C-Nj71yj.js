import{u as V,a as X,b as q,q as Q,r,c as _,E as K,F as O,j as e,S as L,X as Y,t as N,l as S,g as Z,k as J}from"./index-Cwl2suO6.js";function ae(){const g=V(),{siteId:p}=X(),{currentSite:x}=q(),{currentSite:v}=Q(),[P,C]=r.useState(null),{t:b}=_(),[n,U]=r.useState([]),[W,z]=r.useState(null),[u,E]=r.useState([]),[k,$]=r.useState(!0),[c,G]=r.useState(""),[d,I]=r.useState("all"),[f,A]=r.useState("name"),[ee,se]=r.useState(!1),[F,y]=r.useState(null),t=K(O,v==null?void 0:v.giftSelectionConfig),B=["all",...Array.from(new Set(n.map(s=>s.category)))],H=n.length>10;r.useEffect(()=>{(async()=>{var a,l;$(!0),y(null);try{const i=sessionStorage.getItem("employee_session"),w=sessionStorage.getItem("site_id"),m=p||w||(x==null?void 0:x.id);if(!m){N.error("No site specified. Please navigate from a valid site link."),g("/access");return}if(i||S.warn("[SECURITY] Accessing gifts without session validation - Demo mode"),i&&w&&w!==m){N.error("Invalid site access. Please validate for the correct site."),g(`/access?site=${m}`);return}const j=Z(),T=J(j),R=await fetch(`${T}/public/sites/${m}/gifts`,{headers:{Authorization:`Bearer ${j.supabaseAnonKey}`,"X-Environment-ID":j.id,...i?{"X-Session-Token":i}:{}}}),o=await R.json();if(!R.ok)throw new Error(o.error||"Failed to load gifts");console.warn("[GiftSelection] Received gifts:",((a=o.gifts)==null?void 0:a.length)||0),(l=o.gifts)==null||l.forEach(h=>{console.warn(`[GiftSelection] Gift ${h.id} - imageUrl: "${h.imageUrl}", name: "${h.name}"`)}),U(o.gifts||[]),E(o.gifts||[]),z(o.site),o.gifts.length===0&&(y("No gifts have been assigned to this site yet. Please go to Admin → Site Gifts to assign gifts."),S.warn("[GiftSelection] No gifts assigned to site:",m))}catch(i){S.error("Failed to load gifts:",i),y(t.messages.error),N.error(i instanceof Error?i.message:t.messages.error)}finally{$(!1)}})()},[g,p,x,t.messages]),r.useEffect(()=>{let s=[...n];if(d!=="all"&&(s=s.filter(a=>a.category===d)),c.trim()){const a=c.toLowerCase();s=s.filter(l=>l.name.toLowerCase().includes(a)||l.description.toLowerCase().includes(a)||l.category.toLowerCase().includes(a)||l.features.some(i=>i.toLowerCase().includes(a)))}switch(f){case"name":s.sort((a,l)=>a.name.localeCompare(l.name));break;case"value-asc":s.sort((a,l)=>a.value-l.value);break;case"value-desc":s.sort((a,l)=>l.value-a.value);break}E(s)},[n,c,d,f]);const M=s=>{g(p?`../gift-detail/${s}`:`/gift-detail/${s}`)},D=()=>{G(""),I("all"),A("name")};return k?e.jsx("div",{className:"min-h-[calc(100vh-4rem)] py-12 px-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-[#D91C81] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:b("gifts.loadingGifts")})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"py-8 sm:py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-12",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-4",children:b("gifts.title")}),e.jsx("p",{className:"text-base sm:text-lg text-gray-600 max-w-2xl mx-auto",children:b("gifts.curatedSelection")})]}),(t.search.enabled||t.filters.enabled||t.sorting.enabled)&&H&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.search.enabled&&e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(L,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:c,onChange:s=>G(s.target.value),className:"w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none",placeholder:t.search.placeholder})]}),t.filters.enabled&&t.filters.categories.enabled&&e.jsx("div",{className:"lg:w-56",children:e.jsx("select",{value:d,onChange:s=>I(s.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none appearance-none bg-white",children:B.map(s=>e.jsx("option",{value:s,children:s==="all"?"All Categories":s},s))})}),t.sorting.enabled&&e.jsx("div",{className:"lg:w-52",children:e.jsxs("select",{value:f,onChange:s=>A(s.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none appearance-none bg-white",children:[e.jsx("option",{value:"name",children:"Sort: A-Z"}),e.jsx("option",{value:"value-asc",children:"Sort: Value Low-High"}),e.jsx("option",{value:"value-desc",children:"Sort: Value High-Low"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold text-gray-900",children:u.length})," of"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:n.length})," gifts"]}),(c||d!=="all"||f!=="name")&&e.jsxs("button",{onClick:D,className:"flex items-center gap-2 text-[#D91C81] hover:text-[#B71569] font-medium text-sm transition-colors",children:[e.jsx(Y,{className:"w-4 h-4"}),"Clear Filters"]})]})]}),u.length===0&&!k&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-12 text-center",children:[e.jsx(L,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Gifts Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:F||t.messages.noResults}),!F&&e.jsx("button",{onClick:D,className:"inline-flex items-center gap-2 bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Clear All Filters"})]}),u.length>0&&e.jsx("div",{className:`grid gap-4 sm:gap-6 ${t.layout.style==="grid"?`sm:grid-cols-2 ${t.layout.itemsPerRow===2?"lg:grid-cols-2":t.layout.itemsPerRow===3?"lg:grid-cols-3":t.layout.itemsPerRow===4?"lg:grid-cols-4":t.layout.itemsPerRow===5?"lg:grid-cols-5":t.layout.itemsPerRow===6?"lg:grid-cols-6":"lg:grid-cols-3"}`:t.layout.style==="list"?"grid-cols-1":"sm:grid-cols-2 lg:grid-cols-3"}`,children:u.map(s=>{const a=P===s.id,l=t.display.hoverEffect==="lift"?"hover:scale-[1.02]":t.display.hoverEffect==="zoom"?"hover:scale-[1.05]":"";return e.jsx("div",{className:`bg-white rounded-2xl overflow-hidden shadow-lg transition-all duration-300 hover:shadow-2xl ${l}`,children:e.jsxs("button",{onClick:()=>M(s.id),onMouseEnter:()=>C(s.id),onMouseLeave:()=>C(null),className:"w-full text-left focus:outline-none focus:ring-4 focus:ring-[#D91C81] focus:ring-offset-2 rounded-2xl",children:[e.jsxs("div",{className:`relative overflow-hidden bg-gray-100 ${t.display.imageAspectRatio==="1:1"?"h-64":t.display.imageAspectRatio==="4:3"?"h-48":t.display.imageAspectRatio==="16:9"?"h-40":"h-64"}`,children:[s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:`w-full h-full object-cover transition-transform duration-500 ${a&&t.display.hoverEffect==="zoom"?"scale-110":"scale-100"}`,loading:"lazy",onError:i=>{console.error(`[GiftSelection] Failed to load image for gift ${s.id}: ${s.imageUrl}`),i.currentTarget.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Crect fill="%23f3f4f6" width="400" height="300"/%3E%3Ctext fill="%239ca3af" font-family="sans-serif" font-size="18" x="50%25" y="50%25" text-anchor="middle" dominant-baseline="middle"%3ENo Image%3C/text%3E%3C/svg%3E'}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:e.jsx("span",{className:"text-gray-400 text-sm",children:"No Image Available"})}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"inline-block bg-white/90 backdrop-blur-sm text-[#D91C81] px-3 py-1 rounded-full text-xs font-semibold",children:s.category})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:s.description}),t.display.showPrices&&s.value&&e.jsxs("p",{className:"text-sm font-semibold text-gray-900 mb-2",children:["$",s.value.toFixed(2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm font-semibold ${a?"text-[#D91C81]":"text-gray-700"} transition-colors`,children:"View Details →"}),t.display.showInventory&&(s.available?e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"In Stock"}):e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Out of Stock"}))]})]})]})},s.id)})})]})})})}export{ae as GiftSelection};
