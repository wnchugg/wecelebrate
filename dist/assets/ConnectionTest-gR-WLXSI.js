import{r as h,g as f,a2 as N,j as e,a5 as v,D as y,w as r,p as i,T as k}from"./index-Cwl2suO6.js";import{S as u}from"./server-DDrEtXX0.js";import{S as w}from"./shield-D2ZDyDg1.js";import{C}from"./circle-check-big-DqFW6Yzj.js";import{C as M}from"./circle-x-CkzBQSmo.js";function S(){var m;const[t,g]=h.useState(null),[l,d]=h.useState(!1),n=f(),b=N(),j=async()=>{d(!0);const s={timestamp:new Date().toISOString(),figmaMakeConfig:{projectId:r,publicAnonKey:i.substring(0,20)+"...",url:`https://${r}.supabase.co`},currentEnvironment:n,allEnvironments:b,connectionTests:[]},o=`https://${r}.supabase.co/functions/v1/make-server-6fcaeea3/health`;try{const a=await fetch(o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});s.connectionTests.push({name:"Figma Make Project (from /utils/supabase/info.tsx)",projectId:r,url:o,status:a.status,ok:a.ok,data:a.ok?await a.json():await a.text()})}catch(a){s.connectionTests.push({name:"Figma Make Project (from /utils/supabase/info.tsx)",projectId:r,url:o,status:"error",ok:!1,error:a instanceof Error?a.message:"Unknown error"})}const x=n.supabaseUrl.match(/https:\/\/([^.]+)\.supabase\.co/),p=x?x[1]:"",c=`${n.supabaseUrl}/functions/v1/make-server-6fcaeea3/health`;try{const a=await fetch(c,{headers:{Authorization:`Bearer ${n.supabaseAnonKey}`,"Content-Type":"application/json"}});s.connectionTests.push({name:`Current Environment (${n.name})`,projectId:p,url:c,status:a.status,ok:a.ok,data:a.ok?await a.json():await a.text()})}catch(a){s.connectionTests.push({name:`Current Environment (${n.name})`,projectId:p,url:c,status:"error",ok:!1,error:a instanceof Error?a.message:"Unknown error"})}g(s),d(!1)};return e.jsx("div",{className:"p-6 max-w-6xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(u,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Backend Connection Diagnostics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Comprehensive environment and connection testing"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:j,disabled:l,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:bg-gray-300",children:[e.jsx(v,{className:`w-5 h-5 ${l?"animate-spin":""}`}),l?"Running Tests...":"Run Full Diagnostics"]})}),e.jsxs("div",{className:"mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Figma Make Configuration"]}),e.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-purple-700 font-semibold",children:"File:"}),e.jsx("code",{className:"text-purple-900",children:"/utils/supabase/info.tsx"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-purple-700 font-semibold",children:"Project ID:"}),e.jsx("code",{className:"text-purple-900 bg-white px-2 py-1 rounded",children:r})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-purple-700 font-semibold",children:"URL:"}),e.jsxs("code",{className:"text-purple-900 bg-white px-2 py-1 rounded",children:["https://",r,".supabase.co"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-purple-700 font-semibold",children:"Anon Key:"}),e.jsxs("code",{className:"text-purple-900 bg-white px-2 py-1 rounded",children:[i.substring(0,40),"..."]})]})]}),e.jsx("div",{className:"mt-3 p-3 bg-white border border-purple-300 rounded",children:e.jsxs("p",{className:"text-xs text-purple-800",children:[e.jsx("strong",{children:"⚠️ Important:"})," This is the ",e.jsx("strong",{children:"hardcoded"})," configuration in Figma Make. All backend API calls use this project by default unless overridden by the environment selector."]})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Current Selected Environment"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-700 font-semibold",children:"Name:"}),e.jsxs("span",{className:"text-blue-900",children:[n.name," (",n.id,")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-700 font-semibold",children:"URL:"}),e.jsx("code",{className:"text-blue-900 bg-white px-2 py-1 rounded font-mono text-xs",children:n.supabaseUrl})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-700 font-semibold",children:"Anon Key:"}),e.jsxs("code",{className:"text-blue-900 bg-white px-2 py-1 rounded font-mono text-xs",children:[n.supabaseAnonKey.substring(0,40),"..."]})]})]})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:"Connection Test Results"}),t.connectionTests.map((s,o)=>e.jsx("div",{className:`p-4 border rounded-lg ${s.ok?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[s.ok?e.jsx(C,{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(M,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-gray-900 mb-2",children:s.name}),e.jsxs("div",{className:"space-y-1 text-sm font-mono",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-700 font-semibold",children:"Project:"}),e.jsx("code",{className:"text-gray-900",children:s.projectId})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-700 font-semibold",children:"URL:"}),e.jsx("code",{className:"text-gray-900 text-xs break-all",children:s.url})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-gray-700 font-semibold",children:"Status:"}),e.jsx("code",{className:`${s.ok?"text-green-700":"text-red-700"} font-bold`,children:s.status})]}),s.data&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-700 font-semibold",children:"Response:"}),e.jsx("pre",{className:"mt-1 p-2 bg-white rounded text-xs overflow-auto",children:typeof s.data=="string"?s.data:JSON.stringify(s.data,null,2)})]}),s.error&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-red-700 font-semibold",children:"Error:"}),e.jsx("pre",{className:"mt-1 p-2 bg-white rounded text-xs overflow-auto text-red-900",children:s.error})]})]})]})]})},o)),e.jsxs("div",{className:"mt-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsxs("h4",{className:"font-bold text-amber-900 mb-2 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Analysis & Recommendations"]}),e.jsxs("div",{className:"space-y-2 text-sm text-amber-900",children:[t.figmaMakeConfig.projectId!==((m=t.currentEnvironment.supabaseUrl.match(/https:\/\/([^.]+)\.supabase\.co/))==null?void 0:m[1])&&e.jsxs("div",{className:"p-3 bg-white rounded border border-amber-300",children:[e.jsx("p",{className:"font-semibold mb-1",children:"⚠️ Configuration Mismatch Detected"}),e.jsxs("p",{className:"text-xs",children:["Figma Make is configured to use project ",e.jsx("code",{className:"bg-amber-100 px-1 rounded",children:t.figmaMakeConfig.projectId})," ","but your environment selector is pointing to a different project. Most API calls in the app will use the Figma Make project (",t.figmaMakeConfig.projectId,"), not the environment selector project."]})]}),!t.connectionTests[0].ok&&e.jsxs("div",{className:"p-3 bg-white rounded border border-red-300",children:[e.jsx("p",{className:"font-semibold mb-1 text-red-900",children:"❌ Figma Make Project Not Connected"}),e.jsxs("p",{className:"text-xs text-red-800",children:["Deploy the Edge Function to project ",e.jsx("code",{className:"bg-red-100 px-1 rounded",children:t.figmaMakeConfig.projectId}),":"]}),e.jsxs("pre",{className:"mt-2 p-2 bg-gray-900 text-gray-100 rounded text-xs overflow-auto",children:["cd ~/JALA2-backend-dev && supabase functions deploy make-server-6fcaeea3 --project-ref ",t.figmaMakeConfig.projectId]})]}),t.connectionTests[0].ok&&e.jsxs("div",{className:"p-3 bg-white rounded border border-green-300",children:[e.jsx("p",{className:"font-semibold mb-1 text-green-900",children:"✅ Figma Make Project Connected"}),e.jsxs("p",{className:"text-xs text-green-800",children:["The Edge Function is deployed and responding on project ",t.figmaMakeConfig.projectId,"."]})]})]})]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-gray-700 hover:text-gray-900",children:"Show Full Diagnostic Data (JSON)"}),e.jsx("pre",{className:"mt-2 p-4 bg-gray-900 text-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(t,null,2)})]})]}),!t&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(u,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:'Click "Run Full Diagnostics" to test backend connections'})]})]})})}export{S as ConnectionTest,S as default};
