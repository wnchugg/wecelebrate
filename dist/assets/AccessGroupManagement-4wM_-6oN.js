import{a1 as O,r as n,j as e,S as W,x as J,w as x,p as f,t as y}from"./index-DHDOl0g2.js";import{P as K}from"./plus-Du5_lMGy.js";import{C as V}from"./circle-alert-HchCeVzY.js";import{E as k}from"./eye-11lXgXQ8.js";import{C as m}from"./circle-check-big-BYmGA9PQ.js";import{L as G}from"./loader-circle-CxhB-7Ws.js";import{C as T}from"./circle-x-DNt9TFja.js";import{P as _}from"./pen-BIu3415J.js";import{T as Q}from"./trash-2-c4zWA-a_.js";import{U as Y}from"./users-BUFq8hEm.js";function oe(){const{adminUser:j,accessToken:d}=O(),[v,I]=n.useState(""),[N,P]=n.useState("all"),[w,$]=n.useState("all"),[F,u]=n.useState(!1),[i,h]=n.useState(null),[C,S]=n.useState(!0),[l,g]=n.useState(!1),[p,L]=n.useState([]),[B,X]=n.useState([]),[E,o]=n.useState(null),[r,c]=n.useState({name:"",description:"",type:"custom",clientId:"",permissions:[],isActive:!0});n.useEffect(()=>{i&&c({name:i.name,description:i.description,type:i.type,clientId:i.clientId||"",permissions:i.permissions||[],isActive:i.isActive})},[i]);const M=async()=>{try{const s=await fetch(`https://${x}.supabase.co/functions/v1/make-server-6fcaeea3/permissions`,{headers:{Authorization:`Bearer ${f}`,"X-Access-Token":d||"","X-Environment-ID":"development"}});if(!s.ok){const a=await s.json().catch(()=>({error:"Unknown error"}));throw new Error(a.error||"Failed to fetch permissions")}const t=await s.json();X(t.permissions||[])}catch(s){console.error("Error fetching permissions:",s),o(s.message)}},A=async()=>{S(!0),o(null);try{const s=await fetch(`https://${x}.supabase.co/functions/v1/make-server-6fcaeea3/access-groups`,{headers:{Authorization:`Bearer ${f}`,"X-Access-Token":d||"","X-Environment-ID":"development"}});if(!s.ok){const a=await s.json().catch(()=>({error:"Unknown error"}));throw new Error(a.error||"Failed to fetch access groups")}const t=await s.json();L(t.accessGroups||[])}catch(s){console.error("Error fetching access groups:",s),o(s.message)}finally{S(!1)}};n.useEffect(()=>{d&&(M(),A())},[d]);const z=async()=>{if(!r.name||!r.type){alert("Please fill in all required fields");return}if(r.type==="custom"&&!r.clientId){alert("Custom access groups must have a client ID");return}g(!0),o(null);try{const s=i?`https://${x}.supabase.co/functions/v1/make-server-6fcaeea3/access-groups/${i.id}`:`https://${x}.supabase.co/functions/v1/make-server-6fcaeea3/access-groups`,t=i?"PUT":"POST",a={name:r.name,description:r.description,type:r.type,clientId:r.type==="custom"?r.clientId:null,permissions:r.permissions,isActive:r.isActive},b=await fetch(s,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`,"X-Access-Token":d||"","X-Environment-ID":"development"},body:JSON.stringify(a)});if(!b.ok){const H=await b.json();throw new Error(H.error||`Failed to ${i?"update":"create"} access group`)}y.success(`Access group ${i?"updated":"created"} successfully!`),u(!1),h(null),c({name:"",description:"",type:"custom",clientId:"",permissions:[],isActive:!0}),await A()}catch(s){console.error("Error saving access group:",s),o(s.message),y.error(`Error: ${s.message}`)}finally{g(!1)}},R=async s=>{if(confirm(`Are you sure you want to delete the access group "${s.name}"? This action cannot be undone.`)){g(!0),o(null);try{const t=await fetch(`https://${x}.supabase.co/functions/v1/make-server-6fcaeea3/access-groups/${s.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${f}`,"X-Access-Token":d||"","X-Environment-ID":"development"}});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to delete access group")}y.success("Access group deleted successfully!"),await A()}catch(t){console.error("Error deleting access group:",t),o(t.message),y.error(`Error: ${t.message}`)}finally{g(!1)}}},U=s=>{c(t=>({...t,permissions:t.permissions.includes(s)?t.permissions.filter(a=>a!==s):[...t.permissions,s]}))},D=p.filter(s=>{const t=s.name.toLowerCase().includes(v.toLowerCase())||s.description.toLowerCase().includes(v.toLowerCase()),a=N==="all"||s.type===N,b=w==="all"||(w==="active"?s.isActive:!s.isActive);return t&&a&&b}),q=B.reduce((s,t)=>(s[t.category]||(s[t.category]=[]),s[t.category].push(t),s),{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Access Group Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Define what components and resources users can see"})]}),e.jsxs("button",{onClick:()=>u(!0),disabled:l,className:"inline-flex items-center gap-2 bg-[#D91C81] text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-[#B71569] transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"w-5 h-5"}),"Add Access Group"]})]}),E&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(V,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-orange-900",children:"Error"}),e.jsx("p",{className:"text-orange-800 text-sm",children:E})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 rounded-xl p-6 border border-cyan-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"w-6 h-6 text-cyan-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-2",children:"Understanding Access Groups"}),e.jsxs("p",{className:"text-gray-700 mb-3",children:[e.jsx("strong",{children:"Access Groups define WHAT users can SEE"})," - which components and resources are visible to them."]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Predefined Groups:"}),' System-wide groups like "Peer", "Manager", "HR Admin" that apply across all clients']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Custom Groups:"})," Client-specific groups tailored to unique visibility needs"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Multiple Groups:"}),' Employees can belong to multiple access groups (e.g., "Peer" + "Manager")']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Example:"}),` A manager may have access to the "Gift Redemption Report" component, but their role determines if they see all data or just their team's data`]})]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search access groups...",value:v,onChange:s=>I(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]}),e.jsxs("select",{value:N,onChange:s=>P(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"predefined",children:"Predefined Groups"}),e.jsx("option",{value:"custom",children:"Custom Groups"})]}),e.jsxs("select",{value:w,onChange:s=>$(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Access Groups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Active Groups"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:p.filter(s=>s.isActive).length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Predefined Groups"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:p.filter(s=>s.type==="predefined").length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custom Groups"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:p.filter(s=>s.type==="custom").length})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:C?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(G,{className:"w-8 h-8 text-[#D91C81] animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading access groups..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Group Name"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Permissions"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:D.map(s=>{var t,a;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold ${s.type==="predefined"?"bg-purple-100 text-purple-800 border border-purple-200":"bg-blue-100 text-blue-800 border border-blue-200"}`,children:[s.type==="predefined"?e.jsx(k,{className:"w-3 h-3"}):e.jsx(J,{className:"w-3 h-3"}),s.type==="predefined"?"Predefined":"Custom"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-sm text-gray-900",children:[((t=s.permissions)==null?void 0:t.length)||0," permission",((a=s.permissions)==null?void 0:a.length)!==1?"s":""]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold ${s.isActive?"bg-green-100 text-green-800 border border-green-200":"bg-gray-100 text-gray-800 border border-gray-200"}`,children:[s.isActive?e.jsx(m,{className:"w-3 h-3"}):e.jsx(T,{className:"w-3 h-3"}),s.isActive?"Active":"Inactive"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>h(s),disabled:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Edit Access Group",children:e.jsx(_,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>R(s),disabled:l,className:"p-2 hover:bg-red-50 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Access Group",children:e.jsx(Q,{className:"w-4 h-4 text-red-600"})})]})})]},s.id)})})]})}),D.length===0&&!C&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No access groups found matching your filters."})]})]})}),(F||i)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:i?"Edit Access Group":"Add New Access Group"}),e.jsx("button",{onClick:()=>{u(!1),h(null),c({name:"",description:"",type:"custom",clientId:"",permissions:[],isActive:!0})},disabled:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(T,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-cyan-600"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Group Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>c({...r,name:s.target.value}),placeholder:"e.g., Peer, Manager, HR Admin",disabled:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none disabled:opacity-50 disabled:cursor-not-allowed",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:r.type,onChange:s=>c({...r,type:s.target.value}),disabled:l||(i==null?void 0:i.type)==="predefined",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"custom",children:"Custom (Client-specific)"}),(j==null?void 0:j.role)==="super_admin"&&e.jsx("option",{value:"predefined",children:"Predefined (System-wide)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:s=>c({...r,description:s.target.value}),placeholder:"Describe what this access group can see...",disabled:l,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none disabled:opacity-50 disabled:cursor-not-allowed"})]}),r.type==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Client ID * (for custom groups)"}),e.jsx("input",{type:"text",value:r.clientId,onChange:s=>c({...r,clientId:s.target.value}),placeholder:"Enter client ID",disabled:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none disabled:opacity-50 disabled:cursor-not-allowed",required:!0})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:r.isActive,onChange:s=>c({...r,isActive:s.target.checked}),disabled:l,className:"w-4 h-4 text-[#D91C81] border-gray-300 rounded focus:ring-pink-100 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-900 cursor-pointer",children:"Active (group can be assigned to employees)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-green-600"}),"Component Visibility Permissions (",r.permissions.length," selected)"]}),e.jsx("div",{className:"bg-cyan-50 border border-cyan-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-cyan-900",children:[e.jsx("strong",{children:"Select permissions"})," that define which components and resources users in this group can see. Within those components, their assigned Roles determine what actions they can perform."]})}),Object.entries(q).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 capitalize",children:[s," Permissions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.map(a=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:`ag-${a.id}`,checked:r.permissions.includes(a.id),onChange:()=>U(a.id),disabled:l,className:"mt-1 w-4 h-4 text-[#D91C81] border-gray-300 rounded focus:ring-pink-100 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:`ag-${a.id}`,className:"block text-sm font-medium text-gray-900 cursor-pointer",children:a.description}),e.jsxs("p",{className:"text-xs text-gray-600",children:[a.resource,".",a.action]})]})]},a.id))})]},s))]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>{u(!1),h(null),c({name:"",description:"",type:"custom",clientId:"",permissions:[],isActive:!0})},disabled:l,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-100 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsxs("button",{onClick:z,disabled:l,className:"px-4 py-2 bg-[#D91C81] text-white rounded-lg font-semibold hover:bg-[#B71569] transition-all disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",children:[l&&e.jsx(G,{className:"w-4 h-4 animate-spin"}),i?"Save Changes":"Create Access Group"]})]})]})})]})}export{oe as AccessGroupManagement};
