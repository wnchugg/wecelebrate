import{m as ie,c as re,r as j,j as e,C as M,u as oe,a3 as ce,a6 as R,B as Q,G as Y,S as de,w as me,af as he,p as ue}from"./index-dV4Uttrq.js";import{s as y,a as H}from"./errorHandling-CwdwM2Re.js";import{B as q}from"./badge-hStN7-Ju.js";import{D as xe,a as ge,b as pe,c as ve,d as je,e as fe}from"./dialog-BOcbCdZI.js";import{I as v}from"./input-DElxXLEL.js";import{L as h}from"./label-Cx_2PmZF.js";import{T as ye,a as Ce,b as I,c as P}from"./tabs-DGJXxrgD.js";import{S as J,a as W,b as _,c as X,d as w}from"./select-ByuNRZuq.js";import{C as K}from"./checkbox-CX3qPq1s.js";import{C as be,P as Ne}from"./phone-input-wIa6fWYU.js";import{A as Ee}from"./address-input-CbUFK62T.js";import{P as Z}from"./plus-DUZUgypq.js";import{C as we}from"./circle-check-big-BTbhA0uw.js";import{C as Se}from"./circle-x-CrdKUO8e.js";import{C as ee}from"./circle-alert-DNo9lQw-.js";import{M as Ae}from"./mail-HBGoXm34.js";import{M as Me}from"./map-pin-RXUS_5Nj.js";import{S as Te}from"./square-pen-BiMIh-Tu.js";import{T as Ie}from"./trash-2-B2VV2ZDP.js";import"./index-Bnc4558u.js";import"./index-Ttf8ZMtO.js";import"./index-C8MzEdCL.js";import"./index-DJFIPDZ_.js";import"./index-DS1l-0-y.js";import"./index-BO2tctDo.js";import"./index-faiGe14u.js";import"./index-DYppfwNE.js";import"./index-DS-6jgr9.js";import"./index-BdQq_4o_.js";import"./index-CVmMnAvo.js";import"./index-CkX5DTQg.js";import"./index-B7jEnDBu.js";import"./chevron-up-B1nidSHW.js";import"./loader-circle-BpaB5MSO.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],Ue=ie("phone",Pe);function Fe(o){if(!o||o.trim()==="")return"Phone number is required";if(!o.startsWith("+"))return"Phone number must include country code (e.g., +1)";const f=be.find(U=>o.startsWith(U.dial));if(!f)return"Invalid country code";const E=o.substring(f.dial.length).trim().replace(/\D/g,"");return E.length<7?"Phone number is too short":E.length>15?"Phone number is too long":null}function Oe({open:o,onClose:f,client:s,onSave:E}){const{t:U}=re(),[B,$]=j.useState("basic"),[l,S]=j.useState({name:"",contactEmail:"",status:"active",isActive:!0}),[g,F]=j.useState({line1:"",line2:"",line3:"",city:"",state:"",postalCode:"",country:"United States"}),[G,T]=j.useState({}),[r,A]=j.useState({}),[x,O]=j.useState({}),[D,L]=j.useState(!1);j.useEffect(()=>{if(s){const t={name:s.name,contactEmail:s.contactEmail,status:s.status,isActive:s.isActive,clientCode:s.clientCode,clientRegion:s.clientRegion,clientSourceCode:s.clientSourceCode,clientContactName:s.clientContactName,clientContactPhone:s.clientContactPhone,clientTaxId:s.clientTaxId,clientAccountManager:s.clientAccountManager,clientAccountManagerEmail:s.clientAccountManagerEmail,clientImplementationManager:s.clientImplementationManager,clientImplementationManagerEmail:s.clientImplementationManagerEmail,technologyOwner:s.technologyOwner,technologyOwnerEmail:s.technologyOwnerEmail,clientUrl:s.clientUrl,clientCustomUrl:s.clientCustomUrl,clientAllowSessionTimeoutExtend:s.clientAllowSessionTimeoutExtend,clientAuthenticationMethod:s.clientAuthenticationMethod,clientHasEmployeeData:s.clientHasEmployeeData,clientInvoiceType:s.clientInvoiceType,clientInvoiceTemplateType:s.clientInvoiceTemplateType,clientPoType:s.clientPoType,clientPoNumber:s.clientPoNumber,clientErpSystem:s.clientErpSystem,clientSso:s.clientSso};S(t),T(t),F({line1:s.clientAddressLine1||"",line2:s.clientAddressLine2||"",line3:s.clientAddressLine3||"",city:s.clientCity||"",state:s.clientCountryState||"",postalCode:s.clientPostalCode||"",country:s.clientCountry||"United States"})}else{const t={name:"",contactEmail:"",status:"active",isActive:!0};S(t),T(t),F({line1:"",line2:"",line3:"",city:"",state:"",postalCode:"",country:"United States"})}A({}),O({}),$("basic")},[s,o]);const C=(t,p)=>{switch(t){case"name":const u=ne(p,"Client name");return u.valid?void 0:u.error;case"contactEmail":const m=ne(p,"Contact email");if(!m.valid)return m.error;const n=te(p);return n.valid?void 0:n.error;case"clientContactPhone":return p&&Fe(p)||void 0;case"clientAccountManagerEmail":case"clientImplementationManagerEmail":case"technologyOwnerEmail":const a=te(p||"");return a.valid?void 0:a.error;case"clientUrl":case"clientCustomUrl":const d=De(p||"");return d.valid?void 0:d.error;default:return}},N=t=>{O({...x,[t]:!0});const p=C(t,l[t]);if(p)A({...r,[t]:p});else{const u={...r};delete u[t],A(u)}},c=(t,p)=>{if(S({...l,[t]:p}),x[t]&&r[t]&&!C(t,p)){const m={...r};delete m[t],A(m)}},V=()=>{const t={},p=C("name",l.name);p&&(t.name=p);const u=C("contactEmail",l.contactEmail);if(u&&(t.contactEmail=u),l.clientContactPhone){const m=C("clientContactPhone",l.clientContactPhone);m&&(t.clientContactPhone=m)}if(l.clientAccountManagerEmail){const m=C("clientAccountManagerEmail",l.clientAccountManagerEmail);m&&(t.clientAccountManagerEmail=m)}if(l.clientImplementationManagerEmail){const m=C("clientImplementationManagerEmail",l.clientImplementationManagerEmail);m&&(t.clientImplementationManagerEmail=m)}if(l.technologyOwnerEmail){const m=C("technologyOwnerEmail",l.technologyOwnerEmail);m&&(t.technologyOwnerEmail=m)}if(l.clientUrl){const m=C("clientUrl",l.clientUrl);m&&(t.clientUrl=m)}if(l.clientCustomUrl){const m=C("clientCustomUrl",l.clientCustomUrl);m&&(t.clientCustomUrl=m)}return A(t),Object.keys(t).length===0},k=async t=>{t.preventDefault();const p={};if(Object.keys(l).forEach(u=>{p[u]=!0}),O(p),!V()){y("Please fix the validation errors before submitting");return}L(!0);try{let u;if(s){u={},Object.keys(l).forEach(n=>{const i=l[n],a=G[n];i!==a&&(u[n]=i)});const m={line1:s.clientAddressLine1||"",line2:s.clientAddressLine2||"",line3:s.clientAddressLine3||"",city:s.clientCity||"",state:s.clientCountryState||"",postalCode:s.clientPostalCode||"",country:s.clientCountry||"United States"};JSON.stringify(g)!==JSON.stringify(m)&&(u.clientAddressLine1=g.line1,u.clientAddressLine2=g.line2,u.clientAddressLine3=g.line3,u.clientCity=g.city,u.clientCountryState=g.state,u.clientPostalCode=g.postalCode,u.clientCountry=g.country)}else u={...l,clientAddressLine1:g.line1,clientAddressLine2:g.line2,clientAddressLine3:g.line3,clientCity:g.city,clientCountryState:g.state,clientPostalCode:g.postalCode,clientCountry:g.country};E(u)}finally{L(!1)}},z=Object.keys(r).length>0;return e.jsx(xe,{open:o,onOpenChange:f,children:e.jsxs(ge,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(pe,{children:[e.jsx(ve,{children:s?"Edit Client":"Add New Client"}),e.jsx(je,{children:s?"Edit the details of this client.":"Add a new client to your system."})]}),e.jsxs("form",{onSubmit:k,className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs(ye,{value:B,onValueChange:$,className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs(Ce,{className:"w-full justify-start overflow-x-auto flex-shrink-0",children:[e.jsx(I,{value:"basic",children:"Basic Info"}),e.jsx(I,{value:"contact",children:"Contact"}),e.jsx(I,{value:"address",children:"Address"}),e.jsx(I,{value:"account",children:"Account Management"}),e.jsx(I,{value:"app",children:"App Settings"}),e.jsx(I,{value:"billing",children:"Billing & Integrations"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto py-4",children:[e.jsxs(P,{value:"basic",className:"space-y-4 mt-0",children:[e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"name",children:["Client Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(v,{id:"name",value:l.name||"",onChange:t=>c("name",t.target.value),onBlur:()=>N("name"),placeholder:"e.g., Acme Corporation",className:r.name&&x.name?"border-red-500":""}),r.name&&x.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.name})]}),e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"contactEmail",children:["Contact Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(v,{id:"contactEmail",type:"email",value:l.contactEmail||"",onChange:t=>c("contactEmail",t.target.value),onBlur:()=>N("contactEmail"),placeholder:"contact@client.com",className:r.contactEmail&&x.contactEmail?"border-red-500":""}),r.contactEmail&&x.contactEmail&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.contactEmail})]}),e.jsxs("div",{children:[e.jsxs(h,{htmlFor:"status",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(J,{value:l.status||"active",onValueChange:t=>c("status",t),children:[e.jsx(W,{id:"status",children:e.jsx(_,{placeholder:"Select status"})}),e.jsxs(X,{children:[e.jsx(w,{value:"active",children:"Active"}),e.jsx(w,{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientCode",children:"URL Slug"}),e.jsx(v,{id:"clientCode",value:l.clientCode||"",onChange:t=>c("clientCode",t.target.value),placeholder:"techcorp"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Used in URLs (e.g., /clients/techcorp). Use lowercase letters, numbers, and hyphens only."})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientRegion",children:"Client Region"}),e.jsxs(J,{value:l.clientRegion||"",onValueChange:t=>c("clientRegion",t),children:[e.jsx(W,{id:"clientRegion",children:e.jsx(_,{placeholder:"Select region"})}),e.jsxs(X,{children:[e.jsx(w,{value:"US/CA",children:"US/CA"}),e.jsx(w,{value:"EMEA",children:"EMEA"}),e.jsx(w,{value:"APAC",children:"APAC"}),e.jsx(w,{value:"LATAM",children:"LATAM"}),e.jsx(w,{value:"Global",children:"Global"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientSourceCode",children:"Client Source Code"}),e.jsx(v,{id:"clientSourceCode",value:l.clientSourceCode||"",onChange:t=>c("clientSourceCode",t.target.value),placeholder:"Source code"})]})]}),e.jsxs(P,{value:"contact",className:"space-y-4 mt-0",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientContactName",children:"Contact Name"}),e.jsx(v,{id:"clientContactName",value:l.clientContactName||"",onChange:t=>c("clientContactName",t.target.value),placeholder:"Primary contact person"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientContactPhone",children:"Contact Phone"}),e.jsx(Ne,{id:"clientContactPhone",value:l.clientContactPhone||"",onChange:t=>c("clientContactPhone",t),onBlur:()=>N("clientContactPhone"),defaultCountry:"US",placeholder:U("form.enterPhone"),error:!!(r.clientContactPhone&&x.clientContactPhone)}),r.clientContactPhone&&x.clientContactPhone&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.clientContactPhone})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientTaxId",children:"Tax ID"}),e.jsx(v,{id:"clientTaxId",value:l.clientTaxId||"",onChange:t=>c("clientTaxId",t.target.value),placeholder:"Tax identification number"})]})]}),e.jsx(P,{value:"address",className:"space-y-4 mt-0",children:e.jsx(Ee,{value:g,onChange:F,defaultCountry:"US",showCountrySelector:!0})}),e.jsxs(P,{value:"account",className:"space-y-4 mt-0",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientAccountManager",children:"Account Manager"}),e.jsx(v,{id:"clientAccountManager",value:l.clientAccountManager||"",onChange:t=>c("clientAccountManager",t.target.value),placeholder:"Account manager name"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientAccountManagerEmail",children:"Account Manager Email"}),e.jsx(v,{id:"clientAccountManagerEmail",type:"email",value:l.clientAccountManagerEmail||"",onChange:t=>c("clientAccountManagerEmail",t.target.value),onBlur:()=>N("clientAccountManagerEmail"),placeholder:"am@company.com",className:r.clientAccountManagerEmail&&x.clientAccountManagerEmail?"border-red-500":""}),r.clientAccountManagerEmail&&x.clientAccountManagerEmail&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.clientAccountManagerEmail})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientImplementationManager",children:"Implementation Manager"}),e.jsx(v,{id:"clientImplementationManager",value:l.clientImplementationManager||"",onChange:t=>c("clientImplementationManager",t.target.value),placeholder:"Implementation manager name"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientImplementationManagerEmail",children:"Implementation Manager Email"}),e.jsx(v,{id:"clientImplementationManagerEmail",type:"email",value:l.clientImplementationManagerEmail||"",onChange:t=>c("clientImplementationManagerEmail",t.target.value),onBlur:()=>N("clientImplementationManagerEmail"),placeholder:"im@company.com",className:r.clientImplementationManagerEmail&&x.clientImplementationManagerEmail?"border-red-500":""}),r.clientImplementationManagerEmail&&x.clientImplementationManagerEmail&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.clientImplementationManagerEmail})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"technologyOwner",children:"Technology Owner"}),e.jsx(v,{id:"technologyOwner",value:l.technologyOwner||"",onChange:t=>c("technologyOwner",t.target.value),placeholder:"Technology owner name"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"technologyOwnerEmail",children:"Technology Owner Email"}),e.jsx(v,{id:"technologyOwnerEmail",type:"email",value:l.technologyOwnerEmail||"",onChange:t=>c("technologyOwnerEmail",t.target.value),onBlur:()=>N("technologyOwnerEmail"),placeholder:"tech@company.com",className:r.technologyOwnerEmail&&x.technologyOwnerEmail?"border-red-500":""}),r.technologyOwnerEmail&&x.technologyOwnerEmail&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.technologyOwnerEmail})]})]}),e.jsxs(P,{value:"app",className:"space-y-4 mt-0",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientUrl",children:"Client URL"}),e.jsx(v,{id:"clientUrl",value:l.clientUrl||"",onChange:t=>c("clientUrl",t.target.value),onBlur:()=>N("clientUrl"),placeholder:"https://client.example.com",className:r.clientUrl&&x.clientUrl?"border-red-500":""}),r.clientUrl&&x.clientUrl&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.clientUrl})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientCustomUrl",children:"Custom URL"}),e.jsx(v,{id:"clientCustomUrl",value:l.clientCustomUrl||"",onChange:t=>c("clientCustomUrl",t.target.value),onBlur:()=>N("clientCustomUrl"),placeholder:"https://custom.client.com",className:r.clientCustomUrl&&x.clientCustomUrl?"border-red-500":""}),r.clientCustomUrl&&x.clientCustomUrl&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.clientCustomUrl})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{id:"clientAllowSessionTimeoutExtend",checked:l.clientAllowSessionTimeoutExtend||!1,onCheckedChange:t=>c("clientAllowSessionTimeoutExtend",t)}),e.jsx(h,{htmlFor:"clientAllowSessionTimeoutExtend",className:"cursor-pointer",children:"Allow Session Timeout Extension"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientAuthenticationMethod",children:"Authentication Method"}),e.jsxs(J,{value:l.clientAuthenticationMethod||"",onValueChange:t=>c("clientAuthenticationMethod",t),children:[e.jsx(W,{id:"clientAuthenticationMethod",children:e.jsx(_,{placeholder:"Select authentication method"})}),e.jsxs(X,{children:[e.jsx(w,{value:"SSO",children:"SSO"}),e.jsx(w,{value:"Basic",children:"Basic"}),e.jsx(w,{value:"OAuth",children:"OAuth"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{id:"clientHasEmployeeData",checked:l.clientHasEmployeeData||!1,onCheckedChange:t=>c("clientHasEmployeeData",t)}),e.jsx(h,{htmlFor:"clientHasEmployeeData",className:"cursor-pointer",children:"Has Employee Data"})]})]}),e.jsxs(P,{value:"billing",className:"space-y-4 mt-0",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientInvoiceType",children:"Invoice Type"}),e.jsx(v,{id:"clientInvoiceType",value:l.clientInvoiceType||"",onChange:t=>c("clientInvoiceType",t.target.value),placeholder:"Invoice type"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientInvoiceTemplateType",children:"Invoice Template Type"}),e.jsx(v,{id:"clientInvoiceTemplateType",value:l.clientInvoiceTemplateType||"",onChange:t=>c("clientInvoiceTemplateType",t.target.value),placeholder:"Template type"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientPoType",children:"PO Type"}),e.jsx(v,{id:"clientPoType",value:l.clientPoType||"",onChange:t=>c("clientPoType",t.target.value),placeholder:"Purchase order type"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientPoNumber",children:"PO Number"}),e.jsx(v,{id:"clientPoNumber",value:l.clientPoNumber||"",onChange:t=>c("clientPoNumber",t.target.value),placeholder:"Purchase order number"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientErpSystem",children:"ERP System"}),e.jsx(v,{id:"clientErpSystem",value:l.clientErpSystem||"",onChange:t=>c("clientErpSystem",t.target.value),placeholder:"e.g., NXJ, Fourgen, Netsuite, GRS"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"clientSso",children:"SSO Configuration"}),e.jsx(v,{id:"clientSso",value:l.clientSso||"",onChange:t=>c("clientSso",t.target.value),placeholder:"SSO provider"})]})]})]})]}),e.jsxs(fe,{className:"flex-shrink-0 mt-4",children:[e.jsx(M,{type:"button",variant:"outline",onClick:f,disabled:D,children:"Cancel"}),e.jsx(M,{type:"submit",className:"bg-[#D91C81] hover:bg-[#B01669] text-white",disabled:D||z,children:D?"Saving...":s?"Update Client":"Create Client"})]})]})]})})}function te(o){return!o||o.trim()===""?{valid:!0}:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?{valid:!0}:{valid:!1,error:"Please enter a valid email address"}}function pt(o){return!o||o.trim()===""?{valid:!0}:/^[\d\s\-\(\)\+]+$/.test(o)?o.replace(/\D/g,"").length<7?{valid:!1,error:"Phone number must contain at least 7 digits"}:{valid:!0}:{valid:!1,error:"Please enter a valid phone number"}}function De(o){if(!o||o.trim()==="")return{valid:!0};try{return new URL(o).protocol.startsWith("http")?{valid:!0}:{valid:!1,error:"Please enter a valid URL (must start with http:// or https://)"}}catch{return{valid:!1,error:"Please enter a valid URL (must start with http:// or https://)"}}}function ne(o,f){return!o||o.trim()===""?{valid:!1,error:`${f} is required`}:{valid:!0}}function ae(o){return`/admin/clients/${o.clientCode||o.id}`}function vt(){const o=oe(),{isAdminAuthenticated:f,isLoading:s}=ce(),[E,U]=j.useState([]),[B,$]=j.useState([]),[l,S]=j.useState(!0),[g,F]=j.useState(""),[G,T]=j.useState(!1),[r,A]=j.useState(null),[x,O]=j.useState("all"),[D,L]=j.useState(!1),[C,N]=j.useState(!1);j.useEffect(()=>{!s&&f?c():!s&&!f&&S(!1)},[f,s]);const c=async()=>{var n,i;S(!0);try{console.warn("[ClientManagement] Loading data..."),console.warn("[ClientManagement] Current environment:",localStorage.getItem("deployment_environment")||"development");const[a,d]=await Promise.all([R("/v2/clients"),R("/v2/sites")]);console.warn("[ClientManagement] Clients response:",a),console.warn("[ClientManagement] Sites response:",d),console.warn("[ClientManagement] Clients count:",((n=a.data)==null?void 0:n.length)||0),console.warn("[ClientManagement] Sites count:",((i=d.data)==null?void 0:i.length)||0),U(a.data||[]),$(d.data||[])}catch(a){console.error("[ClientManagement] Load error:",a);const d=typeof a=="object"&&a!==null&&("code"in a||"status"in a),b=d&&"code"in a?a.code:void 0,se=d&&"status"in a?a.status:void 0;if(b!==401&&se!==401)if(a instanceof TypeError&&a.message.includes("fetch"))y("Network error: Unable to connect to the server. Please check your connection and try again.");else if(a&&typeof a=="object"&&"error"in a){const le=a.error;y(le.message||"Failed to load data")}else y(a,{operation:"load data"})}finally{S(!1)}},V=n=>B.filter(i=>i.clientId===n),k=E.filter(n=>{var b;const i=n.name.toLowerCase().includes(g.toLowerCase())||((b=n.description)==null?void 0:b.toLowerCase().includes(g.toLowerCase())),a=n.status==="active"||n.status===void 0&&n.isActive;return i&&(x==="all"||x==="active"&&a||x==="inactive"&&!a)}),z=()=>{A(null),T(!0)},t=async(n,i)=>{if(V(n).length>0){y(new Error("Cannot delete client with active sites. Please delete or reassign all sites first."),{action:"delete_client",clientId:n});return}if(confirm(`Are you sure you want to delete "${i}"? This action cannot be undone.`)){L(!0);try{await R(`/v2/clients/${n}`,{method:"DELETE"}),H("Client deleted successfully"),c()}catch(d){y("Failed to delete client",d instanceof Error?d.message:"Unknown error")}finally{L(!1)}}},p=async n=>{try{if(r){const i=Object.entries(n).reduce((a,[d,b])=>(b!=null&&(a[d]=b),a),{});await R(`/v2/clients/${r.id}`,{method:"PUT",body:JSON.stringify(i)}),H("Client updated successfully")}else{const i=Object.entries(n).reduce((a,[d,b])=>(b!=null&&(a[d]=b),a),{});await R("/v2/clients",{method:"POST",body:JSON.stringify(i)}),H("Client created successfully")}T(!1),c()}catch(i){if(i&&typeof i=="object")if("error"in i&&typeof i.error=="object"&&i.error!==null){const a=i.error;let d=a.message||"An error occurred";a.field&&(d=`${a.field}: ${d}`),a.code&&console.error(`[ClientManagement] API Error Code: ${a.code}`,a.details),y(d)}else if("error"in i&&typeof i.error=="string"){const a=i,d=a.field?`${a.field}: ${a.message||a.error}`:a.message||a.error;y(d)}else"message"in i&&typeof i.message=="string"?y(r?"Failed to update client":"Failed to create client",i.message):y(r?"Failed to update client":"Failed to create client","Unknown error");else y(r?"Failed to update client":"Failed to create client",i instanceof Error?i.message:"Unknown error")}},u=n=>{o(`/admin/sites?client=${n}`)},m=async()=>{N(!0);try{const n=`https://${me}.supabase.co/functions/v1/make-server-6fcaeea3`,i=he();if(!i){y("You must be logged in to seed the database");return}const a=await fetch(`${n}/dev/reseed`,{method:"POST",headers:{"Content-Type":"application/json","X-Access-Token":i,Authorization:`Bearer ${ue}`}}),d=await a.json();a.ok?(H("Database seeded successfully! Reloading data..."),await c()):y(d.error||"Failed to seed database")}catch(n){y("Failed to seed database",n instanceof Error?n.message:"Unknown error")}finally{N(!1)}};return l?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D91C81] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading clients..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Client Management"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Manage your clients and their site configurations"})]}),e.jsxs(M,{onClick:z,className:"bg-[#D91C81] hover:bg-[#B01669] text-white w-full sm:w-auto",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Add Client"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Q,{className:"w-8 h-8 text-[#D91C81]"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Clients"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(we,{className:"w-8 h-8 text-green-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.filter(n=>n.status==="active"||n.status===void 0&&n.isActive).length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Clients"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Y,{className:"w-8 h-8 text-[#00B4CC]"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sites"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Se,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E.filter(n=>n.status==="inactive"||n.status===void 0&&!n.isActive).length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Inactive Clients"})]})]}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Search Clients"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or description...",value:g,onChange:n=>F(n.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Filter by Status"}),e.jsxs("select",{value:x,onChange:n=>O(n.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"all",children:"All Clients"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-bold text-gray-900",children:["All Clients (",k.length,")"]})}),k.length===0?e.jsx("div",{className:"text-center py-12 px-6",children:E.length===0&&!g&&x==="all"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Clients Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"It looks like your database is empty. Initialize the database with demo data to get started."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[e.jsx(M,{onClick:m,disabled:C,className:"bg-amber-500 hover:bg-amber-600 text-white",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Initializing Database..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Initialize Database with Demo Data"]})}),e.jsx("span",{className:"text-gray-400",children:"or"}),e.jsxs(M,{onClick:z,className:"bg-[#D91C81] hover:bg-[#B01669] text-white",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Add Your First Client Manually"]})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-2xl mx-auto text-left",children:[e.jsx("p",{className:"text-sm text-blue-900 font-semibold mb-2",children:"ðŸ’¡ What will happen when you initialize?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Creates 3 demo clients (Acme Corp, Global Enterprises, Tech Innovations)"}),e.jsx("li",{children:"Sets up 6 demo sites with different configurations"}),e.jsx("li",{children:"Adds sample products and gift catalogs"}),e.jsx("li",{children:"All demo data can be edited or deleted later"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No clients found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Try adjusting your filters or search query"})]})}):e.jsx("div",{className:"divide-y divide-gray-200",children:k.map(n=>{const i=V(n.id),a=i.filter(d=>d.status==="active");return e.jsxs("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-[#D91C81] rounded-lg flex items-center justify-center text-white font-bold text-lg",children:n.name.charAt(0)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(ae(n)),className:"text-lg font-bold text-gray-900 hover:text-[#D91C81] transition-colors",children:n.name}),n.status==="active"||n.status===void 0&&n.isActive?e.jsx(q,{className:"bg-green-100 text-green-800 border border-green-200",children:"Active"}):e.jsx(q,{className:"bg-gray-100 text-gray-800 border border-gray-200",children:"Inactive"})]}),n.description&&e.jsx("p",{className:"text-sm text-gray-600",children:n.description})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-6 gap-y-2 ml-15 text-sm",children:[e.jsxs("button",{onClick:()=>u(n.id),className:"flex items-center gap-2 text-[#D91C81] hover:text-[#B01669] font-medium",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:[i.length," ",i.length===1?"Site":"Sites",a.length>0&&` (${a.length} active)`]})]}),n.contactEmail&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ae,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:n.contactEmail})]}),n.contactPhone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ue,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:n.contactPhone})]}),n.address&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Me,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:n.address})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>o(ae(n)),children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>t(n.id,n.name),className:"text-red-600 hover:text-red-700 hover:bg-red-50",disabled:D,children:e.jsx(Ie,{className:"w-4 h-4"})})]})]}),i.length>0&&e.jsxs("div",{className:"mt-4 ml-15 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Sites:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.slice(0,5).map(d=>e.jsx(q,{className:d.status==="active"?"bg-blue-50 text-blue-700 border border-blue-200":"bg-gray-50 text-gray-700 border border-gray-200",children:d.name},d.id)),i.length>5&&e.jsxs(q,{className:"bg-gray-100 text-gray-600",children:["+",i.length-5," more"]})]})]})]},n.id)})})]}),e.jsx(Oe,{open:G,onClose:()=>T(!1),client:r,onSave:p})]})}export{vt as ClientManagement,te as validateEmail,pt as validatePhone,ne as validateRequired,De as validateUrl};
