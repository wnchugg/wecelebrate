import{u as E,o as A,r,t as b,j as e,L as n,B as m,A as L,g as S,p as v}from"./index-C7jV57L-.js";import{L as B}from"./loader-circle-B_Aj62vu.js";import{L as $}from"./lock-BCeGehl8.js";import{M as P}from"./map-pin-BehCdzck.js";import{U as R}from"./users-DPo0x8z0.js";import{C as z}from"./calendar-Gocszv99.js";import{E as F}from"./external-link-GR7KY2hY.js";function W(){const x=E(),[h]=A(),[i,y]=r.useState([]),[t,w]=r.useState(null),[C,l]=r.useState(!0),[g,c]=r.useState(null),o=h.get("token")||"";return r.useEffect(()=>{if(!o){b.error("Please log in to access the client portal"),x("/admin/login");return}(async()=>{var p,u;try{l(!0),c(null);const a=S(),f=await fetch(`${a.supabaseUrl}/functions/v1/make-server-6fcaeea3/clients`,{headers:{Authorization:`Bearer ${v}`,"X-Access-Token":o,"X-Environment-ID":a.id}});if(!f.ok)throw new Error("Failed to fetch client data");const j=await f.json(),d=((p=j.clients)==null?void 0:p.find(k=>k.status==="active"))||((u=j.clients)==null?void 0:u[0]);if(!d){c("No client found for your account"),l(!1);return}w(d);const N=await fetch(`${a.supabaseUrl}/functions/v1/make-server-6fcaeea3/sites?clientId=${d.id}`,{headers:{Authorization:`Bearer ${v}`,"X-Access-Token":o,"X-Environment-ID":a.id}});if(!N.ok)throw new Error("Failed to fetch sites");const D=await N.json();y(D.sites||[])}catch(a){console.error("Error fetching client data:",a),c(a.message||"Failed to load client data"),b.error("Failed to load your sites")}finally{l(!1)}})()},[h,x]),C?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"w-16 h-16 text-[#D91C81] animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading your portal..."})]})}):g&&!t?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx($,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:g}),e.jsx(n,{to:"/admin/login",className:"inline-flex items-center gap-2 px-6 py-3 bg-[#D91C81] text-white rounded-lg font-semibold hover:bg-[#B71569] transition-colors",children:"Return to Login"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-blue-50",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Client Portal"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Welcome back",t?`, ${t.name}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{to:"/admin/dashboard",className:"text-gray-600 hover:text-[#D91C81] transition-colors font-medium",children:"Admin Dashboard"}),e.jsx(n,{to:"/admin/logout",className:"px-4 py-2 text-gray-600 hover:text-[#D91C81] transition-colors font-medium",children:"Logout"})]})]})})}),t&&e.jsx("section",{className:"bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center flex-shrink-0",children:e.jsx(m,{className:"w-10 h-10 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:t.name}),t.description&&e.jsx("p",{className:"text-white/90 text-lg mb-3",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[t.contactEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-75",children:"Contact:"}),e.jsx("span",{className:"font-medium",children:t.contactEmail})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-75",children:"Sites:"}),e.jsx("span",{className:"font-medium",children:i.length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"opacity-75",children:"Status:"}),e.jsx("span",{className:"px-2 py-1 bg-white/20 rounded-full font-medium text-xs uppercase",children:t.status})]})]})]})]})})}),e.jsxs("section",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Your Sites"}),e.jsx("p",{className:"text-gray-600",children:"Manage and access all sites under your organization"})]}),i.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(m,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Sites Yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"No sites have been configured for your organization yet."}),e.jsxs(n,{to:"/admin/sites",className:"inline-flex items-center gap-2 px-6 py-3 bg-[#D91C81] text-white rounded-lg font-semibold hover:bg-[#B71569] transition-colors",children:["Manage Sites",e.jsx(L,{className:"w-5 h-5"})]})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>e.jsx(n,{to:`/site/${s.id}`,className:"group bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border-2 border-transparent hover:border-[#D91C81]",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-[#D91C81]/10 to-[#1B2A5E]/10 rounded-xl flex items-center justify-center mb-4 group-hover:from-[#D91C81]/20 group-hover:to-[#1B2A5E]/20 transition-colors",children:e.jsx(m,{className:"w-7 h-7 text-[#D91C81]"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2 group-hover:text-[#D91C81] transition-colors",children:s.name}),s.description&&e.jsx("p",{className:"text-gray-600 text-sm line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[s.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(P,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.location})]}),s.employeeCount!==void 0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(R,{className:"w-4 h-4 flex-shrink-0"}),e.jsxs("span",{children:[s.employeeCount," employees"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(z,{className:"w-4 h-4 flex-shrink-0"}),e.jsxs("span",{children:["Created ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${s.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:s.status}),e.jsx(F,{className:"w-5 h-5 text-gray-400 group-hover:text-[#D91C81] transition-colors"})]})]})},s.id))})]})]})}export{W as default};
