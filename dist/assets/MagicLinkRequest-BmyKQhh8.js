import{u as C,q as L,r as x,b as D,j as e,f as p,L as S,o as E,s as _,i as P,t as l,k as o,v as I,g as M,m as A,l as F}from"./index-o4gpx1In.js";import{c as s}from"./config-CXhgecZn.js";import{L as $}from"./Logo-DfBqhpvA.js";import{M as q}from"./mail-qbw95uc6.js";import{S as z}from"./send-wZ6pFkKn.js";import{C as B}from"./circle-check-big-b_APp8Jk.js";function X(){var g;C();const[b]=L(),[n,u]=x.useState(""),[c,i]=x.useState(!1),[j,h]=x.useState(!1),{currentSite:d}=D(),y=b.get("siteId")||s.defaultSiteId||"",k=!((g=d==null?void 0:d.settings)!=null&&g.skipLandingPage)?"/home":"/access",N=async r=>{r.preventDefault(),i(!0);const t=_(n),w=`magic_link_${t}`;if(!P(w,3,9e5).allowed){l.error("Too many magic link requests. Please try again in 15 minutes."),i(!1),o({action:"magic_link_rate_limit",status:"failure",details:{email:t}});return}if(!I(t)){l.error("Please enter a valid email address."),i(!1);return}if(s.allowedDomains&&s.allowedDomains.length>0){const a=t.split("@")[1];if(!s.allowedDomains.includes(a)){l.error(`Email must be from an authorized domain: ${s.allowedDomains.join(", ")}`),i(!1),o({action:"magic_link_unauthorized_domain",status:"failure",details:{email:t,domain:a}});return}}try{const a=M(),v=A(a),f=await fetch(`${v}/public/magic-link/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.supabaseAnonKey}`,"X-Environment-ID":a.id},body:JSON.stringify({email:t,siteId:y})}),m=await f.json();if(!f.ok||!m.success)throw new Error(m.error||"Failed to send magic link");o({action:"magic_link_sent",userId:t,status:"success",details:{email:t,messageId:m.messageId}}),i(!1),h(!0),l.success("Magic link sent! Check your email.")}catch(a){F.error("Magic link request error:",a),l.error(a.message||"Failed to send magic link. Please try again."),i(!1),o({action:"magic_link_error",status:"failure",details:{email:t,error:a.message}})}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#00E5A0] via-[#0066CC] via-[#D91C81] to-[#1B2A5E]",children:[e.jsx("header",{className:"px-4 sm:px-6 lg:px-8 py-6",role:"banner",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(p,{to:"/",className:"h-10 w-[110px] focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-transparent rounded","aria-label":"Return to homepage",children:e.jsx("div",{className:"h-10 w-[110px]",style:{filter:"brightness(0) invert(1)"},role:"img","aria-label":"HALO Logo",children:e.jsx($,{})})})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg",children:e.jsx(S,{})})]})}),e.jsx("div",{className:"flex items-center justify-center px-4 pb-12",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(p,{to:k,className:"inline-flex items-center gap-2 text-white hover:text-white/90 transition-all group focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-transparent rounded px-2 py-1",children:[e.jsx(E,{className:"w-4 h-4 transition-transform group-hover:-translate-x-1","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:"Back to Home"})]})}),e.jsx("div",{className:"bg-white rounded-3xl p-8 md:p-10",style:{boxShadow:"0 8px 32px rgba(0, 0, 0, 0.16)"},children:!c&&!j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 bg-pink-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(q,{className:"w-9 h-9 text-[#D91C81]"})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Magic Link Access"}),e.jsx("p",{className:"text-gray-600",children:"Enter your email address and we'll send you a secure link to access your gifts"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Company Email Address"}),e.jsx("input",{id:"email",type:"email",value:n,onChange:r=>u(r.target.value),placeholder:"your.name@company.com",required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:s.allowedDomains&&s.allowedDomains.length>0?`Please use an email from: ${s.allowedDomains.join(", ")}`:"Use your authorized company email address"})]}),e.jsx("button",{type:"submit",disabled:c||!n,className:"w-full bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg transition-all disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2 focus:outline-none focus:ring-4 focus:ring-[#D91C81] focus:ring-offset-2 min-h-[44px]",style:{boxShadow:"0 4px 12px rgba(217, 28, 129, 0.3)"},children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Sending..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-5 h-5","aria-hidden":"true"}),"Send Magic Link"]})})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl border border-blue-100",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{className:"font-semibold",children:"How it works:"})," We'll send you an email with a secure link. Click the link to instantly access the gift selection portal - no password needed!"]})}),s.employeeList&&s.employeeList.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-pink-50 rounded-xl border border-pink-100",children:[e.jsx("p",{className:"text-xs font-semibold text-[#D91C81] mb-2",children:"Demo Emails:"}),e.jsx("div",{className:"text-xs text-pink-700 space-y-1",children:s.employeeList.slice(0,2).map(r=>e.jsx("div",{className:"font-mono",children:r},r))})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(B,{className:"w-9 h-9 text-green-600"})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Check Your Email"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"We've sent a magic link to:"}),e.jsx("p",{className:"text-lg font-semibold text-[#D91C81] mb-4",children:n}),e.jsx("p",{className:"text-gray-600",children:"Click the link in the email to access your gift selection portal. The link will expire in 1 hour."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-amber-50 rounded-xl border border-amber-100",children:[e.jsx("p",{className:"text-sm text-amber-900",children:e.jsx("strong",{className:"font-semibold",children:"Didn't receive the email?"})}),e.jsxs("ul",{className:"text-sm text-amber-800 mt-2 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Check your spam or junk folder"}),e.jsx("li",{children:"Make sure you entered the correct email"}),e.jsx("li",{children:"Wait a few minutes - it may take time to arrive"})]})]}),e.jsx("button",{onClick:()=>{h(!1),u("")},className:"w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all",children:"Try a Different Email"}),e.jsxs("div",{className:"p-4 bg-pink-50 rounded-xl border border-pink-100",children:[e.jsx("p",{className:"text-xs font-semibold text-[#D91C81] mb-2",children:"Demo Mode - Magic Link:"}),e.jsx("a",{href:`/access/magic-link?token=${btoa(`${n}:${Date.now()}`)}`,className:"text-xs text-pink-700 font-mono break-all hover:underline",children:"Click here to access (demo)"})]})]})]})}),e.jsx("p",{className:"text-center text-white/90 text-sm mt-6",children:"Need help? Contact your administrator or HR department"})]})})]})}export{X as MagicLinkRequest};
