import{u as F,f as M,r as l,g as b,j as e,L as w,U as O,t as p,w as R,p as $,l as U}from"./index-dV4Uttrq.js";import{B as q,c as z,s as v,l as I}from"./frontendSecurity-Bm-g_cc4.js";import{D as T}from"./DeploymentEnvironmentSelector-DNvPZy3N.js";import{C as y}from"./circle-check-big-BTbhA0uw.js";import{S as N}from"./shield-C30kT5RY.js";import{M as _}from"./mail-HBGoXm34.js";import{L as C}from"./lock-BmdpVemy.js";import{C as G}from"./circle-alert-DNo9lQw-.js";import"./loader-circle-BpaB5MSO.js";import"./server-CYiQ0EKI.js";const J=d=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d);function ne(){const d=F();M();const[s,S]=l.useState({email:"",username:"",password:"",confirmPassword:"",role:"admin"}),[t,h]=l.useState({}),[f,g]=l.useState(!1),[A,k]=l.useState(!1),[Z,P]=l.useState(""),D=b(),m=a=>{const r=[];return a.length<8&&r.push("At least 8 characters"),/[A-Z]/.test(a)||r.push("One uppercase letter"),/[a-z]/.test(a)||r.push("One lowercase letter"),/[0-9]/.test(a)||r.push("One number"),/[^A-Za-z0-9]/.test(a)||r.push("One special character"),r},o=a=>{const{name:r,value:c}=a.target;S(n=>({...n,[r]:c})),h(n=>({...n,[r]:""}))},E=async a=>{a.preventDefault();const r={};J(s.email)||(r.email="Please enter a valid email address"),s.username.length<2&&(r.username="Username must be at least 2 characters");const c=m(s.password);if(c.length>0&&(r.password=`Password must have: ${c.join(", ")}`),s.password!==s.confirmPassword&&(r.confirmPassword="Passwords do not match"),Object.keys(r).length>0){h(r);return}const n=z("admin_signup",3,3600*1e3);if(!n.allowed){p.error(`Too many signup attempts. Please try again in ${n.retryAfter} seconds.`);return}g(!0);try{const i={email:v(s.email.trim().toLowerCase()),username:v(s.username.trim()),password:s.password,role:s.role},j=b().supabaseUrl.match(/https:\/\/([^.]+)\.supabase\.co/),B=`https://${j?j[1]:R}.supabase.co/functions/v1/make-server-6fcaeea3`,u=await fetch(`${B}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${$}`},body:JSON.stringify(i)});if(!u.ok){const L=await u.json().catch(()=>({error:"Signup failed"}));throw new Error(L.error||"Signup failed")}const H=await u.json();I({type:"auth_success",details:"Admin signup successful",severity:"low"}),k(!0),p.success("Account created successfully! Redirecting to login..."),setTimeout(()=>{d("/admin/login")},2e3)}catch(i){U.error("Signup error:",i);const x=i instanceof Error?i.message:"Signup failed";P(x),p.error(x)}finally{g(!1)}};return A?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#1B2A5E] via-[#D91C81] to-[#00B4CC] flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(y,{className:"w-10 h-10 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Account Created!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Redirecting to login page..."}),e.jsx("div",{className:"w-8 h-8 border-4 border-[#D91C81] border-t-transparent rounded-full animate-spin mx-auto"})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#1B2A5E] via-[#D91C81] to-[#00B4CC] flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsx(T,{}),e.jsx(q,{})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#D91C81] to-[#00B4CC] p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(N,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Create Admin Account"}),e.jsx("p",{className:"text-white/90",children:"JALA 2 Gifting Platform"})]}),e.jsxs("form",{onSubmit:E,className:"space-y-5 px-8 py-6",name:`admin-signup-${D.id}`,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"email",name:"email",type:"email",value:s.email,onChange:o,placeholder:"admin@example.com",required:!0,autoComplete:"username",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none"})]}),t.email&&e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"text-sm text-red-600",children:t.email}),t.email.includes("already registered")&&e.jsx(w,{to:"/admin/login",className:"text-xs text-[#D91C81] hover:text-[#B71569] font-medium mt-1 inline-block",children:"Go to login page →"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(O,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"username",name:"username",type:"text",value:s.username,onChange:o,placeholder:"johndoe",required:!0,autoComplete:"off",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none"})]}),t.username&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.username})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Role"}),e.jsxs("select",{id:"role",name:"role",value:s.role,onChange:o,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none bg-white",children:[e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose Super Admin for full system access"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"password",name:"password",type:"password",value:s.password,onChange:o,placeholder:"Min 8 characters",required:!0,autoComplete:"new-password",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none"})]}),t.password&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.password}),s.password&&!t.password&&e.jsx("div",{className:"mt-2 space-y-1",children:m(s.password).length===0?e.jsxs("p",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(y,{className:"w-3 h-3"}),"Strong password"]}):e.jsxs("p",{className:"text-xs text-gray-500",children:["Required: ",m(s.password).join(", ")]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",value:s.confirmPassword,onChange:o,placeholder:"Re-enter password",required:!0,autoComplete:"new-password",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none"})]}),t.confirmPassword&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.confirmPassword})]}),t.form&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:t.form})]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg transition-all disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{boxShadow:"0 4px 12px rgba(217, 28, 129, 0.3)"},children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Creating Account..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5"}),"Create Admin Account"]})})]}),e.jsx("div",{className:"px-8 pb-6",children:e.jsxs("p",{className:"text-center text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(w,{to:"/admin/login",className:"text-[#D91C81] hover:text-[#B71569] font-semibold transition-colors",children:"Sign in"})]})})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("a",{href:"/",className:"text-white hover:text-white/90 transition-all text-sm font-medium",children:"← Back to Main Site"})})]})})}export{ne as AdminSignup,ne as default};
