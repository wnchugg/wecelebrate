import{n as H,u as K,a0 as V,r as o,a3 as f,j as e,C as h,B as P,G as I,S as W,x as Z,ac as ee,p as se}from"./index-o4gpx1In.js";import{s as d,a as w}from"./errorHandling-CFBDpS8c.js";import{B as S}from"./badge-C5gk6m_5.js";import{D as te,a as ae,b as ie,c as ne,d as re,e as le}from"./dialog-DwXRAlFR.js";import{I as D}from"./input-BLpjjWZ_.js";import{L as u}from"./label-KCO8--82.js";import{T as B}from"./textarea-CVwMUQxG.js";import{S as oe}from"./switch-i8qyEA70.js";import{P as O}from"./plus-Dfsll2s7.js";import{C as ce}from"./circle-check-big-b_APp8Jk.js";import{C as de}from"./circle-x-Bc15q1z6.js";import{C as U}from"./circle-alert-Bm1NT70L.js";import{M as me}from"./mail-qbw95uc6.js";import{M as he}from"./map-pin-WnBBdTxn.js";import{S as xe}from"./square-pen-CMmyrVLY.js";import{T as ge}from"./trash-2-BSQpo9Z7.js";import"./index-B-P3gkn_.js";import"./index-D1mbWJYV.js";import"./index-DymruwlR.js";import"./index-DlWlEKMD.js";import"./index-BEf1lJlI.js";import"./index-BhKjzID4.js";import"./index-D-PWKW1S.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],pe=H("phone",ue);function Re(){const x=K(),{isAdminAuthenticated:g,isLoading:t}=V(),[m,l]=o.useState([]),[c,p]=o.useState([]),[b,y]=o.useState(!0),[r,v]=o.useState(""),[$,E]=o.useState(!1),[N,z]=o.useState(null),[j,R]=o.useState("all"),[q,T]=o.useState(!1),[M,k]=o.useState(!1);o.useEffect(()=>{!t&&g?C():!t&&!g&&y(!1)},[g,t]);const C=async()=>{var s,i;y(!0);try{console.log("[ClientManagement] Loading data..."),console.log("[ClientManagement] Current environment:",localStorage.getItem("deployment_environment")||"development");const[a,n]=await Promise.all([f("/clients"),f("/sites")]);console.log("[ClientManagement] Clients response:",a),console.log("[ClientManagement] Sites response:",n),console.log("[ClientManagement] Clients count:",((s=a.data)==null?void 0:s.length)||0),console.log("[ClientManagement] Sites count:",((i=n.data)==null?void 0:i.length)||0),l(a.data||[]),p(n.data||[])}catch(a){console.error("[ClientManagement] Load error:",a);const n=typeof a=="object"&&a!==null&&("code"in a||"status"in a),X=n&&"code"in a?a.code:void 0,Y=n&&"status"in a?a.status:void 0;X!==401&&Y!==401&&d(a,{operation:"load data"})}finally{y(!1)}},L=s=>c.filter(i=>i.clientId===s),A=m.filter(s=>{var n;const i=s.name.toLowerCase().includes(r.toLowerCase())||((n=s.description)==null?void 0:n.toLowerCase().includes(r.toLowerCase())),a=j==="all"||j==="active"&&s.isActive||j==="inactive"&&!s.isActive;return i&&a}),F=()=>{z(null),E(!0)},_=async(s,i)=>{if(L(s).length>0){d(new Error("Cannot delete client with active sites. Please delete or reassign all sites first."),{action:"delete_client",clientId:s});return}if(confirm(`Are you sure you want to delete "${i}"? This action cannot be undone.`)){T(!0);try{await f(`/clients/${s}`,{method:"DELETE"}),w("Client deleted successfully"),C()}catch(n){d("Failed to delete client",n instanceof Error?n.message:"Unknown error")}finally{T(!1)}}},G=async s=>{try{N?(await f(`/clients/${N.id}`,{method:"PUT",body:JSON.stringify(s)}),w("Client updated successfully")):(await f("/clients",{method:"POST",body:JSON.stringify(s)}),w("Client created successfully")),E(!1),C()}catch(i){d(N?"Failed to update client":"Failed to create client",i instanceof Error?i.message:"Unknown error")}},J=s=>{x(`/admin/sites?client=${s}`)},Q=async()=>{k(!0);try{const s=`https://${Z}.supabase.co/functions/v1/make-server-6fcaeea3`,i=ee();if(!i){d("You must be logged in to seed the database");return}const a=await fetch(`${s}/dev/reseed`,{method:"POST",headers:{"Content-Type":"application/json","X-Access-Token":i,Authorization:`Bearer ${se}`}}),n=await a.json();a.ok?(w("Database seeded successfully! Reloading data..."),await C()):d(n.error||"Failed to seed database")}catch(s){d("Failed to seed database",s instanceof Error?s.message:"Unknown error")}finally{k(!1)}};return b?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D91C81] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading clients..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Client Management"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Manage your clients and their site configurations"})]}),e.jsxs(h,{onClick:F,className:"bg-[#D91C81] hover:bg-[#B01669] text-white w-full sm:w-auto",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Add Client"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(P,{className:"w-8 h-8 text-[#D91C81]"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Clients"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ce,{className:"w-8 h-8 text-green-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.filter(s=>s.isActive).length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Clients"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(I,{className:"w-8 h-8 text-[#00B4CC]"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sites"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(de,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.filter(s=>!s.isActive).length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Inactive Clients"})]})]}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Search Clients"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or description...",value:r,onChange:s=>v(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Filter by Status"}),e.jsxs("select",{value:j,onChange:s=>R(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"all",children:"All Clients"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-bold text-gray-900",children:["All Clients (",A.length,")"]})}),A.length===0?e.jsx("div",{className:"text-center py-12 px-6",children:m.length===0&&!r&&j==="all"?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Clients Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"It looks like your database is empty. Initialize the database with demo data to get started."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[e.jsx(h,{onClick:Q,disabled:M,className:"bg-amber-500 hover:bg-amber-600 text-white",children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Initializing Database..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Initialize Database with Demo Data"]})}),e.jsx("span",{className:"text-gray-400",children:"or"}),e.jsxs(h,{onClick:F,className:"bg-[#D91C81] hover:bg-[#B01669] text-white",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Add Your First Client Manually"]})]}),e.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-2xl mx-auto text-left",children:[e.jsx("p",{className:"text-sm text-blue-900 font-semibold mb-2",children:"ðŸ’¡ What will happen when you initialize?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Creates 3 demo clients (Acme Corp, Global Enterprises, Tech Innovations)"}),e.jsx("li",{children:"Sets up 6 demo sites with different configurations"}),e.jsx("li",{children:"Adds sample products and gift catalogs"}),e.jsx("li",{children:"All demo data can be edited or deleted later"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No clients found"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Try adjusting your filters or search query"})]})}):e.jsx("div",{className:"divide-y divide-gray-200",children:A.map(s=>{const i=L(s.id),a=i.filter(n=>n.status==="active");return e.jsxs("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-[#D91C81] rounded-lg flex items-center justify-center text-white font-bold text-lg",children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(`/admin/clients/${s.id}`),className:"text-lg font-bold text-gray-900 hover:text-[#D91C81] transition-colors",children:s.name}),s.isActive?e.jsx(S,{className:"bg-green-100 text-green-800",children:"Active"}):e.jsx(S,{className:"bg-gray-100 text-gray-800",children:"Inactive"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-6 gap-y-2 ml-15 text-sm",children:[e.jsxs("button",{onClick:()=>J(s.id),className:"flex items-center gap-2 text-[#D91C81] hover:text-[#B01669] font-medium",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsxs("span",{children:[i.length," ",i.length===1?"Site":"Sites",a.length>0&&` (${a.length} active)`]})]}),s.contactEmail&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(me,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.contactEmail})]}),s.contactPhone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.contactPhone})]}),s.address&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.address})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>x(`/admin/clients/${s.id}`),children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>_(s.id,s.name),className:"text-red-600 hover:text-red-700 hover:bg-red-50",disabled:q,children:e.jsx(ge,{className:"w-4 h-4"})})]})]}),i.length>0&&e.jsxs("div",{className:"mt-4 ml-15 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Sites:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.slice(0,5).map(n=>e.jsx(S,{className:n.status==="active"?"bg-blue-50 text-blue-700 border border-blue-200":"bg-gray-50 text-gray-700 border border-gray-200",children:n.name},n.id)),i.length>5&&e.jsxs(S,{className:"bg-gray-100 text-gray-600",children:["+",i.length-5," more"]})]})]})]},s.id)})})]}),e.jsx(ye,{open:$,onClose:()=>E(!1),client:N,onSave:G})]})}function ye({open:x,onClose:g,client:t,onSave:m}){const[l,c]=o.useState({name:"",description:"",contactEmail:"",contactPhone:"",address:"",isActive:!0,clientCode:"",clientRegion:"",clientSourceCode:"",contactName:"",taxId:"",addressLine1:"",addressLine2:"",addressLine3:"",city:"",postalCode:"",countryState:"",country:"",accountManager:"",accountManagerEmail:"",implementationManager:"",implementationManagerEmail:"",technologyOwner:"",technologyOwnerEmail:"",clientUrl:"",allowSessionTimeoutExtend:!1,authenticationMethod:"",customUrl:"",hasEmployeeData:!1,invoiceType:"",invoiceTemplateType:"",poType:"",poNumber:"",erpSystem:"",sso:"",hrisSystem:""}),[p,b]=o.useState(!1);o.useEffect(()=>{c(t?{name:t.name,description:t.description,contactEmail:t.contactEmail,contactPhone:t.contactPhone,address:t.address,isActive:t.isActive,clientCode:t.clientCode,clientRegion:t.clientRegion,clientSourceCode:t.clientSourceCode,contactName:t.contactName,taxId:t.taxId,addressLine1:t.addressLine1,addressLine2:t.addressLine2,addressLine3:t.addressLine3,city:t.city,postalCode:t.postalCode,countryState:t.countryState,country:t.country,accountManager:t.accountManager,accountManagerEmail:t.accountManagerEmail,implementationManager:t.implementationManager,implementationManagerEmail:t.implementationManagerEmail,technologyOwner:t.technologyOwner,technologyOwnerEmail:t.technologyOwnerEmail,clientUrl:t.clientUrl,allowSessionTimeoutExtend:t.allowSessionTimeoutExtend,authenticationMethod:t.authenticationMethod,customUrl:t.customUrl,hasEmployeeData:t.hasEmployeeData,invoiceType:t.invoiceType,invoiceTemplateType:t.invoiceTemplateType,poType:t.poType,poNumber:t.poNumber,erpSystem:t.erpSystem,sso:t.sso,hrisSystem:t.hrisSystem}:{name:"",description:"",contactEmail:"",contactPhone:"",address:"",isActive:!0})},[t,x]);const y=async r=>{var v;if(r.preventDefault(),!((v=l.name)!=null&&v.trim())){d("Please enter a client name");return}b(!0);try{await m(l)}finally{b(!1)}};return e.jsx(te,{open:x,onOpenChange:g,children:e.jsxs(ae,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(ne,{children:t?"Edit Client":"Add New Client"}),e.jsx(re,{children:t?"Edit the details of this client.":"Add a new client to your system."})]}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"name",children:"Client Name *"}),e.jsx(D,{id:"name",value:l.name,onChange:r=>c({...l,name:r.target.value}),placeholder:"e.g., Acme Corporation",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(B,{id:"description",value:l.description,onChange:r=>c({...l,description:r.target.value}),placeholder:"Brief description of the client...",rows:3})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Contact Information"}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"contactEmail",children:"Email"}),e.jsx(D,{id:"contactEmail",type:"email",value:l.contactEmail,onChange:r=>c({...l,contactEmail:r.target.value}),placeholder:"contact@client.com"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"contactPhone",children:"Phone"}),e.jsx(D,{id:"contactPhone",type:"tel",value:l.contactPhone,onChange:r=>c({...l,contactPhone:r.target.value}),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"address",children:"Address"}),e.jsx(B,{id:"address",value:l.address,onChange:r=>c({...l,address:r.target.value}),placeholder:"Street address, city, state, postal code",rows:2})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"isActive",className:"font-semibold",children:"Active Status"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Enable or disable this client"})]}),e.jsx(oe,{id:"isActive",checked:l.isActive,onCheckedChange:r=>c({...l,isActive:r})})]}),e.jsxs(le,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:g,disabled:p,children:"Cancel"}),e.jsx(h,{type:"submit",className:"bg-[#D91C81] hover:bg-[#B01669] text-white",disabled:p,children:p?"Saving...":t?"Update Client":"Create Client"})]})]})]})})}export{Re as ClientManagement};
