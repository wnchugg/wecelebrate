# ðŸŽ¯ Setup Separate Dev & Production Supabase Projects

## Current Situation

- âœ… **Production**: Project `lmffeqwhrnbsbhdztwyv` already exists
- âŒ **Development**: Need to create a new project

## Why Separate Projects?

- **Safety**: Test features without affecting production data
- **Best Practice**: Industry standard separation
- **Clean Data**: Production stays clean while you experiment in dev

---

## ðŸ“‹ Step-by-Step Setup

### **Step 1: Create Development Supabase Project**

1. Go to: https://supabase.com/dashboard
2. Click **"New Project"**
3. Fill in:
   - **Name**: `JALA2-Development`
   - **Database Password**: Create strong password (SAVE THIS!)
   - **Region**: Same as production (check production project settings)
   - **Plan**: Free tier is fine
4. Click **"Create new project"**
5. â³ Wait 2-3 minutes

### **Step 2: Copy Development Credentials**

Once project is ready:

1. Go to **Settings â†’ API** in your new dev project
2. Copy and save these values:

```
Development Project Credentials:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Project URL:        https://[DEV-ID].supabase.co
Project ID (Ref):   [DEV-ID]
anon public key:    eyJhbGc... (starts with eyJ)
service_role key:   eyJhbGc... (different from anon)
Database Password:  [password you created]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**âš ï¸ SAVE THESE SOMEWHERE SAFE!**

---

## ðŸš€ Step 3: Deploy Backend to Development

### **3a. Open Terminal**

```bash
# Create folder for dev deployment
mkdir -p ~/JALA2-backend-dev/supabase/functions/make-server-6fcaeea3
cd ~/JALA2-backend-dev
```

### **3b. Link to Development Project**

```bash
supabase link --project-ref [YOUR-DEV-PROJECT-ID]
```

Replace `[YOUR-DEV-PROJECT-ID]` with your actual dev ID.

When prompted, enter your development database password.

### **3c. Copy Backend Files**

Copy these 4 files from Figma Make to your Mac:

**From Figma Make** â†’ **To Mac**
- `/supabase/functions/server/index.tsx` â†’ `supabase/functions/make-server-6fcaeea3/index.ts`
- `/supabase/functions/server/kv_store.tsx` â†’ `supabase/functions/make-server-6fcaeea3/kv_store.ts`
- `/supabase/functions/server/security.tsx` â†’ `supabase/functions/make-server-6fcaeea3/security.ts`
- `/supabase/functions/server/seed.tsx` â†’ `supabase/functions/make-server-6fcaeea3/seed.ts`

**Important**: 
- Change file extensions from `.tsx` to `.ts`
- In `index.ts`, change all imports from `.tsx` to `.ts`

#### **Quick Copy Method:**

```bash
cd ~/JALA2-backend-dev/supabase/functions/make-server-6fcaeea3

# Create index.ts
nano index.ts
```

1. Open `/supabase/functions/server/index.tsx` in Figma Make
2. Copy all content
3. Paste into Terminal
4. **IMPORTANT**: Find and replace:
   - `"./kv_store.tsx"` â†’ `"./kv_store.ts"`
   - `"./seed.tsx"` â†’ `"./seed.ts"`
   - `"./security.tsx"` â†’ `"./security.ts"`
5. Save: Ctrl+X, Y, Enter

**Repeat for other files:**

```bash
nano kv_store.ts    # Copy from kv_store.tsx
nano security.ts    # Copy from security.tsx
nano seed.ts        # Copy from seed.tsx
```

### **3d. Set Development Secrets**

```bash
cd ~/JALA2-backend-dev

# Create .env with your DEV credentials
nano .env
```

Paste this (replacing with YOUR actual dev credentials):

```
SUPABASE_URL=https://YOUR-DEV-ID.supabase.co
SUPABASE_ANON_KEY=YOUR-DEV-ANON-KEY
SUPABASE_SERVICE_ROLE_KEY=YOUR-DEV-SERVICE-ROLE-KEY
ALLOWED_ORIGINS=*
```

Save (Ctrl+X, Y, Enter), then upload:

```bash
supabase secrets set --env-file .env
```

### **3e. Deploy**

```bash
supabase functions deploy make-server-6fcaeea3
```

Wait for: `âœ“ Deployed!`

### **3f. Test**

```bash
curl https://YOUR-DEV-ID.supabase.co/functions/v1/make-server-6fcaeea3/health \
  -H "Authorization: Bearer YOUR-DEV-ANON-KEY"
```

Should return: `{"status":"ok"}` âœ…

---

## ðŸ”§ Step 4: Configure Figma Make for Development

You have two options:

### **Option A: Update Default Credentials (Recommended)**

If `/utils/supabase/info.tsx` is editable in Figma Make:

1. Open `/utils/supabase/info.tsx` in Figma Make
2. Replace with your **Development** credentials:

```typescript
/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "YOUR-DEV-PROJECT-ID"
export const publicAnonKey = "YOUR-DEV-ANON-KEY"
```

This makes Figma Make use Development by default.

### **Option B: Use Admin UI Environment Config**

Keep production as default, configure dev via Admin UI:

1. In Figma Make app, go to: `/admin/environment-config`
2. Click **"Add Environment"**
3. Fill in:
   - **ID**: `development`
   - **Name**: `Development`
   - **Supabase URL**: `https://YOUR-DEV-ID.supabase.co`
   - **Anon Key**: `YOUR-DEV-ANON-KEY`
   - **Description**: `Development environment for testing`
4. Click **"Save"**
5. Click **"Test Connection"**

Should see: âœ… "Development environment is online!"

---

## ðŸŽ¯ Step 5: Configure Production (Optional - For Later)

When you're ready to deploy to production:

### **5a. Deploy Backend to Production**

```bash
# Create separate folder for prod
mkdir -p ~/JALA2-backend-prod/supabase/functions/make-server-6fcaeea3
cd ~/JALA2-backend-prod

# Link to production project
supabase link --project-ref lmffeqwhrnbsbhdztwyv

# Copy same backend files (or reuse from dev folder)
# Set production secrets
cat > .env << 'EOF'
SUPABASE_URL=https://lmffeqwhrnbsbhdztwyv.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtZmZlcXdocm5ic2JoZHp0d3l2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzNDg1MDgsImV4cCI6MjA4NTkyNDUwOH0.QxEhaoN_sgHLxwLpgqqdhkEAHyNyi4ivFIgPhsWQ83s
SUPABASE_SERVICE_ROLE_KEY=YOUR-PROD-SERVICE-ROLE-KEY
ALLOWED_ORIGINS=https://your-production-domain.com
EOF

# Upload secrets
supabase secrets set --env-file .env

# Deploy
supabase functions deploy make-server-6fcaeea3
```

### **5b. Configure Production in Admin UI**

1. Go to: `/admin/environment-config`
2. Click **"Add Environment"** 
3. Fill in:
   - **ID**: `production`
   - **Name**: `Production`
   - **Supabase URL**: `https://lmffeqwhrnbsbhdztwyv.supabase.co`
   - **Anon Key**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
   - **Description**: `Production environment - LIVE DATA`
4. Save and test

---

## ðŸ“Š Final Setup Overview

After completing all steps:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Figma Make (Frontend)           â”‚
â”‚  - Connected to DEV by default          â”‚
â”‚  - Can switch to PROD via Admin UI      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                â”‚
           â”‚                â”‚
           â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Development    â”‚  â”‚   Production     â”‚
â”‚  [new project]   â”‚  â”‚  lmffeqwhrnb...  â”‚
â”‚                  â”‚  â”‚                  â”‚
â”‚  - Test here     â”‚  â”‚  - Live data     â”‚
â”‚  - Break things  â”‚  â”‚  - Deployed when â”‚
â”‚  - Experiment    â”‚  â”‚    ready         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Verification Checklist

After setup, verify:

- [ ] Development Supabase project created
- [ ] Development backend deployed and responding
- [ ] Figma Make connects to Development by default
- [ ] Can test creating clients/sites/gifts in dev
- [ ] Production project ready (but not actively used yet)
- [ ] Environment selector shows both Dev and Prod

---

## ðŸŽ¯ Daily Workflow

**During Development:**
1. Work in Figma Make
2. Connected to Development project
3. Create test data, break things, experiment
4. Changes only affect Development database

**When Ready to Deploy:**
1. Test thoroughly in Development
2. Switch to Production environment
3. Deploy your app
4. Production has clean, real data

---

## ðŸ†˜ Troubleshooting

### "Failed to fetch" in Figma Make

1. Check which environment is selected in Admin UI
2. Verify backend is deployed: Test health endpoint
3. Check credentials match between Admin UI and Supabase Dashboard

### "Can't connect to development"

1. Verify secrets are set: `supabase secrets list`
2. Check deployment: `supabase functions list`
3. Test health check manually with curl

### "Wrong data showing up"

1. Check environment selector in Admin UI
2. Verify `/utils/supabase/info.tsx` points to correct project
3. Check browser console for which URL is being called

---

## ðŸ“ Quick Reference

### Development Project
```
URL:      https://[YOUR-DEV-ID].supabase.co
Purpose:  Testing, development, experimentation
Status:   Active, use daily
```

### Production Project
```
URL:      https://lmffeqwhrnbsbhdztwyv.supabase.co
Purpose:  Live, production data
Status:   Reserved for production deployment
```

---

## ðŸŽ‰ Next Steps

Once development is set up:

1. **Create an admin user** in Development
2. **Test all features** without worry
3. **Build your client/site structure** 
4. **When ready**: Deploy backend to Production
5. **Switch environment** in Admin UI to Production
6. **Go live!** ðŸš€

---

**Last Updated**: 2026-02-06  
**Status**: Ready to implement  
**Estimated Time**: 30-45 minutes
