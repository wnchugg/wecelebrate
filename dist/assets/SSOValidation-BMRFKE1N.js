import{u as P,d as _,c as E,r as h,q as I,i as d,g as w,k as S,j as e,L as N,y as z,n as T}from"./index-DAep3-17.js";import{L as U}from"./Logo-Dxshdthc.js";import{S as D}from"./shield-CEczFNpG.js";import{C as F}from"./circle-alert-BJpcJige.js";function K(){var y;const A=P(),{authenticate:C}=_(),{t:x}=E(),[p,i]=h.useState(""),[f,u]=h.useState(!1),{currentSite:r,isLoading:m}=I(),b=(r==null?void 0:r.id)||"",o=((y=r==null?void 0:r.settings)==null?void 0:y.ssoProvider)||"google";h.useEffect(()=>{const t=new URLSearchParams(window.location.search),n=t.get("code"),l=t.get("state"),s=t.get("error");if(s){i("SSO authentication failed. Please try again."),d({action:"sso_authentication_failed",status:"failure",details:{error:s}});return}n&&l&&O(n,l)},[]);const O=async(t,n)=>{var l,s,v,j;try{const c=w(),L=S(c),a=await(await fetch(`${L}/public/validate/sso-callback`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.supabaseAnonKey}`,"X-Environment-ID":c.id},body:JSON.stringify({siteId:b,code:t,state:n,provider:o})})).json();a.valid&&a.sessionToken?(sessionStorage.setItem("employee_session",a.sessionToken),sessionStorage.setItem("employee_name",((l=a.employee)==null?void 0:l.name)||""),sessionStorage.setItem("employee_email",((s=a.employee)==null?void 0:s.email)||""),d({action:"sso_authentication_success",userId:(v=a.employee)==null?void 0:v.email,status:"success",details:{provider:o}}),C(((j=a.employee)==null?void 0:j.email)||""),A("/gift-selection")):(i(a.error||"Authentication failed. Please try again."),d({action:"sso_authentication_failed",status:"failure",details:{provider:o}}))}catch(c){console.error("SSO callback error:",c),i("An error occurred during authentication. Please try again."),d({action:"sso_authentication_error",status:"failure",details:{error:c.message}})}},k=async()=>{i(""),u(!0);try{const t=w(),n=S(t),s=await(await fetch(`${n}/public/validate/sso-initiate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.supabaseAnonKey}`,"X-Environment-ID":t.id},body:JSON.stringify({siteId:b,provider:o,redirectUrl:window.location.href})})).json();s.authUrl?(d({action:"sso_initiate",status:"success",details:{provider:o}}),window.location.href=s.authUrl):(i(s.error||"Failed to initiate SSO. Please try again."),u(!1))}catch(t){console.error("SSO initiation error:",t),i("Failed to connect to authentication service. Please try again."),u(!1),d({action:"sso_initiate_error",status:"failure",details:{error:t.message}})}},g=(()=>{switch(o){case"google":return{name:"Google",logo:"üîµ",description:"Sign in with your Google account"};case"microsoft":return{name:"Microsoft",logo:"‚äû",description:"Sign in with your Microsoft account"};case"okta":return{name:"Okta",logo:"üî∑",description:"Sign in with your Okta account"};case"azure":return{name:"Azure AD",logo:"‚òÅÔ∏è",description:"Sign in with your Azure Active Directory account"};default:return{name:"SSO",logo:"üîê",description:"Sign in with your corporate account"}}})();return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#00E5A0] via-[#0066CC] via-[#D91C81] to-[#1B2A5E]",children:[e.jsx("header",{className:"px-4 sm:px-6 lg:px-8 py-6",role:"banner",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(N,{to:"/",className:"h-10 w-[110px] focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-transparent rounded","aria-label":"Return to homepage",children:e.jsx("div",{className:"h-10 w-[110px]",style:{filter:"brightness(0) invert(1)"},role:"img","aria-label":"HALO Logo",children:e.jsx(U,{})})})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg",children:e.jsx(z,{})})]})}),e.jsx("div",{className:"flex items-center justify-center px-4 pb-12",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(N,{to:"/",className:"inline-flex items-center gap-2 text-white hover:text-white/90 transition-all group focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-transparent rounded px-2 py-1",children:[e.jsx(T,{className:"w-4 h-4 transition-transform group-hover:-translate-x-1","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:x("validation.backToHome")})]})}),e.jsxs("div",{className:"bg-white rounded-3xl p-8 md:p-10",style:{boxShadow:"0 8px 32px rgba(0, 0, 0, 0.16)"},children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(D,{className:"w-9 h-9 text-[#0066CC]"})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Single Sign-On"}),e.jsx("p",{className:"text-gray-600",children:"Secure authentication through your organization"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("button",{onClick:k,disabled:f||m,className:"w-full bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-800 py-4 rounded-xl font-bold text-lg hover:shadow-lg transition-all disabled:bg-gray-100 disabled:cursor-not-allowed flex items-center justify-center gap-3 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-offset-2 min-h-[44px]",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-gray-600 border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Connecting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl","aria-hidden":"true",children:g.logo}),e.jsxs("span",{children:["Continue with ",g.name]})]})}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3",role:"alert","aria-live":"polite",children:[e.jsx(F,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5","aria-hidden":"true"}),e.jsx("p",{className:"text-sm text-red-800",children:p})]})]}),!m&&r&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl border border-blue-100",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-900 mb-1",children:"Secure Authentication"}),e.jsxs("p",{className:"text-xs text-blue-700",children:[g.description,". You'll be redirected to your organization's login page."]})]}),m&&e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Loading site configuration..."})]})})]}),e.jsx("p",{className:"text-center text-white/90 text-sm mt-6",children:x("validation.needHelp")})]})})]})}export{K as SSOValidation};
