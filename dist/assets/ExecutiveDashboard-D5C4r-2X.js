import{u as Q,r as h,a6 as j,l as V,j as e,C as w,a7 as W,A as u,B as Z}from"./index-dV4Uttrq.js";import{C as c,d as o,a as f,b as v}from"./card-DtXIWsGG.js";import{B as ee}from"./badge-hStN7-Ju.js";import{s as se}from"./errorHandling-CwdwM2Re.js";import{u as te}from"./useDateFormat-DXMDXoB8.js";import{T as C}from"./trending-up-C-v-0ueb.js";import{T as D}from"./trending-down-COxjR2-c.js";import{P as ae}from"./package-x6dzX_nl.js";import{U as re}from"./users-DibFapgP.js";import{R as O,C as M,X as $,Y as U,T as z,B as ne,b as ie}from"./BarChart-BpY4eMO3.js";import{A as le}from"./AreaChart-DnrgpgHa.js";import{A as ce}from"./Area-Bcg4KGAm.js";const A={primary:"#D91C81",secondary:"#1B2A5E"};function Ne(){const p=Q(),{formatShortDate:R}=te(),[r,H]=h.useState({orders:[],clients:[],sites:[],employees:[],gifts:[],celebrations:[]}),[K,E]=h.useState(!0),[m,L]=h.useState("month");h.useEffect(()=>{k()},[]);const k=async()=>{E(!0);try{const[s,i,t,a,d,g]=await Promise.all([j("/v2/orders").catch(()=>({data:[]})),j("/v2/clients").catch(()=>({data:[]})),j("/v2/sites").catch(()=>({data:[]})),j("/v2/employees").catch(()=>({data:[]})),j("/admin/gifts").catch(()=>({data:[]})),j("/celebrations").catch(()=>({data:[]}))]);H({orders:s.data||[],clients:i.data||[],sites:t.data||[],employees:a.data||[],gifts:d.data||[],celebrations:g.data||[]})}catch(s){se("Failed to load dashboard data",s instanceof Error?s.message:"Unknown error"),V.error("Failed to load dashboard data",s)}finally{E(!1)}},l=h.useMemo(()=>{const s=new Date,i=m==="week"?7:m==="month"?30:90,t=new Date(s.getTime()-i*24*60*60*1e3),a=new Date(t.getTime()-i*24*60*60*1e3),d=r.orders.filter(n=>new Date(n.createdAt)>=t),g=r.orders.filter(n=>{const x=new Date(n.createdAt);return x>=a&&x<t}),T=d.reduce((n,x)=>n+(x.totalAmount||0),0),y=g.reduce((n,x)=>n+(x.totalAmount||0),0),B=y>0?(T-y)/y*100:0,F=g.length>0?(d.length-g.length)/g.length*100:0,Y=r.clients.filter(n=>n.status==="active").length,_=r.sites.filter(n=>n.status==="active").length,N=r.employees.filter(n=>n.status==="active").length,S=r.celebrations.filter(n=>new Date(n.date)>=t),b=r.celebrations.filter(n=>{const x=new Date(n.date);return x>=a&&x<t}),P=b.length>0?(S.length-b.length)/b.length*100:0,G=d.length>0?d.filter(n=>n.status==="delivered").length/d.length*100:0,J=N>0?new Set(d.map(n=>n.employeeEmail)).size/N*100:0;return{revenue:{current:T,change:B,trend:B>=0?"up":"down"},orders:{current:d.length,change:F,trend:F>=0?"up":"down"},celebrations:{current:S.length,change:P,trend:P>=0?"up":"down"},activeClients:Y,activeSites:_,activeEmployees:N,fulfillmentRate:G,participationRate:J}},[r,m]),I=h.useMemo(()=>{const s={},i=new Date(Date.now()-2592e6);return r.orders.filter(t=>new Date(t.createdAt)>=i).forEach(t=>{const a=R(t.createdAt);s[a]=(s[a]||0)+(t.totalAmount||0)}),Object.entries(s).map(([t,a])=>({date:t,revenue:a})).sort((t,a)=>new Date(t.date).getTime()-new Date(a.date).getTime()).slice(-14)},[r.orders,R]),q=h.useMemo(()=>{const s={};return r.orders.forEach(i=>{s[i.status]=(s[i.status]||0)+1}),Object.entries(s).map(([i,t])=>({name:i.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),value:t}))},[r.orders]),X=h.useMemo(()=>{const s={};return r.orders.forEach(i=>{const t=r.sites.find(a=>a.id===i.siteId);if(t){const a=r.clients.find(d=>d.id===t.clientId);a&&(s[a.id]||(s[a.id]={name:a.name,revenue:0,orders:0}),s[a.id].revenue+=i.totalAmount||0,s[a.id].orders+=1)}}),Object.values(s).sort((i,t)=>t.revenue-i.revenue).slice(0,5)},[r.orders,r.sites,r.clients]);return K?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D91C81] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading executive dashboard..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Executive Dashboard"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"High-level overview of platform performance"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:k,className:"gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs(w,{onClick:()=>p("/admin/reports"),className:"bg-[#D91C81] hover:bg-[#B01669] text-white gap-2",size:"sm",children:["Full Reports",e.jsx(u,{className:"w-4 h-4"})]})]})]}),e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Comparison Period:"}),e.jsx("div",{className:"flex gap-2",children:["week","month","quarter"].map(s=>e.jsx(w,{size:"sm",variant:m===s?"default":"outline",onClick:()=>L(s),className:m===s?"bg-[#D91C81] hover:bg-[#B01669]":"",children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Revenue"}),e.jsxs("div",{className:`flex items-center gap-1 text-sm ${l.revenue.trend==="up"?"text-green-600":"text-red-600"}`,children:[l.revenue.trend==="up"?e.jsx(C,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"}),Math.abs(l.revenue.change).toFixed(1),"%"]})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",l.revenue.current.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["vs previous ",m]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Orders"}),e.jsxs("div",{className:`flex items-center gap-1 text-sm ${l.orders.trend==="up"?"text-green-600":"text-red-600"}`,children:[l.orders.trend==="up"?e.jsx(C,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"}),Math.abs(l.orders.change).toFixed(1),"%"]})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.orders.current}),e.jsxs("p",{className:"text-xs text-gray-500",children:["vs previous ",m]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Celebrations"}),e.jsxs("div",{className:`flex items-center gap-1 text-sm ${l.celebrations.trend==="up"?"text-green-600":"text-red-600"}`,children:[l.celebrations.trend==="up"?e.jsx(C,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"}),Math.abs(l.celebrations.change).toFixed(1),"%"]})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.celebrations.current}),e.jsxs("p",{className:"text-xs text-gray-500",children:["vs previous ",m]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Fulfillment Rate"}),e.jsxs(ee,{className:"bg-green-100 text-green-800",children:[l.fulfillmentRate.toFixed(1),"%"]})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[l.participationRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Employee participation"})]})})})]}),e.jsxs(c,{children:[e.jsx(f,{children:e.jsx(v,{children:"Platform Health"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg",children:[e.jsx(Z,{className:"w-10 h-10 text-[#D91C81] mx-auto mb-3"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.activeClients}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Active Clients"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["of ",r.clients.length," total"]})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg",children:[e.jsx(ae,{className:"w-10 h-10 text-[#1B2A5E] mx-auto mb-3"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.activeSites}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Active Sites"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["of ",r.sites.length," total"]})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-lg",children:[e.jsx(re,{className:"w-10 h-10 text-[#00B4CC] mx-auto mb-3"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.activeEmployees}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Active Employees"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["of ",r.employees.length," total"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(f,{children:e.jsx(v,{children:"Revenue Trend (14 Days)"})}),e.jsx(o,{children:e.jsx(O,{width:"100%",height:300,children:e.jsxs(le,{data:I,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"date"}),e.jsx(U,{}),e.jsx(z,{formatter:s=>`$${s.toFixed(2)}`}),e.jsx(ce,{type:"monotone",dataKey:"revenue",stroke:A.primary,fill:A.primary,fillOpacity:.3})]})})})]}),e.jsxs(c,{children:[e.jsx(f,{children:e.jsx(v,{children:"Orders by Status"})}),e.jsx(o,{children:e.jsx(O,{width:"100%",height:300,children:e.jsxs(ne,{data:q,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80}),e.jsx(U,{}),e.jsx(z,{}),e.jsx(ie,{dataKey:"value",fill:A.secondary})]})})})]})]}),e.jsxs(c,{children:[e.jsx(f,{children:e.jsx(v,{children:"Top 5 Clients by Revenue"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:X.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-[#D91C81] text-white rounded-full flex items-center justify-center font-bold",children:i+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.orders," orders"]})]})]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["$",s.revenue.toFixed(2)]})]},i))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>p("/admin/client-analytics"),children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Client Analytics"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Detailed client insights"})]}),e.jsx(u,{className:"w-5 h-5 text-gray-400"})]})})}),e.jsx(c,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>p("/admin/celebration-analytics"),children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Celebration Analytics"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Anniversary & awards"})]}),e.jsx(u,{className:"w-5 h-5 text-gray-400"})]})})}),e.jsx(c,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>p("/admin/reports"),children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Full Reports"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Comprehensive analytics"})]}),e.jsx(u,{className:"w-5 h-5 text-gray-400"})]})})})]})]})}export{Ne as ExecutiveDashboard};
