import{m as Y,u as Z,r as c,a3 as g,l as E,j as e,C as O,n as J,B as Q}from"./index-BKvtyMRF.js";import{C as d,d as x,a as h,b as p}from"./card-KyfzLPkM.js";import{s as S,a as W}from"./errorHandling-D_CdsDrI.js";import{D as ee}from"./download-C1zwCg2A.js";import{D as te}from"./dollar-sign-DH2Vbvos.js";import{P as se}from"./package-BIaJQQZf.js";import{U as ae}from"./users-BPWS-E-S.js";import{R as u,B as A,C as B,X as P,Y as $,T as y,b as F,a as le}from"./BarChart-C_3UbhLM.js";import{P as re,a as ie}from"./PieChart-hl0BfACd.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}]],ce=Y("badge",ne),f={primary:"#D91C81",secondary:"#1B2A5E",tertiary:"#00B4CC",success:"#10B981",warning:"#F59E0B",purple:"#8B5CF6"};function ve(){const T=Z(),[i,D]=c.useState([]),[v,k]=c.useState([]),[N,L]=c.useState([]),[b,I]=c.useState([]),[M,C]=c.useState(!0),[oe,de]=c.useState(null);c.useEffect(()=>{U()},[]);const U=async()=>{C(!0);try{const[t,s,n,o]=await Promise.all([g("/clients").catch(()=>({data:[]})),g("/sites").catch(()=>({data:[]})),g("/orders").catch(()=>({data:[]})),g("/employees").catch(()=>({data:[]}))]);D(t.data||[]),k(s.data||[]),L(n.data||[]),I(o.data||[])}catch(t){S("Failed to load client analytics",t instanceof Error?t.message:"Unknown error"),E.error("Failed to load client analytics",t)}finally{C(!1)}},l=c.useMemo(()=>i.map(t=>{const s=v.filter(r=>r.clientId===t.id),n=s.filter(r=>r.status==="active"),o=s.map(r=>r.id),a=N.filter(r=>o.includes(r.siteId)),j=a.reduce((r,X)=>r+(X.totalAmount||0),0),V=a.length>0?j/a.length:0,w=b.filter(r=>r.clientId===t.id),m=w.filter(r=>r.status==="active"),q=new Set(a.map(r=>r.id)).size,G=m.length>0?q/m.length*100:0,H=m.length>0?j/m.length:0;return{clientId:t.id,clientName:t.name,totalSites:s.length,activeSites:n.length,totalEmployees:w.length,activeEmployees:m.length,totalOrders:a.length,totalRevenue:j,avgOrderValue:V,participationRate:G,costPerEmployee:H}}),[i,v,N,b]),K=c.useMemo(()=>[...l].sort((t,s)=>s.totalRevenue-t.totalRevenue).slice(0,10).map(t=>({name:t.clientName.length>20?t.clientName.substring(0,20)+"...":t.clientName,revenue:t.totalRevenue,orders:t.totalOrders})),[l]),_=c.useMemo(()=>[...l].sort((t,s)=>s.totalOrders-t.totalOrders).slice(0,10).map(t=>({name:t.clientName.length>20?t.clientName.substring(0,20)+"...":t.clientName,orders:t.totalOrders,employees:t.activeEmployees})),[l]),R=c.useMemo(()=>{const t=[{name:"0-20%",min:0,max:20,count:0},{name:"21-40%",min:21,max:40,count:0},{name:"41-60%",min:41,max:60,count:0},{name:"61-80%",min:61,max:80,count:0},{name:"81-100%",min:81,max:100,count:0}];return l.forEach(s=>{const n=t.find(o=>s.participationRate>=o.min&&s.participationRate<=o.max);n&&n.count++}),t.map((s,n)=>({name:s.name,value:s.count,fill:Object.values(f)[n]}))},[l]),z=()=>{try{const t=[["Client Performance Analytics"],[`Generated: ${new Date().toLocaleString()}`],[],["Client","Total Sites","Active Sites","Total Employees","Active Employees","Total Orders","Total Revenue","Avg Order Value","Participation Rate","Cost per Employee"],...l.map(a=>[a.clientName,a.totalSites,a.activeSites,a.totalEmployees,a.activeEmployees,a.totalOrders,`$${a.totalRevenue.toFixed(2)}`,`$${a.avgOrderValue.toFixed(2)}`,`${a.participationRate.toFixed(1)}%`,`$${a.costPerEmployee.toFixed(2)}`])].map(a=>a.join(",")).join(`
`),s=new Blob([t],{type:"text/csv"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download=`Client_Performance_${new Date().toISOString().split("T")[0]}.csv`,o.click(),URL.revokeObjectURL(n),W("Report exported successfully")}catch(t){const s=t instanceof Error?t.message:"Unknown error";S("Failed to export report",s),E.error("Failed to export report",t)}};return M?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D91C81] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading client analytics..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>T("/admin/reports"),className:"gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Client Performance Analytics"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Detailed insights by client organization"})]})]}),e.jsxs(O,{onClick:z,className:"bg-[#D91C81] hover:bg-[#B01669] text-white gap-2",size:"sm",children:[e.jsx(ee,{className:"w-4 h-4"}),"Export Report"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(d,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-[#D91C81]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.length})]})]})})}),e.jsx(d,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-[#1B2A5E]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",l.reduce((t,s)=>t+s.totalRevenue,0).toFixed(2)]})]})]})})}),e.jsx(d,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-cyan-100 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-[#00B4CC]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.reduce((t,s)=>t+s.totalOrders,0)})]})]})})}),e.jsx(d,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.reduce((t,s)=>t+s.totalEmployees,0)})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(p,{children:"Top 10 Clients by Revenue"})}),e.jsx(x,{children:e.jsx(u,{width:"100%",height:400,children:e.jsxs(A,{data:K,layout:"vertical",children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(P,{type:"number"}),e.jsx($,{dataKey:"name",type:"category",width:150}),e.jsx(y,{formatter:t=>`$${t.toFixed(2)}`}),e.jsx(F,{dataKey:"revenue",fill:f.primary})]})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(p,{children:"Top 10 Clients by Orders"})}),e.jsx(x,{children:e.jsx(u,{width:"100%",height:400,children:e.jsxs(A,{data:_,layout:"vertical",children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(P,{type:"number"}),e.jsx($,{dataKey:"name",type:"category",width:150}),e.jsx(y,{}),e.jsx(F,{dataKey:"orders",fill:f.secondary})]})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(p,{children:"Participation Rate Distribution"})}),e.jsx(x,{children:e.jsx(u,{width:"100%",height:300,children:e.jsxs(re,{children:[e.jsx(ie,{data:R,cx:"50%",cy:"50%",labelLine:!1,label:t=>`${t.name}: ${t.value}`,outerRadius:100,dataKey:"value",children:R.map((t,s)=>e.jsx(le,{fill:t.fill},`cell-${s}`))}),e.jsx(y,{})]})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(p,{children:"Client Performance Summary"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Avg Revenue per Client"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["$",i.length>0?(l.reduce((t,s)=>t+s.totalRevenue,0)/i.length).toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Avg Orders per Client"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:i.length>0?Math.round(l.reduce((t,s)=>t+s.totalOrders,0)/i.length):0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Avg Employees per Client"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:i.length>0?Math.round(l.reduce((t,s)=>t+s.totalEmployees,0)/i.length):0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Avg Participation Rate"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[i.length>0?(l.reduce((t,s)=>t+s.participationRate,0)/i.length).toFixed(1):"0.0","%"]})]})]})})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(p,{children:"All Clients Performance"})}),e.jsx(x,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-700",children:"Client"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Sites"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Employees"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Orders"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Revenue"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Avg Order"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Participation"}),e.jsx("th",{className:"text-right p-3 font-medium text-gray-700",children:"Cost/Employee"})]})}),e.jsx("tbody",{children:l.sort((t,s)=>s.totalRevenue-t.totalRevenue).map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium text-gray-900",children:t.clientName}),e.jsxs("td",{className:"p-3 text-right text-gray-600",children:[t.activeSites,"/",t.totalSites]}),e.jsxs("td",{className:"p-3 text-right text-gray-600",children:[t.activeEmployees,"/",t.totalEmployees]}),e.jsx("td",{className:"p-3 text-right text-gray-600",children:t.totalOrders}),e.jsxs("td",{className:"p-3 text-right font-medium text-gray-900",children:["$",t.totalRevenue.toFixed(2)]}),e.jsxs("td",{className:"p-3 text-right text-gray-600",children:["$",t.avgOrderValue.toFixed(2)]}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs(ce,{className:t.participationRate>=80?"bg-green-100 text-green-800":t.participationRate>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",children:[t.participationRate.toFixed(1),"%"]})}),e.jsxs("td",{className:"p-3 text-right text-gray-600",children:["$",t.costPerEmployee.toFixed(2)]})]},t.clientId))})]})})})]})]})}export{ve as ClientPerformanceAnalytics};
