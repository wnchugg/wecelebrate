import{r as d,j as e,C as g,X as le,a6 as H,g as Ue,w as Ae,p as K,l as W,D as ge,a7 as Q,x as Pe,T as Me,B as te,q as $e,S as Le}from"./index-dV4Uttrq.js";import{C as E,d as U}from"./card-DtXIWsGG.js";import{B as b}from"./badge-hStN7-Ju.js";import{a as O,s as D}from"./errorHandling-CwdwM2Re.js";import{F as xe}from"./file-text-DnvqV_SC.js";import{D as ye}from"./download-CZmMXIZR.js";import{U as ae}from"./upload-BBB967fQ.js";import{C as V}from"./circle-check-big-BTbhA0uw.js";import{C as je}from"./circle-alert-DNo9lQw-.js";import{S as He}from"./SFTPConfiguration-CfKHjGzJ.js";import{S as se}from"./switch-CBDky-vy.js";import{I as F}from"./input-DElxXLEL.js";import{L as w}from"./label-Cx_2PmZF.js";import{P as G}from"./plus-DUZUgypq.js";import{C as Oe}from"./circle-x-CrdKUO8e.js";import{C as _e}from"./clock-B-jNmjCX.js";import{A as qe}from"./activity-C1_kJN04.js";import{C as pe}from"./calendar-BSj-0Q_N.js";import{D as Be,a as ze,b as Ke,c as We,e as Ve}from"./dialog-BOcbCdZI.js";import{M as Y}from"./map-pin-RXUS_5Nj.js";import{S as Je}from"./square-pen-BiMIh-Tu.js";import{T as Xe}from"./trash-2-B2VV2ZDP.js";import{S as Ge}from"./save-D7hvH_Dw.js";import{U as X}from"./users-DibFapgP.js";import{S as Ye}from"./server-CYiQ0EKI.js";import"./test-tube-qU13kJii.js";import"./folder-open-8EvxzsP3.js";import"./index-Bnc4558u.js";import"./index-C8MzEdCL.js";import"./index-B7jEnDBu.js";import"./index-CkX5DTQg.js";import"./index-DS1l-0-y.js";import"./index-Ttf8ZMtO.js";import"./index-DJFIPDZ_.js";import"./index-BO2tctDo.js";import"./index-faiGe14u.js";function Qe({client:l,onUploadComplete:v}){var M,I;const[_,h]=d.useState(!1),[j,$]=d.useState(null),[C,q]=d.useState(null),R=d.useRef(null),y=()=>{const f=["email,employeeId,name,department,country,region,location,serialCard","john.doe@company.com,EMP001,John Doe,Engineering,USA,West,San Francisco,CARD12345","jane.smith@company.com,EMP002,Jane Smith,Marketing,USA,East,New York,CARD12346","alex.johnson@company.com,EMP003,Alex Johnson,Sales,Canada,Central,Toronto,CARD12347"].join(`
`),m=new Blob([f],{type:"text/csv"}),i=URL.createObjectURL(m),T=document.createElement("a");T.href=i,T.download="employee_import_template.csv",T.click(),URL.revokeObjectURL(i),O("Template downloaded successfully")},A=f=>{const m=f.split(`
`).filter(p=>p.trim());if(m.length===0)return[];const i=m[0].split(",").map(p=>p.trim().toLowerCase()),T=[];for(let p=1;p<m.length;p++){if(!m[p].trim())continue;const L=m[p].split(",").map(S=>S.trim()),a={};i.forEach((S,N)=>{L[N]&&(a[S]=L[N])}),a.employeeid&&!a.employeeId&&(a.employeeId=a.employeeid),a.serialcard&&!a.serialCard&&(a.serialCard=a.serialcard),T.push(a)}return T},P=f=>{var i;const m=(i=f.target.files)==null?void 0:i[0];m&&(q(m),$(null))},B=async()=>{if(C){h(!0),$(null);try{const f=await C.text(),m=A(f);if(m.length===0){D("No valid employees found in CSV","Please check the file format");return}const i=await H(`/clients/${l.id}/employees/import`,{method:"POST",body:JSON.stringify({employees:m})});$(i),i.errors&&i.errors.length>0?D(`Imported ${i.imported} employees with ${i.errors.length} errors`,"Check the results below"):O(`Successfully imported ${i.imported} employees`),v()}catch(f){D("Import failed",f instanceof Error?f.message:"Unknown error")}finally{h(!1)}}},x=()=>{q(null),$(null),R.current&&(R.current.value="")};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(E,{children:e.jsxs(U,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(xe,{className:"w-5 h-5 text-[#D91C81] mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"How to Upload Employee Data"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-600",children:[e.jsx("li",{children:"Download the CSV template below"}),e.jsx("li",{children:"Fill in your employee data following the template format"}),e.jsx("li",{children:"Include these required fields: email, employeeId, name"}),e.jsx("li",{children:"Optional fields for site mapping: department, country, region, location"}),e.jsx("li",{children:"Upload the completed CSV file"}),e.jsx("li",{children:"Review the import results and configure site mapping rules if needed"})]})]})]}),e.jsxs(g,{onClick:y,variant:"outline",className:"gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Download CSV Template"]})]})}),e.jsx(E,{children:e.jsxs(U,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Upload Employee CSV File"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-[#D91C81] transition-colors",children:[e.jsx("input",{ref:R,type:"file",accept:".csv",onChange:P,className:"hidden",id:"employee-csv-upload"}),e.jsxs("label",{htmlFor:"employee-csv-upload",className:"cursor-pointer",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-600",children:"CSV files only (Max 10MB)"})]})]}),C&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:C.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[(C.size/1024).toFixed(2)," KB"]})]})]}),e.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-600",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsx(g,{onClick:B,disabled:!C||_,className:"w-full bg-[#D91C81] hover:bg-[#B01669] text-white",children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Import Employees"]})})]})]})}),j&&e.jsx(E,{children:e.jsxs(U,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Import Results"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-900",children:"Imported"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:j.imported})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-900",children:"Updated"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:j.updated})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(je,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:"Skipped"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.skipped})]}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-xs font-medium text-red-900",children:"Errors"})]}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:((M=j.errors)==null?void 0:M.length)||0})]})]}),j.errors&&j.errors.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Error Details:"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:j.errors.map((f,m)=>e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded text-sm",children:[e.jsxs("span",{className:"font-medium text-red-900",children:["Row ",f.row,":"]})," ",e.jsxs("span",{className:"text-red-700",children:[f.field," - ",f.message]})]},m))})]}),j.success&&!((I=j.errors)!=null&&I.length)&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(V,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Import completed successfully!"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"All employees have been imported. You can now configure site mapping rules to automatically assign employees to sites."})]})]})})]})}),e.jsx(E,{children:e.jsxs(U,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"CSV Field Reference"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700",children:"Field Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700",children:"Required"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700",children:"Example"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:"email"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(b,{className:"bg-red-100 text-red-800 text-xs",children:"Required"})}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Employee email address"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"john.doe@company.com"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:"employeeId"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(b,{className:"bg-red-100 text-red-800 text-xs",children:"Required"})}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Unique employee identifier"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"EMP001"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:"name"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(b,{className:"bg-red-100 text-red-800 text-xs",children:"Required"})}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Full name"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"John Doe"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:"department"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(b,{className:"bg-blue-100 text-blue-800 text-xs",children:"Optional"})}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Department name (for mapping)"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Engineering"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:"country"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(b,{className:"bg-blue-100 text-blue-800 text-xs",children:"Optional"})}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Country (for mapping)"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"USA"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:"region"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(b,{className:"bg-blue-100 text-blue-800 text-xs",children:"Optional"})}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Region (for mapping)"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"West"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:"location"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(b,{className:"bg-blue-100 text-blue-800 text-xs",children:"Optional"})}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Office location (for mapping)"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"San Francisco"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:"serialCard"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(b,{className:"bg-blue-100 text-blue-800 text-xs",children:"Optional"})}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"Serial card number for validation"}),e.jsx("td",{className:"px-4 py-2 text-gray-600",children:"CARD12345"})]})]})]})})]})})]})}const he=[{id:"workday",name:"Workday",description:"Enterprise-grade HR, payroll, and financial management",authTypes:["oauth","api_key"],supportsRealtime:!0},{id:"bamboohr",name:"BambooHR",description:"All-in-one HR software for small and medium businesses",authTypes:["api_key"],supportsRealtime:!0},{id:"adp",name:"ADP Workforce Now",description:"Comprehensive payroll and HR solutions",authTypes:["oauth","api_key"],supportsRealtime:!0},{id:"namely",name:"Namely",description:"Modern HR platform with integrated payroll",authTypes:["api_key"],supportsRealtime:!1},{id:"rippling",name:"Rippling",description:"Employee management platform",authTypes:["oauth","api_key"],supportsRealtime:!0},{id:"gusto",name:"Gusto",description:"Payroll, benefits, and HR in one place",authTypes:["api_key"],supportsRealtime:!1},{id:"sftp",name:"SFTP File Transfer",description:"Import employee data via secure file transfer",authTypes:["sftp"],supportsRealtime:!1}],ue={employeeId:"employee_id",firstName:"first_name",lastName:"last_name",email:"email",department:"department",jobTitle:"job_title",startDate:"hire_date",status:"employment_status"};function Ze({client:l,sites:v,onSyncComplete:_}){const h=Ue(),[j,$]=d.useState([]),[C,q]=d.useState([]),[R,y]=d.useState(!0),[A,P]=d.useState("connections"),[B,x]=d.useState(!1),[M,I]=d.useState(!1),[f,m]=d.useState(!1),[i,T]=d.useState(null),[p,L]=d.useState(null),[a,S]=d.useState(null),[N,r]=d.useState("client"),[n,o]=d.useState([]),[t,u]=d.useState({displayName:"",providerId:"",authType:"api_key",apiUrl:"",apiKey:"",username:"",password:"",clientId:"",clientSecret:"",tenantId:"",sftpHost:"",sftpPort:"22",sftpUsername:"",sftpPassword:"",sftpPath:"",syncFrequency:"daily",syncTime:"02:00",autoImport:!0,updateExisting:!0,deactivateMissing:!1,notifyOnSync:!0}),[Z,ne]=d.useState(ue),z=`https://${Ae}.supabase.co/functions/v1/make-server-6fcaeea3`;d.useEffect(()=>{J(),ie()},[l.id]);const J=async()=>{try{y(!0);const s=await fetch(`${z}/hris/connections?clientId=${l.id}`,{headers:{Authorization:`Bearer ${K}`,"X-Environment-ID":h.id}});if(!s.ok)throw new Error(`Failed to load HRIS connections: ${s.status}`);const c=await s.json();$(c.connections||[])}catch(s){W.error("Error loading HRIS connections:",s),D("Failed to load HRIS connections")}finally{y(!1)}},ie=async()=>{try{const s=await fetch(`${z}/hris/sync-history?clientId=${l.id}`,{headers:{Authorization:`Bearer ${K}`,"X-Environment-ID":h.id}});if(s.ok){const c=await s.json();q(c.history||[])}}catch(s){W.error("Error loading sync history:",s)}},fe=s=>{L(s),u({...t,displayName:`${l.name} - ${s.name}`,providerId:s.id,authType:s.authTypes[0]}),ne(ue),r("client"),o([]),x(!0)},Ne=s=>{T(s),L(he.find(Fe=>Fe.id===s.provider)||null),r("client"),o([]);const c=s.credentials;let k="",ee="",ce="",de="",oe="",me="";const Ie="",ke="",De="22",Ee="",Re="",Te="";c.type==="api_key"?(ee=c.apiKey,k=c.apiSecret||""):c.type==="oauth"?(oe=c.clientId,me=c.clientSecret,k=c.accessToken||""):c.type==="basic_auth"&&(ce=c.username,de=c.password),u({displayName:s.provider,providerId:s.provider,authType:s.authType,apiUrl:k,apiKey:ee,username:ce,password:de,clientId:oe,clientSecret:me,tenantId:Ie,sftpHost:ke,sftpPort:De,sftpUsername:Ee,sftpPassword:Re,sftpPath:Te,syncFrequency:s.syncSchedule.frequency,syncTime:s.syncSchedule.time,autoImport:s.syncSchedule.enabled,updateExisting:!1,deactivateMissing:!1,notifyOnSync:!1}),ne(s.fieldMapping),x(!0)},ve=async()=>{try{const s={};t.authType==="api_key"?(s.apiUrl=t.apiUrl,s.apiKey=t.apiKey):t.authType==="oauth"?(s.apiUrl=t.apiUrl,s.clientId=t.clientId,s.clientSecret=t.clientSecret,s.tenantId=t.tenantId):t.authType==="basic"?(s.apiUrl=t.apiUrl,s.username=t.username,s.password=t.password):t.authType==="sftp"&&(s.sftpHost=t.sftpHost,s.sftpPort=t.sftpPort,s.sftpUsername=t.sftpUsername,s.sftpPassword=t.sftpPassword,s.sftpPath=t.sftpPath);const c={id:i==null?void 0:i.id,clientId:l.id,providerId:t.providerId,providerName:(p==null?void 0:p.name)||"",displayName:t.displayName,authType:t.authType,credentials:s,fieldMapping:Z,syncSchedule:{enabled:t.syncFrequency!=="manual",frequency:t.syncFrequency,time:t.syncTime},syncConfig:{autoImport:t.autoImport,updateExisting:t.updateExisting,deactivateMissing:t.deactivateMissing,notifyOnSync:t.notifyOnSync}};if(N==="client"?(c.siteId=null,c.siteIds=[]):c.siteIds=n,!(await fetch(`${z}/hris/connections${i?`/${i.id}`:""}`,{method:i?"PUT":"POST",headers:{Authorization:`Bearer ${K}`,"Content-Type":"application/json","X-Environment-ID":h.id},body:JSON.stringify(c)})).ok)throw new Error(`Failed to ${i?"update":"create"} connection`);O(`HRIS connection ${i?"updated":"created"} successfully`),x(!1),T(null),L(null),J()}catch(s){W.error("Error saving HRIS connection:",s),D(`Failed to ${i?"update":"create"} connection`)}},be=async s=>{try{const k=await(await fetch(`${z}/hris/connections/${s}/test`,{method:"POST",headers:{Authorization:`Bearer ${K}`,"X-Environment-ID":h.id}})).json();k.success?O("Connection test successful"):D(`Connection test failed: ${k.error}`),J()}catch(c){W.error("Error testing connection:",c),D("Failed to test connection")}},we=async s=>{try{if(!(await fetch(`${z}/hris/connections/${s}/sync`,{method:"POST",headers:{Authorization:`Bearer ${K}`,"X-Environment-ID":h.id}})).ok)throw new Error("Failed to start sync");O("Sync started successfully"),setTimeout(()=>{ie(),J(),_&&_()},2e3)}catch(c){W.error("Error starting sync:",c),D("Failed to start sync")}},Ce=async s=>{if(confirm("Are you sure you want to delete this HRIS connection?"))try{if(!(await fetch(`${z}/hris/connections/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${K}`,"X-Environment-ID":h.id}})).ok)throw new Error("Failed to delete connection");O("HRIS connection deleted successfully"),J()}catch(c){W.error("Error deleting connection:",c),D("Failed to delete connection")}},Se=s=>"All Sites (Client-Level)";return R?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D91C81] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading HRIS integrations..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-[#1B2A5E] mb-2",children:"HRIS Integration"}),e.jsxs("p",{className:"text-gray-600",children:["Connect and sync employee data from your HR information system for ",l.name]})]})})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-4 px-6",children:[e.jsxs("button",{onClick:()=>P("connections"),className:`px-4 py-3 border-b-2 font-medium text-sm transition-colors ${A==="connections"?"border-[#D91C81] text-[#D91C81]":"border-transparent text-gray-600 hover:text-gray-900"}`,children:["Connections (",j.length,")"]}),e.jsx("button",{onClick:()=>P("providers"),className:`px-4 py-3 border-b-2 font-medium text-sm transition-colors ${A==="providers"?"border-[#D91C81] text-[#D91C81]":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Available Providers"}),e.jsxs("button",{onClick:()=>P("history"),className:`px-4 py-3 border-b-2 font-medium text-sm transition-colors ${A==="history"?"border-[#D91C81] text-[#D91C81]":"border-transparent text-gray-600 hover:text-gray-900"}`,children:["Sync History (",C.length,")"]})]})}),e.jsxs("div",{className:"p-6",children:[A==="connections"&&e.jsx("div",{className:"space-y-4",children:j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No HRIS Connections"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Connect your HR system to automatically sync employee data for ",l.name]}),e.jsxs(g,{onClick:()=>P("providers"),className:"bg-[#D91C81] hover:bg-[#B01669] text-white",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Browse Providers"]})]}):e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-xl p-6 hover:border-[#D91C81] transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[s.provider," Connection"]}),e.jsxs(b,{variant:s.status==="active"?"success":s.status==="error"?"destructive":"secondary",children:[s.status==="active"&&e.jsx(V,{className:"w-3 h-3 mr-1"}),s.status==="error"&&e.jsx(Oe,{className:"w-3 h-3 mr-1"}),s.status==="inactive"&&e.jsx(_e,{className:"w-3 h-3 mr-1"}),s.status]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Provider: ",s.provider," â€¢ Auth: ",s.authType]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Scope: ",Se()]}),s.lastSync&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Last sync: ",new Date(s.lastSync).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>be(s.id),children:"Test"}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>we(s.id),children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Ne(s),children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Ce(s.id),className:"text-red-600 hover:text-red-700",children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sync Schedule"}),e.jsxs("p",{className:"font-medium",children:[s.syncSchedule.frequency," @ ",s.syncSchedule.time]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Auto Import"}),e.jsx("p",{className:"font-medium",children:s.syncConfig.autoImport?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Update Existing"}),e.jsx("p",{className:"font-medium",children:s.syncConfig.updateExisting?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Next Sync"}),e.jsx("p",{className:"font-medium",children:s.syncSchedule.nextSync?new Date(s.syncSchedule.nextSync).toLocaleString():"Manual only"})]})]})]},s.id))})}),A==="providers"&&e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:he.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-xl p-6 hover:border-[#D91C81] transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(V,{className:"w-4 h-4 text-green-600"}),"Auth: ",s.authTypes.join(", ")]}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:s.supportsRealtime?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 text-green-600"}),"Real-time sync supported"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4 text-gray-400"}),"Scheduled sync only"]})})]}),e.jsxs(g,{onClick:()=>fe(s),className:"w-full bg-[#D91C81] hover:bg-[#B01669] text-white",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Connect"]})]},s.id))}),A==="history"&&e.jsx("div",{className:"space-y-4",children:C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Sync History"}),e.jsx("p",{className:"text-gray-600",children:"Sync history will appear here after you run your first sync"})]}):C.map(s=>{const c=j.find(k=>k.id===s.connectionId);return e.jsxs("div",{className:"border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:(c==null?void 0:c.displayName)||"Unknown Connection"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[new Date(s.startTime).toLocaleString(),s.endTime&&` - ${new Date(s.endTime).toLocaleString()}`]})]}),e.jsx(b,{variant:s.status==="completed"?"success":s.status==="failed"?"destructive":s.status==="partial"?"warning":"secondary",children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Processed"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.recordsProcessed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:s.recordsCreated})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Updated"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:s.recordsUpdated})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Skipped"}),e.jsx("p",{className:"text-lg font-semibold text-gray-600",children:s.recordsSkipped})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Failed"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:s.recordsFailed})]})]}),s.errors&&s.errors.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-900 mb-2",children:"Errors:"}),e.jsx("ul",{className:"space-y-1",children:s.errors.slice(0,3).map((k,ee)=>e.jsxs("li",{className:"text-sm text-red-800",children:[k.field,": ",k.message,k.recordId&&` (${k.recordId})`]},ee))}),s.errors.length>3&&e.jsxs("p",{className:"text-sm text-red-800 mt-1",children:["... and ",s.errors.length-3," more errors"]})]})]})})]},s.id)})})]})]}),B&&p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-bold text-[#1B2A5E]",children:[i?"Edit":"Create"," HRIS Connection"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[p.name," - ",l.name]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"displayName",children:"Display Name"}),e.jsx(F,{id:"displayName",value:t.displayName,onChange:s=>u({...t,displayName:s.target.value}),placeholder:"e.g., TechCorp - Workday"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsx(w,{className:"mb-3 block",children:"Connection Scope"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"scope",checked:N==="client",onChange:()=>{r("client"),o([])},className:"mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Client Level (All Sites)"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["This connection will apply to all sites under ",l.name]})]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"scope",checked:N==="sites",onChange:()=>r("sites"),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Specific Sites"}),e.jsx("div",{className:"text-sm text-gray-600 mb-3",children:"Select which sites should use this connection"}),N==="sites"&&e.jsx("div",{className:"space-y-2 ml-6",children:v.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No sites available"}):v.map(s=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.includes(s.id),onChange:c=>{c.target.checked?o([...n,s.id]):o(n.filter(k=>k!==s.id))}}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name}),!s.isActive&&e.jsx("span",{className:"text-xs text-gray-500",children:"(Inactive)"})]},s.id))})]})]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"authType",children:"Authentication Type"}),e.jsx("select",{id:"authType",value:t.authType,onChange:s=>u({...t,authType:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:p.authTypes.map(s=>e.jsx("option",{value:s,children:s.toUpperCase().replace("_"," ")},s))})]}),t.authType==="api_key"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"apiUrl",children:"API URL"}),e.jsx(F,{id:"apiUrl",value:t.apiUrl,onChange:s=>u({...t,apiUrl:s.target.value}),placeholder:"https://api.provider.com/v1"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"apiKey",children:"API Key"}),e.jsx(F,{id:"apiKey",type:"password",value:t.apiKey,onChange:s=>u({...t,apiKey:s.target.value}),placeholder:"Enter API key"})]})]}),t.authType==="oauth"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"apiUrl",children:"API URL"}),e.jsx(F,{id:"apiUrl",value:t.apiUrl,onChange:s=>u({...t,apiUrl:s.target.value}),placeholder:"https://api.provider.com/v1"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"clientId",children:"Client ID"}),e.jsx(F,{id:"clientId",value:t.clientId,onChange:s=>u({...t,clientId:s.target.value}),placeholder:"Enter OAuth client ID"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"clientSecret",children:"Client Secret"}),e.jsx(F,{id:"clientSecret",type:"password",value:t.clientSecret,onChange:s=>u({...t,clientSecret:s.target.value}),placeholder:"Enter OAuth client secret"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"tenantId",children:"Tenant ID (Optional)"}),e.jsx(F,{id:"tenantId",value:t.tenantId,onChange:s=>u({...t,tenantId:s.target.value}),placeholder:"Enter tenant ID if required"})]})]}),t.authType==="sftp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"sftpHost",children:"SFTP Host"}),e.jsx(F,{id:"sftpHost",value:t.sftpHost,onChange:s=>u({...t,sftpHost:s.target.value}),placeholder:"sftp.provider.com"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"sftpUsername",children:"Username"}),e.jsx(F,{id:"sftpUsername",value:t.sftpUsername,onChange:s=>u({...t,sftpUsername:s.target.value}),placeholder:"Enter SFTP username"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"sftpPassword",children:"Password"}),e.jsx(F,{id:"sftpPassword",type:"password",value:t.sftpPassword,onChange:s=>u({...t,sftpPassword:s.target.value}),placeholder:"Enter SFTP password"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"sftpPath",children:"File Path"}),e.jsx(F,{id:"sftpPath",value:t.sftpPath,onChange:s=>u({...t,sftpPath:s.target.value}),placeholder:"/exports/employees.csv"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Sync Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"syncFrequency",children:"Sync Frequency"}),e.jsxs("select",{id:"syncFrequency",value:t.syncFrequency,onChange:s=>u({...t,syncFrequency:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"manual",children:"Manual Only"}),e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),t.syncFrequency!=="manual"&&e.jsxs("div",{children:[e.jsx(w,{htmlFor:"syncTime",children:"Sync Time"}),e.jsx(F,{id:"syncTime",type:"time",value:t.syncTime,onChange:s=>u({...t,syncTime:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(se,{checked:t.autoImport,onCheckedChange:s=>u({...t,autoImport:s})}),e.jsx("span",{className:"text-sm text-gray-700",children:"Auto-import employees"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(se,{checked:t.updateExisting,onCheckedChange:s=>u({...t,updateExisting:s})}),e.jsx("span",{className:"text-sm text-gray-700",children:"Update existing employees"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(se,{checked:t.deactivateMissing,onCheckedChange:s=>u({...t,deactivateMissing:s})}),e.jsx("span",{className:"text-sm text-gray-700",children:"Deactivate employees not found in HRIS"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(se,{checked:t.notifyOnSync,onCheckedChange:s=>u({...t,notifyOnSync:s})}),e.jsx("span",{className:"text-sm text-gray-700",children:"Send notification after sync"})]})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex gap-3 justify-end",children:[e.jsx(g,{variant:"outline",onClick:()=>{x(!1),T(null),L(null)},children:"Cancel"}),e.jsxs(g,{onClick:ve,className:"bg-[#D91C81] hover:bg-[#B01669] text-white",children:[i?"Update":"Create"," Connection"]})]})]})})]})}const re={async set(l,v){await H("/kv",{method:"PUT",body:JSON.stringify({key:l,value:v})})},async get(l){try{return(await H(`/kv/${encodeURIComponent(l)}`)).value??null}catch{return null}},async del(l){await H(`/kv/${encodeURIComponent(l)}`,{method:"DELETE"})}},es={async get(l){return H(l)},async post(l,v){return H(l,{method:"POST",body:v?JSON.stringify(v):void 0})},async put(l,v){return H(l,{method:"PUT",body:v?JSON.stringify(v):void 0})},async del(l){return H(l,{method:"DELETE"})}};function ss({client:l,sites:v,onRulesUpdated:_}){const[h,j]=d.useState([]),[$,C]=d.useState(!0),[q,R]=d.useState(!1),[y,A]=d.useState(null),[P,B]=d.useState(!1),[x,M]=d.useState({clientId:l.id,siteId:"",priority:1,conditions:[{field:"country",operator:"equals",value:""}],isActive:!0});d.useEffect(()=>{I()},[l.id]);const I=async()=>{C(!0);try{const{rules:r}=await H(`/clients/${l.id}/mapping-rules`);j(r)}catch(r){D("Failed to load mapping rules",r instanceof Error?r.message:"Unknown error")}finally{C(!1)}},f=()=>{M({clientId:l.id,siteId:"",priority:h.length+1,conditions:[{field:"country",operator:"equals",value:""}],isActive:!0}),A(null),R(!0)},m=r=>{M(r),A(r),R(!0)},i=async()=>{if(y)try{const r=y.id?`site_mapping_rule:${y.id}`:`site_mapping_rule:${Date.now()}`,n={...y,id:y.id||`rule_${Date.now()}`,updatedAt:new Date().toISOString()};await re.set(r,n),O(y.id?"Rule updated":"Rule created","Site mapping rule saved successfully"),I(),R(!1)}catch(r){D("Failed to save rule",r instanceof Error?r.message:"Unknown error")}},T=async r=>{if(window.confirm("Are you sure you want to delete this mapping rule?"))try{await re.del(`site_mapping_rule:${r}`),O("Mapping rule deleted successfully"),I()}catch(n){D("Failed to delete rule",n instanceof Error?n.message:"Unknown error")}},p=async r=>{try{const n={...r,isActive:!r.isActive};await re.set(`site_mapping_rule:${r.id}`,n),O(`Rule ${r.isActive?"disabled":"enabled"}`),I()}catch(n){D("Failed to update rule",n instanceof Error?n.message:"Unknown error")}},L=async()=>{try{B(!0),await es.post("erp/site-mappings/apply-rules",{erpConnectionId:l.id}),_()}catch(r){D("Failed to apply rules",r instanceof Error?r.message:"Unknown error")}finally{B(!1)}},a=()=>{M({...x,conditions:[...x.conditions,{field:"country",operator:"equals",value:""}]})},S=r=>{M({...x,conditions:x.conditions.filter((n,o)=>o!==r)})},N=(r,n)=>{M({...x,conditions:x.conditions.map((o,t)=>t===r?{...o,...n}:o)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(E,{children:e.jsx(U,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-[#D91C81] mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Site Mapping Rules"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Automatically assign employees to sites based on their attributes like country, department, or region"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{onClick:L,disabled:P||h.length===0,variant:"outline",size:"sm",children:P?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),"Applying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Apply Rules"]})}),e.jsxs(g,{onClick:f,className:"bg-[#D91C81] hover:bg-[#B01669] text-white",size:"sm",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Add Rule"]})]})]})})}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx(je,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"How Mapping Rules Work"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-800",children:[e.jsx("li",{children:"Rules are evaluated in priority order (lower numbers first)"}),e.jsx("li",{children:"All conditions in a rule must match for an employee to be mapped"}),e.jsx("li",{children:"Once an employee matches a rule, they are assigned to that site"}),e.jsx("li",{children:'Click "Apply Rules" to run the mapping process on all employees'})]})]})]}),$?e.jsx(E,{children:e.jsxs(U,{className:"p-12 text-center",children:[e.jsx(Q,{className:"w-8 h-8 animate-spin text-[#D91C81] mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading mapping rules..."})]})}):h.length===0?e.jsx(E,{children:e.jsxs(U,{className:"p-12 text-center",children:[e.jsx(Y,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Mapping Rules"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first mapping rule to automatically assign employees to sites"}),e.jsxs(g,{onClick:f,className:"bg-[#D91C81] hover:bg-[#B01669] text-white",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Create First Rule"]})]})}):e.jsx("div",{className:"space-y-3",children:h.sort((r,n)=>r.priority-n.priority).map(r=>{const n=v.find(o=>o.id===r.siteId);return e.jsx(E,{children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(b,{className:"bg-gray-100 text-gray-700 text-xs",children:["Priority ",r.priority]}),e.jsx(b,{className:r.isActive?"bg-green-100 text-green-800 text-xs":"bg-gray-100 text-gray-600 text-xs",children:r.isActive?"Active":"Inactive"}),n&&e.jsxs(b,{className:"bg-blue-100 text-blue-800 text-xs",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),n.name]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Map employees to ",e.jsx("span",{className:"text-[#D91C81]",children:(n==null?void 0:n.name)||"Unknown Site"})," when:"]}),r.conditions.map((o,t)=>e.jsxs("div",{className:"text-sm text-gray-600 ml-4",children:[t>0&&e.jsx("span",{className:"font-semibold text-gray-900",children:"AND "}),e.jsx("span",{className:"font-medium",children:o.field})," ",e.jsx("span",{className:"text-gray-500",children:o.operator})," ",e.jsxs("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:['"',o.value,'"']})]},t))]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(g,{onClick:()=>p(r),variant:"outline",size:"sm",children:r.isActive?"Disable":"Enable"}),e.jsx(g,{onClick:()=>m(r),variant:"outline",size:"sm",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx(g,{onClick:()=>r.id&&T(r.id),variant:"outline",size:"sm",className:"text-red-600 hover:bg-red-50",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})})},r.id)})}),e.jsx(Be,{open:q,onOpenChange:R,children:e.jsxs(ze,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ke,{children:e.jsx(We,{children:y?"Edit Mapping Rule":"Create Mapping Rule"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"siteId",children:"Target Site *"}),e.jsxs("select",{id:"siteId",value:x.siteId,onChange:r=>M({...x,siteId:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"",children:"Select a site..."}),v.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"priority",children:"Priority"}),e.jsx(F,{id:"priority",type:"number",min:1,value:x.priority,onChange:r=>M({...x,priority:parseInt(r.target.value)||1})}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Lower numbers = higher priority"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(w,{children:"Conditions (All must match)"}),e.jsxs(g,{onClick:a,variant:"outline",size:"sm",type:"button",children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Add Condition"]})]}),e.jsx("div",{className:"space-y-2",children:x.conditions.map((r,n)=>e.jsxs("div",{className:"flex gap-2 items-start p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-3 gap-2",children:[e.jsx("div",{children:e.jsxs("select",{value:r.field,onChange:o=>N(n,{field:o.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:border-[#D91C81] outline-none",children:[e.jsx("option",{value:"country",children:"Country"}),e.jsx("option",{value:"region",children:"Region"}),e.jsx("option",{value:"department",children:"Department"}),e.jsx("option",{value:"location",children:"Location"})]})}),e.jsx("div",{children:e.jsxs("select",{value:r.operator,onChange:o=>N(n,{operator:o.target.value}),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:border-[#D91C81] outline-none",children:[e.jsx("option",{value:"equals",children:"Equals"}),e.jsx("option",{value:"contains",children:"Contains"}),e.jsx("option",{value:"startsWith",children:"Starts With"}),e.jsx("option",{value:"endsWith",children:"Ends With"})]})}),e.jsx("div",{children:e.jsx(F,{value:r.value,onChange:o=>N(n,{value:o.target.value}),placeholder:"Value",className:"text-sm"})})]}),x.conditions.length>1&&e.jsx(g,{onClick:()=>S(n),variant:"outline",size:"sm",type:"button",className:"text-red-600 hover:bg-red-50",children:e.jsx(le,{className:"w-4 h-4"})})]},n))})]})]}),e.jsxs(Ve,{children:[e.jsx(g,{onClick:()=>R(!1),variant:"outline",children:"Cancel"}),e.jsxs(g,{onClick:i,className:"bg-[#D91C81] hover:bg-[#B01669] text-white",children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Save Rule"]})]})]})})]})}function Ls(){const{currentClient:l,sites:v,isLoading:_}=$e(),[h,j]=d.useState("employees"),[$,C]=d.useState([]),[q,R]=d.useState(!1),[y,A]=d.useState(""),[P,B]=d.useState("all"),[x,M]=d.useState("all"),[I,f]=d.useState({total:0,active:0,inactive:0,mapped:0,unmapped:0}),m=l?v.filter(a=>a.clientId===l.id):v;d.useEffect(()=>{l?i():C([])},[l]);const i=async()=>{if(l){R(!0);try{const{employees:a}=await H(`/clients/${l.id}/employees`);C(a);const S=a.length,N=a.filter(t=>t.status==="active").length,r=a.filter(t=>t.status==="inactive").length,n=a.filter(t=>t.siteId).length,o=a.filter(t=>!t.siteId).length;f({total:S,active:N,inactive:r,mapped:n,unmapped:o})}catch(a){D("Failed to load employees",a instanceof Error?a.message:"Unknown error"),C([])}finally{R(!1)}}},T=()=>{if(p.length===0){D("No employees to export","");return}const a=[["Name","Email","Employee ID","Serial Card","Department","Country","Region","Location","Site","Status"].join(","),...p.map(n=>{var o;return[n.name||"",n.email||"",n.employeeId||"",n.serialCard||"",n.department||"",n.country||"",n.region||"",n.location||"",n.siteId?((o=m.find(t=>t.id===n.siteId))==null?void 0:o.name)||"Unknown":"Not Mapped",n.status].join(",")})].join(`
`),S=new Blob([a],{type:"text/csv"}),N=URL.createObjectURL(S),r=document.createElement("a");r.href=N,r.download=`employees-${l==null?void 0:l.name}-${new Date().toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(N),O("Employees exported successfully")},p=$.filter(a=>{var n,o,t,u,Z;const S=((n=a.name)==null?void 0:n.toLowerCase().includes(y.toLowerCase()))||((o=a.email)==null?void 0:o.toLowerCase().includes(y.toLowerCase()))||((t=a.employeeId)==null?void 0:t.toLowerCase().includes(y.toLowerCase()))||((u=a.department)==null?void 0:u.toLowerCase().includes(y.toLowerCase()))||((Z=a.country)==null?void 0:Z.toLowerCase().includes(y.toLowerCase())),N=P==="all"||a.status===P,r=x==="all"||x==="unmapped"&&!a.siteId||a.siteId===x;return S&&N&&r}),L=[{id:"employees",label:"All Employees",icon:X,count:I.total},{id:"mapping",label:"Site Mapping Rules",icon:Y,badge:`${I.unmapped} unmapped`},{id:"manual",label:"Manual Upload",icon:ae},{id:"sftp",label:"SFTP Integration",icon:Ye},{id:"hris",label:"HRIS Integration",icon:ge}];return l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Employee Management"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Manage employee data and site assignments"}),l&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(b,{className:"bg-[#D91C81] text-white px-3 py-1",children:[e.jsx(te,{className:"w-3 h-3 mr-1.5"}),l.name]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[m.length," ",m.length===1?"site":"sites"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:i,className:"gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs(g,{onClick:T,variant:"outline",size:"sm",className:"gap-2",disabled:$.length===0,children:[e.jsx(ye,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(E,{children:e.jsx(U,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:I.total}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Employees"})]})]})})}),e.jsx(E,{children:e.jsx(U,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:I.active}),e.jsx("div",{className:"text-xs text-gray-600",children:"Active"})]})]})})}),e.jsx(E,{children:e.jsx(U,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gray-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:I.inactive}),e.jsx("div",{className:"text-xs text-gray-600",children:"Inactive"})]})]})})}),e.jsx(E,{children:e.jsx(U,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:I.mapped}),e.jsx("div",{className:"text-xs text-gray-600",children:"Mapped to Sites"})]})]})})}),e.jsx(E,{children:e.jsx(U,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:I.unmapped}),e.jsx("div",{className:"text-xs text-gray-600",children:"Unmapped"})]})]})})})]}),e.jsx(E,{className:"p-1",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:L.map(a=>{const S=a.icon;return e.jsxs("button",{onClick:()=>j(a.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-md transition-all ${h===a.id?"bg-[#D91C81] text-white shadow-sm":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-sm",children:a.label}),a.count!==void 0&&e.jsx(b,{className:h===a.id?"bg-white text-[#D91C81]":"bg-gray-200 text-gray-700",children:a.count}),a.badge&&e.jsx(b,{className:h===a.id?"bg-white text-[#D91C81]":"bg-orange-100 text-orange-700",children:a.badge})]},a.id)})})}),h==="employees"&&e.jsx(E,{children:e.jsxs(U,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, email, employee ID, department, or country...",value:y,onChange:a=>A(a.target.value),className:"w-full pl-10 pr-4 py-2 border-2 border-gray-200 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:P,onChange:a=>B(a.target.value),className:"px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsxs("select",{value:x,onChange:a=>M(a.target.value),className:"px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"all",children:"All Sites"}),e.jsx("option",{value:"unmapped",children:"Unmapped"}),m.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),q?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-8 h-8 animate-spin text-[#D91C81] mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading employees..."})]}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:y?"Try adjusting your search or filters":"Get started by uploading employee data"}),!y&&e.jsxs(g,{onClick:()=>j("manual"),className:"bg-[#D91C81] hover:bg-[#B01669] text-white",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Upload Employees"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b-2 border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Employee ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Site Assignment"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map(a=>{const S=a.siteId?m.find(N=>N.id===a.siteId):null;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.name}),e.jsx("div",{className:"text-sm text-gray-600",children:a.email})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"font-mono text-sm text-gray-900",children:a.employeeId})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"text-sm text-gray-900",children:a.department||"-"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900",children:a.country||"-"}),a.region&&e.jsx("div",{className:"text-gray-600 text-xs",children:a.region})]})}),e.jsx("td",{className:"px-4 py-4",children:S?e.jsxs(b,{className:"bg-green-100 text-green-800",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),S.name]}):e.jsx(b,{className:"bg-orange-100 text-orange-800",children:"Not Mapped"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx(b,{className:a.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:a.status})})]},a.id)})})]})}),p.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-gray-600 text-center",children:["Showing ",p.length," of ",$.length," employees"]})]})}),h==="mapping"&&e.jsx(ss,{client:l,sites:m,onRulesUpdated:i}),h==="manual"&&e.jsx(Qe,{client:l,onUploadComplete:i}),h==="sftp"&&e.jsx(He,{client:l,onConfigUpdated:i}),h==="hris"&&e.jsx(Ze,{client:l,sites:m.map(a=>({...a,isActive:a.status==="active"})),onSyncComplete:i})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Client Selected"}),e.jsx("p",{className:"text-gray-600",children:"Please select a client to manage employees"})]})})}export{Ls as EmployeeManagement};
