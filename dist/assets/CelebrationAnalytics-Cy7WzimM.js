import{u as V,r as i,a6 as v,l as M,j as e,C as w,n as Z}from"./index-DAep3-17.js";import{C as o,d as c,a as p,b as j}from"./card-D7HVS59i.js";import{s as O,a as ee}from"./errorHandling-61HatLcx.js";import{u as se}from"./useDateFormat-CL4PWcmD.js";import{D as te}from"./download-C6Tum4sE.js";import{C as F}from"./calendar-R6FbzVZU.js";import{P as ae}from"./party-popper-CSAh1Way.js";import{A as S}from"./award-CRB7h3zu.js";import{T as L}from"./trending-up-Bu-Iu6q7.js";import{C as re}from"./clock-Cklh_US9.js";import{R as N,a as ne,T as C,C as D,X as R,Y as A,B as U,b as I}from"./BarChart-CKM6f44k.js";import{P as le,a as ie}from"./PieChart-CGY_DfTN.js";import{A as oe}from"./AreaChart-DYarr4_8.js";import{A as ce}from"./Area-DJLsZOyd.js";const g={primary:"#D91C81",secondary:"#1B2A5E",tertiary:"#00B4CC",success:"#10B981",warning:"#F59E0B",purple:"#8B5CF6",indigo:"#6366F1",emerald:"#10B981",rose:"#F43F5E",amber:"#F59E0B"};function Re(){const P=V(),{formatDate:y}=se(),[x,$]=i.useState([]),[T,K]=i.useState([]),[de,Y]=i.useState([]),[me,z]=i.useState([]),[_,B]=i.useState(!0),[h,G]=i.useState("90");i.useEffect(()=>{J()},[]);const J=async()=>{B(!0);try{const[s,t,a,r]=await Promise.all([v("/celebrations").catch(()=>({data:[]})),v("/v2/orders").catch(()=>({data:[]})),v("/v2/employees").catch(()=>({data:[]})),v("/v2/clients").catch(()=>({data:[]}))]);$(s.data||[]),K(t.data||[]),Y(a.data||[]),z(r.data||[])}catch(s){O("Failed to load celebration analytics",s instanceof Error?s.message:"Unknown error"),M.error("Failed to load celebration analytics",s)}finally{B(!1)}},d=i.useMemo(()=>{if(h==="all")return x;const s=new Date,t=parseInt(h),a=new Date(s.getTime()-t*24*60*60*1e3);return x.filter(r=>new Date(r.date)>=a)},[x,h]),l=i.useMemo(()=>{const s=d.length,t=d.filter(m=>m.status==="active").length,a={};d.forEach(m=>{a[m.type]=(a[m.type]||0)+1});const r=d.filter(m=>T.some(f=>{var k;return((k=f.metadata)==null?void 0:k.celebrationId)===m.id})).length,n=s>0?r/s*100:0,E=new Date,q=new Date(E.getTime()+720*60*60*1e3),Q=x.filter(m=>{const f=new Date(m.date);return f>=E&&f<=q&&m.status==="active"}).length;return{totalCelebrations:s,activeCelebrations:t,typeBreakdown:a,conversionRate:n,upcomingCelebrations:Q,celebrationsWithOrders:r}},[d,T,x]),b=i.useMemo(()=>Object.entries(l.typeBreakdown).map(([s,t],a)=>({name:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),value:t,fill:Object.values(g)[a%Object.values(g).length]})).sort((s,t)=>t.value-s.value),[l.typeBreakdown]),u=i.useMemo(()=>{const s={};return d.forEach(t=>{const a=new Date(t.date),r=y(a,{year:"numeric",month:"short"});s[r]=(s[r]||0)+1}),Object.entries(s).map(([t,a])=>({month:t,celebrations:a})).sort((t,a)=>new Date(t.month).getTime()-new Date(a.month).getTime()).slice(-12)},[d,y]),H=i.useMemo(()=>{const s={};return x.forEach(a=>{const r=new Date(a.date),n=y(r,{month:"long"});s[n]=(s[n]||0)+1}),["January","February","March","April","May","June","July","August","September","October","November","December"].map(a=>({month:a.substring(0,3),count:s[a]||0}))},[x,y]),W=i.useMemo(()=>{const s={};return d.forEach(t=>{var a;if(t.type.includes("anniversary")||t.type.includes("year")){const r=((a=t.metadata)==null?void 0:a.years)||"Unknown",n=`${r} Year${r!==1?"s":""}`;s[n]=(s[n]||0)+1}}),Object.entries(s).map(([t,a])=>({milestone:t,count:a})).sort((t,a)=>{const r=parseInt(t.milestone),n=parseInt(a.milestone);return r-n}).slice(0,10)},[d]),X=()=>{try{const s=[["Celebration Analytics Report"],[`Generated: ${new Date().toLocaleString()}`],[`Date Range: Last ${h} days`],[],["SUMMARY METRICS"],["Total Celebrations",l.totalCelebrations],["Active Celebrations",l.activeCelebrations],["Upcoming (30 days)",l.upcomingCelebrations],["Conversion Rate",`${l.conversionRate.toFixed(1)}%`],[],["CELEBRATIONS BY TYPE"],...b.map(n=>[n.name,n.value])].map(n=>n.join(",")).join(`
`),t=new Blob([s],{type:"text/csv"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`Celebration_Analytics_${new Date().toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(a),ee("Report exported successfully")}catch(s){const t=s instanceof Error?s.message:"Unknown error";O("Failed to export report",t),M.error("Failed to export report",s)}};return _?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D91C81] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading celebration analytics..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>P("/admin/reports"),className:"gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Celebration Analytics"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Anniversary celebrations and award recognition insights"})]})]}),e.jsxs(w,{onClick:X,className:"bg-[#D91C81] hover:bg-[#B01669] text-white gap-2",size:"sm",children:[e.jsx(te,{className:"w-4 h-4"}),"Export Report"]})]}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Date Range:"})]}),e.jsx("div",{className:"flex gap-2",children:["30","90","180","365","all"].map(s=>e.jsx(w,{size:"sm",variant:h===s?"default":"outline",onClick:()=>G(s),className:h===s?"bg-[#D91C81] hover:bg-[#B01669]":"",children:s==="all"?"All Time":`${s} Days`},s))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-6 h-6 text-[#D91C81]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Celebrations"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.totalCelebrations})]})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"w-6 h-6 text-[#1B2A5E]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.activeCelebrations})]})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Conversion Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[l.conversionRate.toFixed(1),"%"]})]})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Upcoming (30 days)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.upcomingCelebrations})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Celebrations by Type"})}),e.jsx(c,{children:e.jsx(N,{width:"100%",height:300,children:e.jsxs(le,{children:[e.jsx(ie,{data:b,cx:"50%",cy:"50%",labelLine:!1,label:s=>`${s.name}: ${s.value}`,outerRadius:100,dataKey:"value",children:b.map((s,t)=>e.jsx(ne,{fill:s.fill},`cell-${t}`))}),e.jsx(C,{})]})})})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Celebration Trend (12 Months)"})}),e.jsx(c,{children:e.jsx(N,{width:"100%",height:300,children:e.jsxs(oe,{data:u,children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(R,{dataKey:"month"}),e.jsx(A,{}),e.jsx(C,{}),e.jsx(ce,{type:"monotone",dataKey:"celebrations",stroke:g.primary,fill:g.primary,fillOpacity:.3})]})})})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Celebrations by Calendar Month"})}),e.jsx(c,{children:e.jsx(N,{width:"100%",height:300,children:e.jsxs(U,{data:H,children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(R,{dataKey:"month"}),e.jsx(A,{}),e.jsx(C,{}),e.jsx(I,{dataKey:"count",fill:g.tertiary})]})})})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Anniversary Milestones"})}),e.jsx(c,{children:e.jsx(N,{width:"100%",height:300,children:e.jsxs(U,{data:W,layout:"vertical",children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(R,{type:"number"}),e.jsx(A,{dataKey:"milestone",type:"category",width:80}),e.jsx(C,{}),e.jsx(I,{dataKey:"count",fill:g.purple})]})})})]})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Celebration Type Summary"})}),e.jsx(c,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",style:{borderLeftWidth:"4px",borderLeftColor:s.fill},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(s.value/l.totalCelebrations*100).toFixed(1),"% of total"]})]}),e.jsx("p",{className:"text-2xl font-bold",style:{color:s.fill},children:s.value})]},t))})})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Key Insights"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(S,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Recognition Impact"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.conversionRate.toFixed(1),"% of celebrations result in gift orders, showing strong engagement with the recognition program."]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-green-50 rounded-lg",children:[e.jsx(F,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Upcoming Opportunities"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.upcomingCelebrations," celebrations scheduled in the next 30 days. Plan ahead for gift fulfillment and personalization."]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-purple-50 rounded-lg",children:[e.jsx(L,{className:"w-5 h-5 text-purple-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Program Growth"}),e.jsx("p",{className:"text-sm text-gray-600",children:u.length>1&&u[u.length-1].celebrations>u[0].celebrations?"Celebration volume is trending upward, indicating growing program adoption.":"Monitor celebration trends to optimize recognition program timing and resources."})]})]})]})})]})]})}export{Re as CelebrationAnalytics};
