import{r as l,g as b,j as A}from"./index-dV4Uttrq.js";import{f as y,a as E}from"./countries-Cl11nCR2.js";const P=3600*1e3,d=new Map;function T(t){const e=d.get(t);return e?Date.now()-e.timestamp>P?(d.delete(t),null):e.data:null}function $(t,e){d.set(t,{data:e,timestamp:Date.now()})}function I(t){t?d.delete(t):d.clear()}function w(){const e=new URLSearchParams(window.location.search).get("siteId");if(e)return e;const s=window.location.hostname,r=s.split(".");if(s.includes("figmaiframepreview")||s==="localhost")return null;if(r.length>=3||r.length===2&&r[1]==="localhost"){const n=r[0];if(n&&n!=="www"&&n!=="admin")return n}const o=window.location.pathname.match(/^\/site\/([^\/]+)/);if(o)return o[1];if(!window.location.pathname.startsWith("/admin")){const n=localStorage.getItem("jala2_current_site_id");if(n)return n}return null}function C(t){const[e,s]=l.useState(null),[r,o]=l.useState(!1),[n,a]=l.useState(null),c=l.useCallback(async i=>{var p,g,S;try{o(!0),a(null);const u=T(i);if(u){s(u),o(!1);return}const m=b(),v=`https://${(p=m.supabaseUrl.match(/https:\/\/([^.]+)/))==null?void 0:p[1]}.supabase.co/functions/v1/make-server-6fcaeea3`,f=await fetch(`${v}/public/sites/${i}`,{headers:{"X-Environment-ID":m.id,Authorization:`Bearer ${m.supabaseAnonKey}`}});if(!f.ok){if(f.status===404)throw new Error(`Site "${i}" not found. Please check the site ID.`);const U=f.statusText||`HTTP ${f.status}`;throw new Error(`Failed to load site configuration: ${U}`)}const h=await f.json();if(!h.site)throw new Error("Invalid site data received from server");if(h.site.status!=="active")throw new Error("This site is currently inactive. Please contact support.");$(i,h.site),s(h.site)}catch(u){!t&&!w()||(((g=u.message)==null?void 0:g.includes("not found"))||((S=u.message)==null?void 0:S.includes("inactive"))?console.warn("[useSite]",u.message):console.error("[useSite] Site fetch error:",u)),a(u.message||"Failed to load site configuration"),s(null)}finally{o(!1)}},[]),D=l.useCallback(async()=>{const i=t||w();i&&(I(i),await c(i))},[t,c]);return l.useEffect(()=>{if(window.location.pathname.startsWith("/admin")){o(!1),a(null),s(null);return}const i=t||w();if(!i){console.warn("[useSite] No site ID detected. Add ?siteId=xxx to URL or configure subdomain routing."),o(!1),a(null),s(null);return}c(i)},[t,c]),{site:e,isLoading:r,error:n,refetch:D}}function x(t){var e;return((e=t==null?void 0:t.settings)==null?void 0:e.defaultCurrency)||"USD"}function L({amount:t,baseCurrency:e="USD",className:s="",siteId:r}){const{site:o}=C(r),n=x(o),a=e!==n?E(t,e,n):t,c=y(a,n);return A.jsx("span",{className:s,children:c})}function M(t){const{site:e}=C(t),s=x(e),r=(n,a="USD")=>a!==s?E(n,a,s):n;return{currency:s,convert:r,format:(n,a="USD")=>{const c=r(n,a);return y(c,s)}}}export{L as C,M as u};
