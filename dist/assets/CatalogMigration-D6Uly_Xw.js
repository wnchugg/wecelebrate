import{u as w,r as a,j as e,n as C,T as u,D as S}from"./index-BKvtyMRF.js";import{b as k,g as M,r as E}from"./catalogApi-CHHyiXPN.js";import{C as j}from"./circle-check-big-BvCQpXTh.js";import{I as R}from"./info-lUgU3iMD.js";import{P as D}from"./play-CqMIL-n5.js";import{R as P}from"./rotate-ccw-CFj9ORmN.js";function G(){const f=w(),[b,r]=a.useState(!0),[n,d]=a.useState(!1),[c,o]=a.useState(!1),[T,B]=a.useState(!1),[m,l]=a.useState(null),[x,g]=a.useState(null),[h,N]=a.useState(!1),[s,p]=a.useState(null);a.useEffect(()=>{i()},[]);async function i(){try{r(!0),l(null);const[t,v]=await Promise.all([k(),M()]);N(t.migrationNeeded),p(v)}catch(t){console.error("Error checking migration status:",t),l(t.message||"Failed to check migration status")}finally{r(!1)}}async function y(){if(confirm("Are you sure you want to run the migration? This will convert all existing products to the multi-catalog structure."))try{o(!0),l(null),g(null);const t=await E();t.success?(g(t.message),await i()):l(t.message||"Migration failed")}catch(t){console.error("Error running migration:",t),l(t.message||"Failed to run migration")}finally{o(!1)}}return b?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#D91C81] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>f("/admin/catalogs"),className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(C,{className:"w-4 h-4"}),"Back to Catalogs"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Catalog Migration"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Migrate existing products to the multi-catalog architecture"})]}),x&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-green-900",children:"Success"}),e.jsx("div",{className:"text-green-700 text-sm mt-1",children:x})]})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(u,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-red-900",children:"Error"}),e.jsx("div",{className:"text-red-700 text-sm mt-1",children:m})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(S,{className:"w-6 h-6 text-[#D91C81]"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Migration Status"})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`p-4 rounded-lg ${s.migrationComplete?"bg-green-50 border border-green-200":"bg-yellow-50 border border-yellow-200"}`,children:e.jsx("div",{className:"flex items-center gap-2",children:s.migrationComplete?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900",children:"Migration Complete"})]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"font-medium text-yellow-900",children:"Migration Needed"})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s.totalCatalogs}),e.jsx("div",{className:"text-sm text-gray-600",children:"Catalogs"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s.totalGifts}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Products"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.giftsWithCatalog}),e.jsx("div",{className:"text-sm text-gray-600",children:"Migrated"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:`text-2xl font-bold ${s.giftsWithoutCatalog>0?"text-yellow-600":"text-gray-900"}`,children:s.giftsWithoutCatalog}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pending"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Site Configuration"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Total Sites"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:s.totalSites})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Configured"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:s.sitesConfigured})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Pending"}),e.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:s.sitesNeedingConfig})]})]})]}),s.catalogIds&&s.catalogIds.length>0&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Existing Catalogs"}),e.jsx("div",{className:"space-y-1",children:s.catalogIds.map(t=>e.jsx("div",{className:"text-sm text-gray-600 font-mono",children:t},t))})]}),s.estimationUsed&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700",children:["Statistics are estimated based on a sample of ",s.sampledGifts," products"]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"What does migration do?"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),e.jsx("span",{children:'Creates a "Legacy Catalog" containing all existing products'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),e.jsx("span",{children:"Updates all products with catalog linkage and source attribution"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),e.jsx("span",{children:"Assigns the legacy catalog to all existing sites"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"•"}),e.jsx("span",{children:"Enables multi-catalog functionality for future catalog management"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Run Migration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Convert your existing products to the multi-catalog structure. This is safe to run and will not delete any data."})]}),e.jsxs("button",{onClick:y,disabled:c,className:"inline-flex items-center gap-2 px-6 py-2 bg-[#D91C81] text-white rounded-lg hover:bg-[#B91670] transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:[e.jsx(D,{className:"w-5 h-5"}),c?"Migrating...":"Run Migration"]})]})}),!h&&!1,e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>{d(!0),i().finally(()=>d(!1))},disabled:n,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 hover:text-gray-900 disabled:opacity-50",children:[e.jsx(P,{className:`w-4 h-4 ${n?"animate-spin":""}`}),"Refresh Status"]})})]})]})}export{G as default};
