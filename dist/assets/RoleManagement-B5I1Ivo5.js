import{a3 as H,r as n,j as e,S as V,x as G,w as p,p as f,t as y}from"./index-dV4Uttrq.js";import{P as J}from"./plus-DUZUgypq.js";import{C as K}from"./circle-alert-DNo9lQw-.js";import{S as j}from"./shield-C30kT5RY.js";import{C as m}from"./circle-check-big-BTbhA0uw.js";import{L as R}from"./loader-circle-BpaB5MSO.js";import{C as T}from"./circle-x-CrdKUO8e.js";import{P as W}from"./pen-CLgwwYNd.js";import{T as Q}from"./trash-2-B2VV2ZDP.js";function ne(){const{adminUser:v,accessToken:d}=H(),[N,I]=n.useState(""),[w,P]=n.useState("all"),[k,$]=n.useState("all"),[L,h]=n.useState(!1),[l,u]=n.useState(null),[A,S]=n.useState(!0),[i,g]=n.useState(!1),[x,F]=n.useState([]),[B,X]=n.useState([]),[D,c]=n.useState(null),[r,o]=n.useState({name:"",description:"",type:"custom",clientId:"",permissions:[],isActive:!0});n.useEffect(()=>{l&&o({name:l.name,description:l.description,type:l.type,clientId:l.clientId||"",permissions:l.permissions||[],isActive:l.isActive})},[l]);const z=async()=>{try{const s=await fetch(`https://${p}.supabase.co/functions/v1/make-server-6fcaeea3/permissions`,{headers:{Authorization:`Bearer ${f}`,"X-Access-Token":d||"","X-Environment-ID":"development"}});if(!s.ok){const a=await s.json().catch(()=>({error:"Unknown error"}));throw new Error(a.error||"Failed to fetch permissions")}const t=await s.json();X(t.permissions||[])}catch(s){console.error("Error fetching permissions:",s),c(s.message)}},C=async()=>{S(!0),c(null);try{const s=await fetch(`https://${p}.supabase.co/functions/v1/make-server-6fcaeea3/roles`,{headers:{Authorization:`Bearer ${f}`,"X-Access-Token":d||"","X-Environment-ID":"development"}});if(!s.ok){const a=await s.json().catch(()=>({error:"Unknown error"}));throw new Error(a.error||"Failed to fetch roles")}const t=await s.json();F(t.roles||[])}catch(s){console.error("Error fetching roles:",s),c(s.message)}finally{S(!1)}};n.useEffect(()=>{d&&(z(),C())},[d]);const M=async()=>{if(!r.name||!r.type){alert("Please fill in all required fields");return}if(r.type==="custom"&&!r.clientId){alert("Custom roles must have a client ID");return}g(!0),c(null);try{const s=l?`https://${p}.supabase.co/functions/v1/make-server-6fcaeea3/roles/${l.id}`:`https://${p}.supabase.co/functions/v1/make-server-6fcaeea3/roles`,t=l?"PUT":"POST",a={name:r.name,description:r.description,type:r.type,clientId:r.type==="custom"?r.clientId:null,permissions:r.permissions,isActive:r.isActive},b=await fetch(s,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`,"X-Access-Token":d||"","X-Environment-ID":"development"},body:JSON.stringify(a)});if(!b.ok){const _=await b.json();throw new Error(_.error||`Failed to ${l?"update":"create"} role`)}y.success(`Role ${l?"updated":"created"} successfully!`),h(!1),u(null),o({name:"",description:"",type:"custom",clientId:"",permissions:[],isActive:!0}),await C()}catch(s){console.error("Error saving role:",s),c(s.message),y.error(`Error: ${s.message}`)}finally{g(!1)}},q=async s=>{if(confirm(`Are you sure you want to delete the role "${s.name}"? This action cannot be undone.`)){g(!0),c(null);try{const t=await fetch(`https://${p}.supabase.co/functions/v1/make-server-6fcaeea3/roles/${s.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${f}`,"X-Access-Token":d||"","X-Environment-ID":"development"}});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to delete role")}y.success("Role deleted successfully!"),await C()}catch(t){console.error("Error deleting role:",t),c(t.message),y.error(`Error: ${t.message}`)}finally{g(!1)}}},O=s=>{o(t=>({...t,permissions:t.permissions.includes(s)?t.permissions.filter(a=>a!==s):[...t.permissions,s]}))},E=x.filter(s=>{const t=s.name.toLowerCase().includes(N.toLowerCase())||s.description.toLowerCase().includes(N.toLowerCase()),a=w==="all"||s.type===w,b=k==="all"||(k==="active"?s.isActive:!s.isActive);return t&&a&&b}),U=B.reduce((s,t)=>(s[t.category]||(s[t.category]=[]),s[t.category].push(t),s),{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Role Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Define what actions users can perform on resources"})]}),e.jsxs("button",{onClick:()=>h(!0),disabled:i,className:"inline-flex items-center gap-2 bg-[#D91C81] text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-[#B71569] transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(J,{className:"w-5 h-5"}),"Add Role"]})]}),D&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(K,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-orange-900",children:"Error"}),e.jsx("p",{className:"text-orange-800 text-sm",children:D})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-2",children:"Understanding Roles"}),e.jsxs("p",{className:"text-gray-700 mb-3",children:[e.jsx("strong",{children:"Roles define WHAT users can DO"})," within components they have access to."]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Predefined Roles:"}),' System-wide roles like "Employee", "Manager", "VP", "HR Admin" that apply across all clients']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Custom Roles:"})," Client-specific roles tailored to unique organizational needs"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Multiple Roles:"}),' Employees can have multiple roles (e.g., "Employee" + "Manager")']})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Example:"}),' A manager with "view_team_orders" permission can see data for employees reporting to them']})]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search roles...",value:N,onChange:s=>I(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none"})]}),e.jsxs("select",{value:w,onChange:s=>P(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"predefined",children:"Predefined Roles"}),e.jsx("option",{value:"custom",children:"Custom Roles"})]}),e.jsxs("select",{value:k,onChange:s=>$(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Roles"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Active Roles"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x.filter(s=>s.isActive).length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Predefined Roles"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:x.filter(s=>s.type==="predefined").length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Custom Roles"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:x.filter(s=>s.type==="custom").length})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:A?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(R,{className:"w-8 h-8 text-[#D91C81] animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading roles..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Role Name"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Permissions"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:E.map(s=>{var t,a;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold ${s.type==="predefined"?"bg-purple-100 text-purple-800 border border-purple-200":"bg-blue-100 text-blue-800 border border-blue-200"}`,children:[s.type==="predefined"?e.jsx(j,{className:"w-3 h-3"}):e.jsx(G,{className:"w-3 h-3"}),s.type==="predefined"?"Predefined":"Custom"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-sm text-gray-900",children:[((t=s.permissions)==null?void 0:t.length)||0," permission",((a=s.permissions)==null?void 0:a.length)!==1?"s":""]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold ${s.isActive?"bg-green-100 text-green-800 border border-green-200":"bg-gray-100 text-gray-800 border border-gray-200"}`,children:[s.isActive?e.jsx(m,{className:"w-3 h-3"}):e.jsx(T,{className:"w-3 h-3"}),s.isActive?"Active":"Inactive"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(s),disabled:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Edit Role",children:e.jsx(W,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>q(s),disabled:i,className:"p-2 hover:bg-red-50 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Role",children:e.jsx(Q,{className:"w-4 h-4 text-red-600"})})]})})]},s.id)})})]})}),E.length===0&&!A&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No roles found matching your filters."})]})]})}),(L||l)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto my-8",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:l?"Edit Role":"Add New Role"}),e.jsx("button",{onClick:()=>{h(!1),u(null),o({name:"",description:"",type:"custom",clientId:"",permissions:[],isActive:!0})},disabled:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(T,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-purple-600"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>o({...r,name:s.target.value}),placeholder:"e.g., Manager, VP, Team Lead",disabled:i,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none disabled:opacity-50 disabled:cursor-not-allowed",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type *"}),e.jsxs("select",{value:r.type,onChange:s=>o({...r,type:s.target.value}),disabled:i||(l==null?void 0:l.type)==="predefined",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"custom",children:"Custom (Client-specific)"}),(v==null?void 0:v.role)==="super_admin"&&e.jsx("option",{value:"predefined",children:"Predefined (System-wide)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:s=>o({...r,description:s.target.value}),placeholder:"Describe what this role represents...",disabled:i,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none disabled:opacity-50 disabled:cursor-not-allowed"})]}),r.type==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Client ID * (for custom roles)"}),e.jsx("input",{type:"text",value:r.clientId,onChange:s=>o({...r,clientId:s.target.value}),placeholder:"Enter client ID",disabled:i,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none disabled:opacity-50 disabled:cursor-not-allowed",required:!0})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:r.isActive,onChange:s=>o({...r,isActive:s.target.checked}),disabled:i,className:"w-4 h-4 text-[#D91C81] border-gray-300 rounded focus:ring-pink-100 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-900 cursor-pointer",children:"Active (role can be assigned to employees)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-green-600"}),"Permissions (",r.permissions.length," selected)"]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"Select permissions"})," that define what actions users with this role can perform. These permissions work within the components that users have access to via their Access Groups."]})}),Object.entries(U).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 capitalize",children:[s," Permissions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.map(a=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:a.id,checked:r.permissions.includes(a.id),onChange:()=>O(a.id),disabled:i,className:"mt-1 w-4 h-4 text-[#D91C81] border-gray-300 rounded focus:ring-pink-100 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:a.id,className:"block text-sm font-medium text-gray-900 cursor-pointer",children:a.description}),e.jsxs("p",{className:"text-xs text-gray-600",children:[a.resource,".",a.action]})]})]},a.id))})]},s))]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>{h(!1),u(null),o({name:"",description:"",type:"custom",clientId:"",permissions:[],isActive:!0})},disabled:i,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-100 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsxs("button",{onClick:M,disabled:i,className:"px-4 py-2 bg-[#D91C81] text-white rounded-lg font-semibold hover:bg-[#B71569] transition-all disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",children:[i&&e.jsx(R,{className:"w-4 h-4 animate-spin"}),l?"Save Changes":"Create Role"]})]})]})})]})}export{ne as RoleManagement};
