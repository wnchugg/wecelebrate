import{r as m,j as e,a5 as $,D as B,ad as S,w as x,p}from"./index-DHDOl0g2.js";import{a as H,s as U}from"./errorHandling-cB_D8Kf8.js";import{C as z}from"./circle-check-big-BYmGA9PQ.js";import{C as J}from"./circle-x-DNt9TFja.js";import{C as q}from"./circle-alert-HchCeVzY.js";import{F as P}from"./file-text-D58_PMPW.js";function V(){var f,N,v,k,w,C,T,R,A,E,D,G;const[u,b]=m.useState(!1),[g,j]=m.useState(!1),[s,F]=m.useState(null),y=async()=>{b(!0);const t=S(),r=`https://${x}.supabase.co/functions/v1/make-server-6fcaeea3`,n={environment:{projectId:x,baseUrl:r,hasToken:!!t,token:t?`${t.substring(0,20)}...`:"No token"},endpoints:{}},d=[{name:"Health Check",url:`${r}/health`,method:"GET",requiresAuth:!1},{name:"Get Clients",url:`${r}/clients`,method:"GET",requiresAuth:!0},{name:"Get Sites",url:`${r}/sites`,method:"GET",requiresAuth:!0},{name:"Get Gifts",url:`${r}/gifts`,method:"GET",requiresAuth:!0},{name:"Check Admin",url:`${r}/debug/check-admin-users`,method:"GET",requiresAuth:!1}];for(const i of d)try{const a={"Content-Type":"application/json"};i.requiresAuth&&t?(a["X-Access-Token"]=t,a.Authorization=`Bearer ${p}`):a.Authorization=`Bearer ${p}`;const c=await fetch(i.url,{method:i.method,headers:a});let l=null,h=null,o="";try{o=await c.text(),o&&(l=JSON.parse(o))}catch(I){h=`JSON parse error: ${I.message}`,l={raw:o,parseError:h}}n.endpoints[i.name]={status:c.status,ok:c.ok,data:l,error:h}}catch(a){n.endpoints[i.name]={status:0,ok:!1,error:a instanceof Error?a.message:"Unknown error"}}F(n),b(!1)},O=async()=>{j(!0);try{const t=S(),r=`https://${x}.supabase.co/functions/v1/make-server-6fcaeea3`,n=await fetch(`${r}/data/reseed`,{method:"POST",headers:{"Content-Type":"application/json","X-Access-Token":t||"",Authorization:`Bearer ${p}`}});if(n.ok)H("Database Reseeded","Sample data recreated successfully"),setTimeout(()=>{y()},1e3);else{const d=await n.json().catch(()=>({error:"Unknown error"}));U(new Error(d.error||`Server returned ${n.status}`),{operation:"reseed"})}}catch(t){console.error("[Reseed] Network error:",t),U("Network error: "+(t instanceof Error?t.message:"Unknown error"))}finally{j(!1)}};return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Data Diagnostic"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Check backend connectivity and data availability"})]}),e.jsx("button",{onClick:y,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-[#D91C81] hover:bg-[#B01669] text-white rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 animate-spin"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4"}),"Run Diagnostic"]})})]}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Environment"}),e.jsxs("div",{className:"space-y-2 font-mono text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Project ID:"})," ",s.environment.projectId]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Base URL:"})," ",s.environment.baseUrl]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Has Auth Token:"})," ",s.environment.hasToken?"✅ Yes":"❌ No"]}),s.environment.hasToken&&e.jsxs("div",{children:[e.jsx("strong",{children:"Token:"})," ",s.environment.token]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Endpoint Tests"}),e.jsx("div",{className:"space-y-4",children:Object.entries(s.endpoints).map(([t,r])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[r.ok?e.jsx(z,{className:"w-5 h-5 text-green-600"}):e.jsx(J,{className:"w-5 h-5 text-red-600"}),t]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${r.ok?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.status||"Network Error"})]}),r.error&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-2",children:e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Error:"})," ",r.error]})}),r.data&&e.jsx("div",{className:"bg-gray-50 rounded p-3 overflow-auto max-h-96",children:e.jsx("pre",{className:"text-xs",children:JSON.stringify(r.data,null,2)})})]},t))})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(q,{className:"w-6 h-6 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Quick Diagnosis"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[!s.environment.hasToken&&e.jsx("p",{children:"⚠️ No auth token found. Please log in to admin first."}),((f=s.endpoints["Health Check"])==null?void 0:f.ok)===!1&&e.jsx("p",{children:"❌ Backend is not responding. The function may not be deployed."}),((N=s.endpoints["Health Check"])==null?void 0:N.ok)&&!((v=s.endpoints["Get Clients"])!=null&&v.ok)&&e.jsx("p",{children:"⚠️ Backend is running but authentication is failing. Check your credentials."}),((C=(w=(k=s.endpoints["Get Clients"])==null?void 0:k.data)==null?void 0:w.clients)==null?void 0:C.length)===0&&e.jsx("p",{children:"⚠️ Backend is working but database is empty. Run the reseed endpoint."}),((A=(R=(T=s.endpoints["Get Clients"])==null?void 0:T.data)==null?void 0:R.clients)==null?void 0:A.length)>0&&e.jsxs("p",{children:["✅ Backend is working and has ",s.endpoints["Get Clients"].data.clients.length," clients!"]})]})]})]})}),e.jsx("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(P,{className:"w-6 h-6 text-cyan-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-cyan-900 mb-2",children:"ℹ️ About the 11 Migrated Resources"}),e.jsxs("p",{className:"text-sm text-cyan-800 mb-3",children:["Your backend supports ",e.jsx("strong",{children:"11 different resource types"})," with full CRUD operations (Create, Read, Update, Delete, List):"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 text-xs mb-3",children:[e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"1. Clients"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"2. Sites"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"3. Gifts"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"4. Orders"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"5. Employees"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"6. Admin Users"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"7. Roles"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"8. Access Groups"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"9. Celebrations"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"10. Email Templates"}),e.jsx("div",{className:"bg-white rounded px-2 py-1 border border-cyan-200",children:"11. Brands"})]}),e.jsxs("p",{className:"text-sm text-cyan-800",children:["The seed data creates ",e.jsx("strong",{children:"4 sample clients"})," along with associated sites, gifts, and other data for each resource type. This provides a complete demo dataset for testing your gifting platform."]})]})]})}),((G=(D=(E=s.endpoints["Get Clients"])==null?void 0:E.data)==null?void 0:D.clients)==null?void 0:G.length)===0&&e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:O,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-[#D91C81] hover:bg-[#B01669] text-white rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:g?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 animate-spin"}),"Reseeding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4"}),"Reseed Database"]})})})]}),!s&&e.jsxs("div",{className:"bg-gray-50 rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:'Click "Run Diagnostic" to test backend connectivity and data availability'})]})]})}export{V as DataDiagnostic};
