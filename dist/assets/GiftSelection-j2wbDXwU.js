import{u as M,a as U,b as T,q as V,r,c as X,E as q,F as Q,j as e,S as F,X as _,t as b,l as y,g as K,k as O}from"./index-BKvtyMRF.js";function se(){const g=M(),{siteId:j}=U(),{currentSite:u}=T(),{currentSite:h}=V(),[P,w]=r.useState(null),{t:n}=X(),[o,$]=r.useState([]),[Y,L]=r.useState(null),[x,N]=r.useState([]),[S,C]=r.useState(!0),[c,k]=r.useState(""),[d,E]=r.useState("all"),[f,I]=r.useState("name"),[Z,J]=r.useState(!1),[A,p]=r.useState(null),t=q(Q,h==null?void 0:h.giftSelectionConfig),R=["all",...Array.from(new Set(o.map(s=>s.category)))],B=o.length>10;r.useEffect(()=>{(async()=>{C(!0),p(null);try{const a=sessionStorage.getItem("employee_session"),l=sessionStorage.getItem("site_id"),i=j||l||(u==null?void 0:u.id);if(!i){b.error("No site specified. Please navigate from a valid site link."),g("/access");return}if(a||y.warn("[SECURITY] Accessing gifts without session validation - Demo mode"),a&&l&&l!==i){b.error("Invalid site access. Please validate for the correct site."),g(`/access?site=${i}`);return}const v=K(),H=O(v),D=await fetch(`${H}/public/sites/${i}/gifts`,{headers:{Authorization:`Bearer ${v.supabaseAnonKey}`,"X-Environment-ID":v.id,...a?{"X-Session-Token":a}:{}}}),m=await D.json();if(!D.ok)throw new Error(m.error||"Failed to load gifts");$(m.gifts||[]),N(m.gifts||[]),L(m.site),m.gifts.length===0&&(p("No gifts have been assigned to this site yet. Please go to Admin → Site Gifts to assign gifts."),y.warn("[GiftSelection] No gifts assigned to site:",i))}catch(a){y.error("Failed to load gifts:",a),p(t.messages.error),b.error(a instanceof Error?a.message:t.messages.error)}finally{C(!1)}})()},[g,j,u,t.messages]),r.useEffect(()=>{let s=[...o];if(d!=="all"&&(s=s.filter(a=>a.category===d)),c.trim()){const a=c.toLowerCase();s=s.filter(l=>l.name.toLowerCase().includes(a)||l.description.toLowerCase().includes(a)||l.category.toLowerCase().includes(a)||l.features.some(i=>i.toLowerCase().includes(a)))}switch(f){case"name":s.sort((a,l)=>a.name.localeCompare(l.name));break;case"value-asc":s.sort((a,l)=>a.value-l.value);break;case"value-desc":s.sort((a,l)=>l.value-a.value);break}N(s)},[o,c,d,f]);const z=s=>{g(`/gift-detail/${s}`)},G=()=>{k(""),E("all"),I("name")};return S?e.jsx("div",{className:"min-h-[calc(100vh-4rem)] py-12 px-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-[#D91C81] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:n("gifts.loadingGifts")})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"py-8 sm:py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-12",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-4",children:n("gifts.title")}),e.jsx("p",{className:"text-base sm:text-lg text-gray-600 max-w-2xl mx-auto",children:n("gifts.curatedSelection")}),o&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[o.length," ",o.length!==1?n("gifts.giftsAvailablePlural"):n("gifts.giftsAvailable")]})]}),(t.search.enabled||t.filters.enabled||t.sorting.enabled)&&B&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.search.enabled&&e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(F,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:c,onChange:s=>k(s.target.value),className:"w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none",placeholder:t.search.placeholder})]}),t.filters.enabled&&t.filters.categories.enabled&&e.jsx("div",{className:"lg:w-56",children:e.jsx("select",{value:d,onChange:s=>E(s.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none appearance-none bg-white",children:R.map(s=>e.jsx("option",{value:s,children:s==="all"?"All Categories":s},s))})}),t.sorting.enabled&&e.jsx("div",{className:"lg:w-52",children:e.jsxs("select",{value:f,onChange:s=>I(s.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#D91C81] focus:ring-4 focus:ring-pink-100 transition-all outline-none appearance-none bg-white",children:[e.jsx("option",{value:"name",children:"Sort: A-Z"}),e.jsx("option",{value:"value-asc",children:"Sort: Value Low-High"}),e.jsx("option",{value:"value-desc",children:"Sort: Value High-Low"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold text-gray-900",children:x.length})," of"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:o.length})," gifts"]}),(c||d!=="all"||f!=="name")&&e.jsxs("button",{onClick:G,className:"flex items-center gap-2 text-[#D91C81] hover:text-[#B71569] font-medium text-sm transition-colors",children:[e.jsx(_,{className:"w-4 h-4"}),"Clear Filters"]})]})]}),x.length===0&&!S&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-12 text-center",children:[e.jsx(F,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Gifts Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:A||t.messages.noResults}),!A&&e.jsx("button",{onClick:G,className:"inline-flex items-center gap-2 bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Clear All Filters"})]}),x.length>0&&e.jsx("div",{className:`grid gap-4 sm:gap-6 ${t.layout.style==="grid"?`sm:grid-cols-2 ${t.layout.itemsPerRow===2?"lg:grid-cols-2":t.layout.itemsPerRow===3?"lg:grid-cols-3":t.layout.itemsPerRow===4?"lg:grid-cols-4":t.layout.itemsPerRow===5?"lg:grid-cols-5":t.layout.itemsPerRow===6?"lg:grid-cols-6":"lg:grid-cols-3"}`:t.layout.style==="list"?"grid-cols-1":"sm:grid-cols-2 lg:grid-cols-3"}`,children:x.map(s=>{const a=P===s.id,l=t.display.hoverEffect==="lift"?"hover:scale-[1.02]":t.display.hoverEffect==="zoom"?"hover:scale-[1.05]":"";return e.jsx("div",{className:`bg-white rounded-2xl overflow-hidden shadow-lg transition-all duration-300 hover:shadow-2xl ${l}`,children:e.jsxs("button",{onClick:()=>z(s.id),onMouseEnter:()=>w(s.id),onMouseLeave:()=>w(null),className:"w-full text-left focus:outline-none focus:ring-4 focus:ring-[#D91C81] focus:ring-offset-2 rounded-2xl",children:[e.jsxs("div",{className:`relative overflow-hidden bg-gray-100 ${t.display.imageAspectRatio==="1:1"?"h-64":t.display.imageAspectRatio==="4:3"?"h-48":t.display.imageAspectRatio==="16:9"?"h-40":"h-64"}`,children:[e.jsx("img",{src:s.imageUrl,alt:s.name,className:`w-full h-full object-cover transition-transform duration-500 ${a&&t.display.hoverEffect==="zoom"?"scale-110":"scale-100"}`,loading:"lazy"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"inline-block bg-white/90 backdrop-blur-sm text-[#D91C81] px-3 py-1 rounded-full text-xs font-semibold",children:s.category})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:s.description}),t.display.showPrices&&s.value&&e.jsxs("p",{className:"text-sm font-semibold text-gray-900 mb-2",children:["$",s.value.toFixed(2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm font-semibold ${a?"text-[#D91C81]":"text-gray-700"} transition-colors`,children:"View Details →"}),t.display.showInventory&&(s.available?e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"In Stock"}):e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Out of Stock"}))]})]})]})},s.id)})})]})})})}export{se as GiftSelection};
