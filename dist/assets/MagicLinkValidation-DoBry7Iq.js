import{u as f,d as y,o as b,r as o,j as e,L as c,i,g as j,k as v,l as N}from"./index-DAep3-17.js";import{L as w}from"./Logo-Dxshdthc.js";import{L as u}from"./loader-circle-DZ1z-CmB.js";import{C as k}from"./circle-check-big-Dewj6UrC.js";import{C as _}from"./circle-x-BFN1fzT3.js";function P(){const d=f(),{authenticate:m}=y(),[x]=b(),[r,t]=o.useState("validating"),[h,n]=o.useState("");return o.useEffect(()=>{(async()=>{const l=x.get("token");if(!l){t("error"),n("No access token provided. Please request a new magic link."),i({action:"magic_link_validation_failed",status:"failure",details:{reason:"missing_token"}});return}try{const a=j(),p=v(a),g=await fetch(`${p}/public/validate/magic-link`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.supabaseAnonKey}`,"X-Environment-ID":a.id},body:JSON.stringify({token:l})}),s=await g.json();if(!g.ok||!s.valid){t("error"),n(s.error||"Invalid or expired magic link. Please request a new one."),i({action:"magic_link_validation_failed",status:"failure",details:{reason:s.error||"invalid",token:l}});return}sessionStorage.setItem("employee_session",s.sessionToken),sessionStorage.setItem("employee_name",s.employee.name||""),sessionStorage.setItem("employee_email",s.employee.email||""),sessionStorage.setItem("employee_id",s.employee.id||""),sessionStorage.setItem("site_id",s.siteId||""),i({action:"magic_link_validation_success",userId:s.employee.email,status:"success",details:{employeeId:s.employee.id,siteId:s.siteId}}),m(s.employee.email),t("success"),setTimeout(()=>{d("/gift-selection")},1500)}catch(a){N.error("Magic link validation error:",a),t("error"),n("Failed to validate magic link. Please try again."),i({action:"magic_link_validation_failed",status:"failure",details:{reason:"network_error",error:a.message}})}})()},[x,d,m]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#00E5A0] via-[#0066CC] via-[#D91C81] to-[#1B2A5E]",children:[e.jsx("header",{className:"px-4 sm:px-6 lg:px-8 py-6",role:"banner",children:e.jsx("div",{className:"max-w-7xl mx-auto flex items-center justify-center",children:e.jsx(c,{to:"/",className:"h-10 w-[110px] focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-transparent rounded","aria-label":"Return to homepage",children:e.jsx("div",{className:"h-10 w-[110px]",style:{filter:"brightness(0) invert(1)"},role:"img","aria-label":"HALO Logo",children:e.jsx(w,{})})})})}),e.jsx("div",{className:"flex items-center justify-center px-4 py-12",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-8 md:p-10 text-center",style:{boxShadow:"0 8px 32px rgba(0, 0, 0, 0.16)"},children:[r==="validating"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(u,{className:"w-9 h-9 text-blue-600 animate-spin"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Validating Access"}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we verify your magic link..."})]}),r==="success"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(k,{className:"w-9 h-9 text-green-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Access Granted!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Your magic link has been validated successfully."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[#D91C81]",children:[e.jsx(u,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"font-semibold",children:"Redirecting to gift selection..."})]})]}),r==="error"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(_,{className:"w-9 h-9 text-red-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-6",children:h}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{to:"/access/magic-link-request",className:"block w-full bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all",style:{boxShadow:"0 4px 12px rgba(217, 28, 129, 0.3)"},children:"Request New Magic Link"}),e.jsx(c,{to:"/",className:"block w-full px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all",children:"Back to Home"})]})]})]}),e.jsx("p",{className:"text-center text-white/90 text-sm mt-6",children:"Need help? Contact your administrator or HR department"})]})})]})}export{P as MagicLinkValidation};
