import{u as $,o as H,r as t,j as e,L as h,l as n,a4 as N}from"./index-Cwl2suO6.js";import{E as p,A as J}from"./Alert-COmI8_IZ.js";import{B as g,l as b}from"./frontendSecurity-BvuJbT0U.js";import{a as Y,s as G}from"./errorHandling-zZ-_R609.js";import{L as y}from"./loader-circle-Cneib8HD.js";import{C as M}from"./circle-x-CkzBQSmo.js";import{C as P}from"./circle-check-big-DqFW6Yzj.js";import{S as X}from"./shield-D2ZDyDg1.js";import{C as Z}from"./circle-alert-GQfJtxRP.js";import{L as C}from"./lock-B-e9vPYK.js";import{E as k}from"./eye-off-Xtc09Bzc.js";import{E as S}from"./eye-Bh609TOw.js";import"./badge-CVvH5yJO.js";import"./info-CtBSPjLx.js";function ce(){const E=$(),[R]=H(),d=R.get("token"),[i,B]=t.useState(""),[c,T]=t.useState(""),[m,D]=t.useState(!1),[x,L]=t.useState(!1),[l,j]=t.useState(!1),[A,v]=t.useState(!0),[O,u]=t.useState(!1),[z,I]=t.useState(!1),[f,o]=t.useState(""),[a,w]=t.useState({});t.useEffect(()=>{(async()=>{if(!d){u(!1),v(!1),o("No reset token provided");return}try{n.info("[ResetPassword] Validating token"),await N("/admin/validate-reset-token",{method:"POST",body:JSON.stringify({token:d})}),u(!0),n.info("[ResetPassword] Token is valid")}catch(r){n.error("[ResetPassword] Token validation failed:",r),u(!1),o("Invalid or expired reset token"),b({type:"invalid_reset_token",details:"Invalid password reset token used",severity:"medium"})}finally{v(!1)}})()},[d]);const V=s=>s.length<8?"Password must be at least 8 characters":/[A-Z]/.test(s)?/[a-z]/.test(s)?/[0-9]/.test(s)?/[!@#$%^&*(),.?":{}|<>]/.test(s)?null:"Password must contain at least one special character":"Password must contain at least one number":"Password must contain at least one lowercase letter":"Password must contain at least one uppercase letter",F=()=>{const s={};if(!i)s.password="Password is required";else{const r=V(i);r&&(s.password=r)}return c?i!==c&&(s.confirmPassword="Passwords do not match"):s.confirmPassword="Please confirm your password",w(s),Object.keys(s).length===0},_=async s=>{if(s.preventDefault(),o(""),n.info("[ResetPassword] Attempting password reset"),!!F()){if(!d){o("No reset token provided");return}j(!0);try{await N("/admin/reset-password",{method:"POST",body:JSON.stringify({token:d,newPassword:i})}),n.info("[ResetPassword] Password reset successful"),I(!0),Y("Password reset successfully!"),b({type:"password_reset_success",details:"Admin password reset completed",severity:"low"}),setTimeout(()=>{E("/admin/login")},3e3)}catch(r){n.error("[ResetPassword] Error:",r);const q=r.message||"Failed to reset password. Please try again.";o(q),G(r),b({type:"password_reset_error",details:`Password reset error: ${r.message}`,severity:"high"})}finally{j(!1)}}};return A?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#1B2A5E] via-[#D91C81] to-[#00B4CC] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-12 h-12 text-white animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg",children:"Validating reset token..."})]})}):O?z?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#1B2A5E] via-[#D91C81] to-[#00B4CC] flex items-center justify-center p-6",children:[e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx(p,{})}),e.jsx("div",{className:"fixed top-4 left-4 z-50",children:e.jsx(g,{})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-8 md:p-12 max-w-md w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:e.jsx(P,{className:"w-8 h-8 text-green-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Password Reset Complete!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your password has been successfully updated. You can now log in with your new password."}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Redirecting to login page in 3 seconds..."})}),e.jsx(h,{to:"/admin/login",className:"block w-full bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white py-3 px-4 rounded-lg font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all text-center",children:"Go to Login Now"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#1B2A5E] via-[#D91C81] to-[#00B4CC] flex items-center justify-center p-6",children:[e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx(p,{})}),e.jsx("div",{className:"fixed top-4 left-4 z-50",children:e.jsx(g,{})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 md:p-12 max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-[#D91C81] to-[#B71569] rounded-full mb-4",children:e.jsx(X,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Set New Password"}),e.jsx("p",{className:"text-gray-600",children:"Create a strong password for your account"})]}),f&&e.jsx(J,{variant:"error",title:"Error",message:f,className:"mb-6"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Password Requirements:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"At least 8 characters long"}),e.jsx("li",{children:"One uppercase letter"}),e.jsx("li",{children:"One lowercase letter"}),e.jsx("li",{children:"One number"}),e.jsx("li",{children:"One special character (!@#$%^&*)"})]})]})]})}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"password",type:m?"text":"password",value:i,onChange:s=>{B(s.target.value),w({...a,password:void 0}),o("")},placeholder:"••••••••",autoComplete:"new-password",disabled:l,className:`w-full pl-12 pr-12 py-3 border ${a.password?"border-red-300":"border-gray-300"} rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent transition-all disabled:bg-gray-100 disabled:cursor-not-allowed`}),e.jsx("button",{type:"button",onClick:()=>D(!m),disabled:l,className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 disabled:cursor-not-allowed","aria-label":m?"Hide password":"Show password",children:m?e.jsx(k,{className:"h-5 w-5"}):e.jsx(S,{className:"h-5 w-5"})})]}),a.password&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:a.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"confirmPassword",type:x?"text":"password",value:c,onChange:s=>{T(s.target.value),w({...a,confirmPassword:void 0}),o("")},placeholder:"••••••••",autoComplete:"new-password",disabled:l,className:`w-full pl-12 pr-12 py-3 border ${a.confirmPassword?"border-red-300":"border-gray-300"} rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent transition-all disabled:bg-gray-100 disabled:cursor-not-allowed`}),e.jsx("button",{type:"button",onClick:()=>L(!x),disabled:l,className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 disabled:cursor-not-allowed","aria-label":x?"Hide password":"Show password",children:x?e.jsx(k,{className:"h-5 w-5"}):e.jsx(S,{className:"h-5 w-5"})})]}),a.confirmPassword&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:a.confirmPassword})]}),e.jsx("button",{type:"submit",disabled:l||!i||!c,className:"w-full bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white py-3 px-4 rounded-lg font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:shadow-none flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-5 h-5 animate-spin"}),"Resetting Password..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-5 w-5"}),"Reset Password"]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Remember your password?"," ",e.jsx(h,{to:"/admin/login",className:"text-[#D91C81] hover:text-[#B71569] font-medium",children:"Sign in"})]})})]})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#1B2A5E] via-[#D91C81] to-[#00B4CC] flex items-center justify-center p-6",children:[e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx(p,{})}),e.jsx("div",{className:"fixed top-4 left-4 z-50",children:e.jsx(g,{})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-8 md:p-12 max-w-md w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4",children:e.jsx(M,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Invalid Reset Link"}),e.jsx("p",{className:"text-gray-600 mb-6",children:f||"This password reset link is invalid or has expired."}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-sm text-amber-800",children:"Reset links expire after 1 hour for security reasons. Please request a new one."})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(h,{to:"/admin/forgot-password",className:"block w-full bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white py-3 px-4 rounded-lg font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all text-center",children:"Request New Reset Link"}),e.jsx(h,{to:"/admin/login",className:"block w-full bg-white text-gray-700 py-3 px-4 rounded-lg font-medium border border-gray-300 hover:bg-gray-50 transition-colors text-center",children:"Back to Login"})]})]})})]})}export{ce as default};
