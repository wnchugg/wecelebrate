import{f as z,u as W,a1 as U,q as le,r as i,j as e,X as ce,Y as f,a6 as S,x as H,G as D,L as g,B as q,D as X,a7 as de,a8 as me,a9 as he,N as xe,aa as fe,ab as ge,ac as pe}from"./index-CYlZQa06.js";import{D as ue}from"./DeploymentEnvironmentSelector-IeePGWhj.js";import{L as B,A as be}from"./layout-dashboard-HbkL1GuR.js";import{F as Y}from"./folder-open-CUWH_rsD.js";import{B as je}from"./bell-BvQUDIn_.js";import{S as we}from"./shopping-cart-D2pYujIp.js";import{U as _}from"./users-0-HXAxu8.js";import{C as J}from"./chart-column-p5C7Vsoj.js";import{G as ve}from"./gift-Dzn_XYWR.js";import{G as Ne}from"./git-branch-ByElQ-M7.js";import{P as ye}from"./panels-top-left-y_bM64tT.js";import{M as I}from"./mail-Btt_E8CL.js";import{S as A}from"./shield-_WEmX3g3.js";import{F as L}from"./file-text-DqnWOcoQ.js";import{W as Ce}from"./wrench-yfPOo3id.js";import{A as Se}from"./activity-B7tbWUwn.js";import{T as De}from"./test-tube-diagonal-CP2zWgcH.js";import{L as Ae}from"./loader-circle-DOINguM6.js";import"./server-CljMEZvi.js";const Le="https://figma-alpha-api.s3.us-west-2.amazonaws.com/images/212120daf4ca7893a2036877eb5d3cdd4c0ad83f.png",$=[{name:"Dashboard",href:"/admin/client-dashboard",icon:B},{name:"Client Settings",href:"/admin/clients",icon:H},{name:"Employee Management",href:"/admin/employees",icon:_},{name:"Reports",href:"/admin/reports",icon:J},{name:"All Clients",href:"/admin/clients",icon:q}],P=[{name:"Gift Catalog",href:"/admin/gifts",icon:ve},{name:"Catalog Management",href:"/admin/catalogs",icon:Y},{name:"Catalog Migration",href:"/admin/catalogs/migrate",icon:Ne},{name:"Home Page Editor",href:"/admin/home-editor",icon:ye},{name:"Global Template Library",href:"/admin/global-template-library",icon:I},{name:"Email Service Test",href:"/admin/email-service-test",icon:I},{name:"ERP Integrations",href:"/admin/erp",icon:X},{name:"Analytics",href:"/admin/analytics",icon:J},{name:"Admin Users",href:"/admin/user-management",icon:A},{name:"RBAC Overview",href:"/admin/rbac-overview",icon:A},{name:"Roles",href:"/admin/roles",icon:A},{name:"Access Groups",href:"/admin/access-groups",icon:_},{name:"Import/Export Settings",href:"/admin/import-export-settings",icon:be},{name:"Application Documentation",href:"/admin/application-documentation",icon:L}],R=[{name:"Admin Dashboard",href:"/admin/system-dashboard",icon:B},{name:"Developer Tools",href:"/admin/developer-tools",icon:Se},{name:"Testing Dashboard",href:"/admin/testing-dashboard",icon:De},{name:"Test Data Reference",href:"/admin/test-data-reference",icon:L},{name:"Development Documentation",href:"/admin/development-documentation",icon:L},{name:"Audit Logs",href:"/admin/audit-logs",icon:L}],M=[{name:"Site Dashboard",href:"/admin/dashboard",icon:B},{name:"Site Configuration",href:"/admin/site-configuration",icon:H},{name:"Site Catalog",href:"/admin/site-catalog-configuration",icon:Y},{name:"Notifications",href:"/admin/email-notification-configuration",icon:je},{name:"Order Management",href:"/admin/orders",icon:we},{name:"All Sites",href:"/admin/sites",icon:D}];function ke(){var O,T,F;const c=z(),k=W(),{adminUser:d,adminLogout:K}=U(),{currentSite:n,currentClient:a,sites:o,clients:m,setCurrentSite:Q,setCurrentClient:Ee,getClientById:V,isLoading:p}=le(),[u,j]=i.useState(!1),[l,h]=i.useState(!1);i.useEffect(()=>{console.warn("[AdminLayout] Sites/Clients state:",{sitesCount:o.length,clientsCount:m.length,currentSite:n==null?void 0:n.name,currentClient:a==null?void 0:a.name,isLoading:p,sites:o.map(t=>({id:t.id,name:t.name,clientId:t.clientId})),clients:m.map(t=>({id:t.id,name:t.name}))})},[o,m,n,a,p]);const[Be,Oe]=i.useState(!1),[b,Z]=i.useState("all"),[w,ee]=i.useState(!0),[v,te]=i.useState(!0),[N,se]=i.useState(!0),[y,ae]=i.useState(!1),E=i.useRef(null),ie=()=>j(!u),ne=()=>{K(),k("/admin/login")},C=t=>c.pathname===t||c.pathname.startsWith(t+"/"),re=t=>{Q(t),h(!1)};i.useEffect(()=>{const t=s=>{s.key==="Escape"&&(l?h(!1):u&&j(!1))};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[l,u]),i.useEffect(()=>{const t=s=>{E.current&&!E.current.contains(s.target)&&h(!1)};if(l)return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[l]);const x=b==="all"?o:o.filter(t=>t.clientId===b);i.useEffect(()=>{l&&console.warn("[AdminLayout] Site selector opened:",{showClientFilter:b,sitesCount:o.length,filteredSitesCount:x.length,sites:o.map(t=>({id:t.id,name:t.name,clientId:t.clientId})),filteredSites:x.map(t=>({id:t.id,name:t.name,clientId:t.clientId}))})},[l,o,x,b]);const oe=[...$,...P,...R,...M];return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[u&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 z-40 lg:hidden",onClick:()=>j(!1)}),e.jsx("aside",{"aria-label":"Admin navigation",className:`fixed inset-y-0 left-0 z-50 w-64 bg-[#1B2A5E] transform transition-transform duration-300 ease-in-out lg:translate-x-0 ${u?"translate-x-0":"-translate-x-full"}`,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:Le,alt:"HALO Logo",className:"h-8 w-auto object-contain",style:{filter:"brightness(0) invert(1)"}}),e.jsx("span",{className:"text-white text-sm font-semibold",children:"Admin"})]}),e.jsx("button",{onClick:()=>j(!1),className:"lg:hidden text-white hover:text-white/80 transition-colors","aria-label":"Close sidebar",children:e.jsx(ce,{className:"w-6 h-6"})})]}),e.jsxs("nav",{className:"flex-1 px-3 py-4 overflow-y-auto",children:[n?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>ee(!w),className:"w-full flex items-center justify-between px-4 mb-2 hover:bg-white/5 rounded-lg py-2 transition-colors group","aria-expanded":w,children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wider",children:"Site Settings"}),w?e.jsx(f,{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors"}):e.jsx(S,{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors"})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${w?"max-h-[500px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("nav",{className:"px-2 space-y-1 mb-4",children:M.map(t=>{const s=C(t.href);return e.jsxs(g,{to:t.href,"aria-current":s?"page":void 0,className:`flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-[#1B2A5E] ${s?"bg-[#D91C81] text-white":"text-white hover:bg-white/10"}`,children:[e.jsx(t.icon,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t.name})]},t.name)})})}),e.jsx("div",{className:"my-3 border-t border-white/10"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 mb-4 bg-[#D91C81]/20 rounded-lg border border-[#D91C81]/30",children:[e.jsx("p",{className:"text-xs font-semibold text-white mb-1",children:"No Site Selected"}),e.jsx("p",{className:"text-xs text-white/80",children:'Click "Select Site" in the top-right to choose a site and access site-specific settings.'})]}),e.jsx("div",{className:"my-3 border-t border-white/10"})]}),e.jsxs("button",{onClick:()=>te(!v),className:"w-full flex items-center justify-between px-4 mb-2 hover:bg-white/5 rounded-lg py-2 transition-colors group","aria-expanded":v,children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wider",children:"Client Settings"}),a&&e.jsx("span",{className:"text-xs text-white/60 mt-0.5 normal-case",children:a.name})]}),v?e.jsx(f,{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors"}):e.jsx(S,{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors"})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${v?"max-h-[500px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("nav",{className:"px-2 space-y-1 mb-4",children:$.map(t=>{const s=t.name==="Client Settings"&&a?`/admin/clients/${a.id}`:t.href;let r;return t.name==="All Clients"?r=c.pathname==="/admin/clients":t.name==="Client Settings"?r=/^\/admin\/clients\/[^/]+/.test(c.pathname):r=C(s),e.jsxs(g,{to:s,"aria-current":r?"page":void 0,className:`flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-[#1B2A5E] ${r?"bg-[#D91C81] text-white":"text-white hover:bg-white/10"}`,children:[e.jsx(t.icon,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t.name})]},t.name)})})}),e.jsx("div",{className:"my-3 border-t border-white/10"}),e.jsxs("button",{onClick:()=>se(!N),className:"w-full flex items-center justify-between px-4 mb-2 hover:bg-white/5 rounded-lg py-2 transition-colors group","aria-expanded":N,children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wider",children:"Global Settings"}),N?e.jsx(f,{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors"}):e.jsx(S,{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors"})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${N?"max-h-[800px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("nav",{className:"px-2 space-y-1 mb-4",children:P.map(t=>{const s=C(t.href);return e.jsxs(g,{to:t.href,"aria-current":s?"page":void 0,className:`flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-[#1B2A5E] ${s?"bg-[#D91C81] text-white":"text-white hover:bg-white/10"}`,children:[e.jsx(t.icon,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t.name})]},t.name)})})}),e.jsx("div",{className:"my-3 border-t border-white/10"}),e.jsxs("button",{onClick:()=>ae(!y),className:"w-full flex items-center justify-between px-4 mb-2 hover:bg-white/5 rounded-lg py-2 transition-colors group","aria-expanded":y,children:[e.jsxs("h3",{className:"text-xs font-semibold text-white uppercase tracking-wider flex items-center gap-2",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),"Developer Tools"]}),y?e.jsx(f,{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors"}):e.jsx(S,{className:"w-4 h-4 text-white/60 group-hover:text-white transition-colors"})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${y?"max-h-[500px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("nav",{className:"px-2 space-y-1 mb-4",children:R.map(t=>{const s=C(t.href);return e.jsxs(g,{to:t.href,"aria-current":s?"page":void 0,className:`flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-[#1B2A5E] ${s?"bg-[#D91C81] text-white":"text-white hover:bg-white/10"}`,children:[e.jsx(t.icon,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:t.name})]},t.name)})})})]}),e.jsx("div",{className:"px-6 py-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-[#D91C81] rounded-full flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium text-sm truncate",children:d==null?void 0:d.username}),e.jsx("p",{className:"text-white/60 text-xs capitalize",children:d==null?void 0:d.role.replace("_"," ")})]})]})}),e.jsx("div",{className:"p-3 border-t border-white/10",children:e.jsxs("button",{onClick:ne,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Logout"})]})})]})}),e.jsxs("div",{className:"lg:pl-64",children:[e.jsxs("header",{className:"sticky top-0 z-30 bg-white border-b border-gray-200 h-16 flex items-center px-4 lg:px-8",children:[e.jsx("button",{onClick:ie,className:"lg:hidden mr-4 text-gray-600 hover:text-gray-900 transition-colors","aria-label":"Open sidebar",children:e.jsx(me,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:((O=oe.find(t=>t.href===c.pathname))==null?void 0:O.name)||"Admin Panel"}),e.jsx(ue,{variant:"header"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative",ref:E,children:[e.jsx("button",{onClick:()=>h(!l),"aria-label":"Select site","aria-expanded":l,"aria-haspopup":"listbox",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#D91C81] to-[#B71569] text-white rounded-lg hover:shadow-lg transition-all focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:ring-offset-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-semibold hidden sm:inline",children:"Loading..."})]}):n&&a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center bg-white text-xs font-bold",style:{color:((T=n.branding)==null?void 0:T.primaryColor)||"#D91C81"},"aria-hidden":"true",children:(F=a==null?void 0:a.name)==null?void 0:F.substring(0,2).toUpperCase()}),e.jsxs("div",{className:"hidden sm:flex flex-col items-start",children:[e.jsx("span",{className:"text-xs font-medium opacity-90",children:a==null?void 0:a.name}),e.jsx("span",{className:"text-sm font-bold",children:n==null?void 0:n.name})]}),e.jsx(f,{className:"w-4 h-4 ml-1","aria-hidden":"true"})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-semibold hidden sm:inline",children:"Select Site"}),e.jsx(f,{className:"w-4 h-4","aria-hidden":"true"})]})}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>h(!1),"aria-hidden":"true"}),e.jsxs("div",{role:"listbox","aria-label":"Available sites",className:"absolute right-0 mt-2 w-96 bg-white border border-gray-200 rounded-lg shadow-xl z-50 max-h-[32rem] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gradient-to-r from-[#D91C81] to-[#B71569]",children:[e.jsx("p",{className:"text-sm font-bold text-white",children:"Site Selection"}),e.jsx("p",{className:"text-xs text-white/80 mt-1",children:"Choose a client and site to manage"})]}),m.length>0&&e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[e.jsx("label",{htmlFor:"client-filter",className:"block text-xs font-semibold text-gray-700 mb-2",children:"Filter by Client"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{id:"client-filter",value:b,onChange:t=>Z(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 transition-all outline-none",children:[e.jsxs("option",{value:"all",children:["All Clients (",m.length,")"]}),m.map(t=>{const s=o.filter(r=>r.clientId===t.id).length;return e.jsxs("option",{value:t.id,children:[t.name," (",s," ",s===1?"site":"sites",")"]},t.id)})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[e.jsxs("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs",children:[e.jsx("strong",{children:"Debug:"})," isLoading=",String(p),", sites.length=",o.length,", filteredSites.length=",x.length]}),p?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-[#D91C81] border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Loading sites..."})]}):x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"No sites available"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-3",children:"Create a site or seed test data"}),e.jsxs(g,{to:"/admin/developer-tools",className:"inline-flex items-center gap-2 text-xs px-3 py-1.5 bg-[#D91C81] text-white rounded-lg hover:bg-[#B01669] transition-colors",children:[e.jsx(X,{className:"w-3 h-3"}),"Seed Test Data"]})]}):e.jsx("div",{className:"space-y-1",children:x.map(t=>{var G;const s=V(t.clientId),r=(n==null?void 0:n.id)===t.id;return e.jsxs("button",{role:"option","aria-selected":r,onClick:()=>re(t),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:ring-inset ${r?"bg-gradient-to-r from-pink-50 to-purple-50 border-2 border-[#D91C81] shadow-sm":"hover:bg-gray-50 border-2 border-transparent"}`,children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold flex-shrink-0 shadow-sm",style:{backgroundColor:(G=t==null?void 0:t.branding)==null?void 0:G.primaryColor},"aria-hidden":"true",children:s?s.name.substring(0,2).toUpperCase():"NA"}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("p",{className:"font-bold text-gray-900 text-sm truncate",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:(s==null?void 0:s.name)||"Unknown Client"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${t.status==="active"?"bg-green-100 text-green-700":t.status==="inactive"?"bg-gray-100 text-gray-700":"bg-yellow-100 text-yellow-700"}`,children:t.status}),e.jsx("span",{className:"text-xs text-gray-500",children:t.domain})]})]}),r&&e.jsx("div",{className:"w-2 h-2 bg-[#D91C81] rounded-full animate-pulse","aria-label":"Currently selected"})]},t.id)})})]}),e.jsx("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:e.jsxs(g,{to:"/admin/sites",onClick:()=>h(!1),className:"flex items-center justify-center gap-2 w-full p-2.5 text-sm font-bold text-white bg-gradient-to-r from-[#D91C81] to-[#B71569] hover:shadow-lg rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-[#D91C81] focus:ring-offset-2",children:[e.jsx(D,{className:"w-4 h-4","aria-hidden":"true"}),"Manage All Sites"]})})]})]})]})})]})]}),e.jsx("main",{className:"p-4 lg:p-8",children:e.jsx(i.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(he,{})})})]})]})}function Ve(){const{isAdminAuthenticated:c,isLoading:k}=U();return W(),z(),k?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#1B2A5E] via-[#D91C81] to-[#00B4CC] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ae,{className:"w-12 h-12 animate-spin text-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-lg",children:"Loading..."})]})}):c?e.jsx(fe,{children:e.jsx(ge,{children:e.jsx(pe,{children:e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-[#D91C81] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading..."})]})}),children:e.jsx(ke,{})})})})}):e.jsx(xe,{to:"/admin/login",replace:!0})}export{Ve as AdminLayoutWrapper};
