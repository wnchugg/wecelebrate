import{r as o,a6 as u,l as k,j as e,a7 as x,C as p,t as i}from"./index-dV4Uttrq.js";import{C as d,d as h}from"./card-DtXIWsGG.js";import{I as l}from"./input-DElxXLEL.js";import{L as t}from"./label-Cx_2PmZF.js";import{S as m}from"./switch-CBDky-vy.js";import{B as T}from"./badge-hStN7-Ju.js";import{S as O}from"./server-CYiQ0EKI.js";import{T as I}from"./test-tube-qU13kJii.js";import{C as D}from"./circle-check-big-BTbhA0uw.js";import{C as E}from"./circle-x-CrdKUO8e.js";import{F as $}from"./folder-open-8EvxzsP3.js";import{C as q}from"./clock-B-jNmjCX.js";import{S as M}from"./save-D7hvH_Dw.js";function z({client:c,onConfigUpdated:f}){const[s,r]=o.useState({clientId:c.id,enabled:!1,host:"",port:22,username:"",authMethod:"password",remotePath:"/employee-data",filePattern:"employees-*.csv",schedule:{enabled:!1,frequency:"daily",time:"02:00"},processing:{archivePath:"/employee-data/archive",deleteAfterImport:!1,notifyOnSuccess:!0,notifyOnFailure:!0},status:"inactive"}),[S,j]=o.useState(!0),[y,v]=o.useState(!1),[b,N]=o.useState(!1),[n,g]=o.useState(null);o.useEffect(()=>{C()},[c.id]);const C=async()=>{j(!0);try{const a=await u(`/clients/${c.id}/sftp-config`);a.config&&r(a.config)}catch{k.log("No SFTP config found, using defaults")}finally{j(!1)}},w=async()=>{try{v(!0),await u(`/erp/connections/${c.id}/sftp-config`,{method:"PUT",body:JSON.stringify(s)}),i.success("SFTP configuration saved successfully"),f(),C()}catch(a){i.error(`Failed to save configuration: ${a instanceof Error?a.message:"Unknown error"}`)}finally{v(!1)}},F=async()=>{try{N(!0),g(null);const a=await u(`/erp/connections/${c.id}/sftp-test`,{method:"POST"});g(a),a.success?i.success("SFTP connection successful!"):i.error(`Connection failed: ${a.message}`)}catch(a){g({success:!1,message:a instanceof Error?a.message:"Unknown error"}),i.error(`Test failed: ${a instanceof Error?a.message:"Unknown error"}`)}finally{N(!1)}},P=async()=>{try{i.info("Starting SFTP sync..."),await u(`/erp/connections/${c.id}/sync`,{method:"POST",body:JSON.stringify({method:"sftp"})}),f()}catch(a){i.error(`Sync failed: ${a instanceof Error?a.message:"Unknown error"}`)}};return S?e.jsx(d,{children:e.jsxs(h,{className:"p-12 text-center",children:[e.jsx(x,{className:"w-8 h-8 animate-spin text-[#D91C81] mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading configuration..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(d,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"w-6 h-6 text-[#D91C81] mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"SFTP Automated Import"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure automated employee data imports from your SFTP server"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{checked:s.enabled,onCheckedChange:a=>r({...s,enabled:a})}),e.jsx(T,{className:s.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.enabled?"Enabled":"Disabled"})]})]})})}),e.jsx(d,{children:e.jsxs(h,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Connection Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"host",children:"SFTP Host"}),e.jsx(l,{id:"host",value:s.host,onChange:a=>r({...s,host:a.target.value}),placeholder:"sftp.example.com"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"port",children:"Port"}),e.jsx(l,{id:"port",type:"number",value:s.port,onChange:a=>r({...s,port:parseInt(a.target.value)||22})})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"username",children:"Username"}),e.jsx(l,{id:"username",value:s.username,onChange:a=>r({...s,username:a.target.value}),placeholder:"sftp-user"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"authMethod",children:"Authentication Method"}),e.jsxs("select",{id:"authMethod",value:s.authMethod,onChange:a=>r({...s,authMethod:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"password",children:"Password"}),e.jsx("option",{value:"key",children:"Private Key"})]})]}),s.authMethod==="password"?e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(t,{htmlFor:"password",children:"Password"}),e.jsx(l,{id:"password",type:"password",value:s.password||"",onChange:a=>r({...s,password:a.target.value}),placeholder:"••••••••"})]}):e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(t,{htmlFor:"privateKey",children:"Private Key"}),e.jsx("textarea",{id:"privateKey",value:s.privateKey||"",onChange:a=>r({...s,privateKey:a.target.value}),placeholder:"-----BEGIN RSA PRIVATE KEY-----",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none font-mono text-sm",rows:6})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(p,{onClick:F,variant:"outline",disabled:b||!s.host||!s.username,className:"gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 animate-spin"}),"Testing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4"}),"Test Connection"]})})}),n&&e.jsxs("div",{className:`mt-4 p-4 rounded-lg flex items-start gap-3 ${n.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[n.success?e.jsx(D,{className:"w-5 h-5 text-green-600 mt-0.5"}):e.jsx(E,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${n.success?"text-green-900":"text-red-900"}`,children:n.success?"Connection Successful":"Connection Failed"}),e.jsx("p",{className:`text-xs mt-1 ${n.success?"text-green-700":"text-red-700"}`,children:n.message})]})]})]})}),e.jsx(d,{children:e.jsxs(h,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"File Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"remotePath",children:"Remote Path"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(l,{id:"remotePath",value:s.remotePath,onChange:a=>r({...s,remotePath:a.target.value}),placeholder:"/employee-data",className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"filePattern",children:"File Pattern"}),e.jsx(l,{id:"filePattern",value:s.filePattern,onChange:a=>r({...s,filePattern:a.target.value}),placeholder:"employees-*.csv"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Use * as wildcard (e.g., employees-*.csv)"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"archivePath",children:"Archive Path"}),e.jsx(l,{id:"archivePath",value:s.processing.archivePath,onChange:a=>r({...s,processing:{...s.processing,archivePath:a.target.value}}),placeholder:"/employee-data/archive"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx(m,{checked:s.processing.deleteAfterImport,onCheckedChange:a=>r({...s,processing:{...s.processing,deleteAfterImport:a}})}),e.jsx(t,{children:"Delete files after import"})]})]})]})}),e.jsx(d,{children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Sync Schedule"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{checked:s.schedule.enabled,onCheckedChange:a=>r({...s,schedule:{...s.schedule,enabled:a}})}),e.jsx("span",{className:"text-sm text-gray-600",children:s.schedule.enabled?"Enabled":"Disabled"})]})]}),s.schedule.enabled&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"frequency",children:"Frequency"}),e.jsxs("select",{id:"frequency",value:s.schedule.frequency,onChange:a=>r({...s,schedule:{...s.schedule,frequency:a.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]}),s.schedule.frequency!=="hourly"&&e.jsxs("div",{children:[e.jsx(t,{htmlFor:"time",children:"Time"}),e.jsx(l,{id:"time",type:"time",value:s.schedule.time||"",onChange:a=>r({...s,schedule:{...s.schedule,time:a.target.value}})})]}),s.schedule.frequency==="weekly"&&e.jsxs("div",{children:[e.jsx(t,{htmlFor:"dayOfWeek",children:"Day of Week"}),e.jsxs("select",{id:"dayOfWeek",value:s.schedule.dayOfWeek||1,onChange:a=>r({...s,schedule:{...s.schedule,dayOfWeek:parseInt(a.target.value)}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:border-[#D91C81] focus:ring-2 focus:ring-pink-100 outline-none",children:[e.jsx("option",{value:1,children:"Monday"}),e.jsx("option",{value:2,children:"Tuesday"}),e.jsx("option",{value:3,children:"Wednesday"}),e.jsx("option",{value:4,children:"Thursday"}),e.jsx("option",{value:5,children:"Friday"}),e.jsx("option",{value:6,children:"Saturday"}),e.jsx("option",{value:0,children:"Sunday"})]})]})]}),s.lastSync&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-900",children:["Last sync: ",new Date(s.lastSync).toLocaleString()]})]})]})}),e.jsx(d,{children:e.jsxs(h,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Notifications"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t,{children:"Notify on successful sync"}),e.jsx(m,{checked:s.processing.notifyOnSuccess,onCheckedChange:a=>r({...s,processing:{...s.processing,notifyOnSuccess:a}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t,{children:"Notify on sync failure"}),e.jsx(m,{checked:s.processing.notifyOnFailure,onCheckedChange:a=>r({...s,processing:{...s.processing,notifyOnFailure:a}})})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(p,{onClick:w,disabled:y,className:"bg-[#D91C81] hover:bg-[#B01669] text-white",children:y?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Save Configuration"]})}),e.jsxs(p,{onClick:P,variant:"outline",disabled:!s.enabled||!(n!=null&&n.success),children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Run Manual Sync"]})]})]})}export{z as S};
