import{m as b,r as h,p as w,w as i,l,j as t}from"./index-DHDOl0g2.js";import{C as j}from"./circle-alert-HchCeVzY.js";import{C as v}from"./circle-check-big-BYmGA9PQ.js";import{L as C}from"./loader-circle-CxhB-7Ws.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],N=b("wifi-off",S);function B({showQuickFix:n=!0}){const[s,a]=h.useState({status:"checking",message:"Checking backend connection..."}),[c,r]=h.useState(!1);h.useEffect(()=>{u()},[]);const u=async()=>{const k="https://wjfcqqrlhwdvvjmefxky.supabase.co/functions/v1/make-server-6fcaeea3/health";try{const o=new AbortController,m=setTimeout(()=>o.abort(),1e4),e=await fetch(k,{method:"GET",headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"},signal:o.signal});if(clearTimeout(m),e.ok){let d;const g=await e.text();try{d=JSON.parse(g)}catch{d={message:g}}a({status:"connected",message:"Backend is online",details:`Connected to https://wjfcqqrlhwdvvjmefxky.supabase.co environment (Project: ${i})`})}else if(e.status===404)l.warn("[Connection Check] Edge Function not found (404) - Backend not deployed"),a({status:"disconnected",message:"Backend Edge Function not deployed",details:`The Edge Function 'make-server-6fcaeea3' is not deployed to project ${i}. Deploy it from the Supabase dashboard.`});else if(e.status===401||e.status===403)l.info("[Connection Check] ℹ️ Backend not yet deployed - This is expected for new projects"),a({status:"disconnected",message:"Backend Edge Function not deployed",details:`Received ${e.status} error. This typically means the Edge Function 'make-server-6fcaeea3' is not deployed to project ${i}. Please deploy it to continue.`});else{l.error("[Connection Check] Failed:",e.status,e.statusText);const d=await e.text().catch(()=>"");a({status:"error",message:"Backend responded with an error",details:`Status: ${e.status} - ${e.statusText}${d?`
${d}`:""}`})}}catch(o){const m=o instanceof Error?o.message:String(o);if(m.includes("fetch")||m.includes("Failed to fetch")){l.log("[Backend] Not deployed yet (expected for new environments)"),a({status:"disconnected",message:"Cannot reach backend server",details:`Failed to connect to project ${i}. The Edge Function 'make-server-6fcaeea3' may not be deployed, or there may be a network issue.`});return}l.error("[Connection Check] Unexpected error:",o);const e=o instanceof Error?o:null;(e==null?void 0:e.name)==="AbortError"?a({status:"error",message:"Connection timeout",details:`The backend server at ${i}.supabase.co did not respond within 10 seconds. The Edge Function may not be deployed.`}):e!=null&&e.message.includes("fetch")||e!=null&&e.message.includes("Failed to fetch")?a({status:"disconnected",message:"Cannot reach backend server",details:`Failed to connect to project ${i}. The Edge Function 'make-server-6fcaeea3' may not be deployed, or there may be a network issue.`}):a({status:"error",message:"Connection failed",details:(e==null?void 0:e.message)||String(o)})}},p=()=>{switch(s.status){case"checking":return t.jsx(C,{className:"w-4 h-4 animate-spin text-blue-600"});case"connected":return t.jsx(v,{className:"w-4 h-4 text-green-600"});case"disconnected":return t.jsx(N,{className:"w-4 h-4 text-red-600"});case"error":return t.jsx(j,{className:"w-4 h-4 text-amber-600"})}},f=()=>{switch(s.status){case"checking":return"border-blue-200 bg-blue-50";case"connected":return"border-green-200 bg-green-50";case"disconnected":return"border-red-200 bg-red-50";case"error":return"border-amber-200 bg-amber-50"}},y=()=>{switch(s.status){case"checking":return"text-blue-900";case"connected":return"text-green-900";case"disconnected":return"text-red-900";case"error":return"text-amber-900"}};return s.status==="connected"?null:t.jsx("div",{className:`mt-4 p-4 border rounded-xl ${f()}`,children:t.jsxs("div",{className:"flex items-start gap-3",children:[p(),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:`text-sm font-semibold ${y()}`,children:s.message}),s.details&&t.jsx("p",{className:"text-xs mt-1 text-gray-700",children:s.details}),s.status==="disconnected"&&t.jsxs("div",{className:"mt-3 space-y-2",children:[t.jsx("p",{className:"text-xs font-semibold text-gray-800",children:"Troubleshooting:"}),t.jsxs("ul",{className:"text-xs text-gray-700 space-y-1 list-disc list-inside",children:[t.jsx("li",{children:"Ensure the Supabase Edge Function is deployed"}),t.jsxs("li",{children:["Check that the function name is correct: ",t.jsx("code",{className:"bg-white px-1 rounded",children:"make-server-6fcaeea3"})]}),t.jsx("li",{children:"Verify your network connection"}),t.jsx("li",{children:"Check browser console for detailed error messages"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:u,className:"text-xs font-medium text-blue-600 hover:text-blue-700 underline",children:"Retry Connection"}),t.jsxs("button",{onClick:()=>r(!c),className:"text-xs font-medium text-green-600 hover:text-green-700 underline",children:[c?"Hide":"Show"," Deployment Guide"]})]})]}),s.status==="error"&&t.jsxs("div",{className:"flex gap-2 mt-2",children:[t.jsx("button",{onClick:u,className:"text-xs font-medium text-amber-700 hover:text-amber-800 underline",children:"Retry Connection"}),t.jsxs("button",{onClick:()=>r(!c),className:"text-xs font-medium text-green-600 hover:text-green-700 underline",children:[c?"Hide":"Show"," Deployment Guide"]})]})]})]})})}function M(n,s=1e4){return typeof n!="string"?"":n.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").replace(/data:text\/html/gi,"").trim().slice(0,s)}function R(n){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(n)&&n.length<=254}const x=new Map;function z(n,s,a){const c=Date.now();let r=x.get(n);return(!r||r.resetAt<c)&&(r={count:0,resetAt:c+a},x.set(n,r)),r.count++,r.count>s?{allowed:!1,retryAfter:Math.ceil((r.resetAt-c)/1e3)}:{allowed:!0}}function D(n){x.delete(n)}function I(n){try{const s=JSON.parse(sessionStorage.getItem("security_events")||"[]");s.push({...n,timestamp:new Date().toISOString()}),s.length>50&&s.shift(),sessionStorage.setItem("security_events",JSON.stringify(s))}catch(s){console.error("Failed to store security event:",s)}}export{B,D as a,z as c,I as l,M as s,R as v};
