import{u as Q,r as l,a4 as f,l as S,j as e,C,n as V}from"./index-C7jV57L-.js";import{C as o,d as c,a as p,b as j}from"./card-CQ5EBDNi.js";import{s as k,a as Z}from"./errorHandling-CC0wokWx.js";import{D as ee}from"./download-CjwDppVi.js";import{C as M}from"./calendar-Gocszv99.js";import{P as se}from"./party-popper-D0UPN4B9.js";import{A as O}from"./award-BhyZFrHN.js";import{T as L}from"./trending-up-PJ1wCr55.js";import{C as te}from"./clock-IpOWLfyH.js";import{R as v,a as ae,T as N,C as w,X as D,Y as R,B as F,b as U}from"./BarChart-CBJ-UCHa.js";import{P as re,a as ne}from"./PieChart-BROdSFqg.js";import{A as le}from"./AreaChart-DJBq5_wH.js";import{A as ie}from"./Area-C7dfnEwS.js";const g={primary:"#D91C81",secondary:"#1B2A5E",tertiary:"#00B4CC",success:"#10B981",warning:"#F59E0B",purple:"#8B5CF6",indigo:"#6366F1",emerald:"#10B981",rose:"#F43F5E",amber:"#F59E0B"};function Ce(){const I=Q(),[x,P]=l.useState([]),[A,$]=l.useState([]),[oe,K]=l.useState([]),[ce,Y]=l.useState([]),[z,T]=l.useState(!0),[h,_]=l.useState("90");l.useEffect(()=>{G()},[]);const G=async()=>{T(!0);try{const[s,t,a,r]=await Promise.all([f("/celebrations").catch(()=>({data:[]})),f("/orders").catch(()=>({data:[]})),f("/employees").catch(()=>({data:[]})),f("/clients").catch(()=>({data:[]}))]);P(s.data||[]),$(t.data||[]),K(a.data||[]),Y(r.data||[])}catch(s){k("Failed to load celebration analytics",s instanceof Error?s.message:"Unknown error"),S.error("Failed to load celebration analytics",s)}finally{T(!1)}},d=l.useMemo(()=>{if(h==="all")return x;const s=new Date,t=parseInt(h),a=new Date(s.getTime()-t*24*60*60*1e3);return x.filter(r=>new Date(r.date)>=a)},[x,h]),n=l.useMemo(()=>{const s=d.length,t=d.filter(m=>m.status==="active").length,a={};d.forEach(m=>{a[m.type]=(a[m.type]||0)+1});const r=d.filter(m=>A.some(b=>{var E;return((E=b.metadata)==null?void 0:E.celebrationId)===m.id})).length,i=s>0?r/s*100:0,B=new Date,X=new Date(B.getTime()+720*60*60*1e3),q=x.filter(m=>{const b=new Date(m.date);return b>=B&&b<=X&&m.status==="active"}).length;return{totalCelebrations:s,activeCelebrations:t,typeBreakdown:a,conversionRate:i,upcomingCelebrations:q,celebrationsWithOrders:r}},[d,A,x]),y=l.useMemo(()=>Object.entries(n.typeBreakdown).map(([s,t],a)=>({name:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),value:t,fill:Object.values(g)[a%Object.values(g).length]})).sort((s,t)=>t.value-s.value),[n.typeBreakdown]),u=l.useMemo(()=>{const s={};return d.forEach(t=>{const a=new Date(t.date).toLocaleDateString("en-US",{year:"numeric",month:"short"});s[a]=(s[a]||0)+1}),Object.entries(s).map(([t,a])=>({month:t,celebrations:a})).sort((t,a)=>new Date(t.month).getTime()-new Date(a.month).getTime()).slice(-12)},[d]),J=l.useMemo(()=>{const s={};return x.forEach(a=>{const r=new Date(a.date).toLocaleDateString("en-US",{month:"long"});s[r]=(s[r]||0)+1}),["January","February","March","April","May","June","July","August","September","October","November","December"].map(a=>({month:a.substring(0,3),count:s[a]||0}))},[x]),H=l.useMemo(()=>{const s={};return d.forEach(t=>{var a;if(t.type.includes("anniversary")||t.type.includes("year")){const r=((a=t.metadata)==null?void 0:a.years)||"Unknown",i=`${r} Year${r!==1?"s":""}`;s[i]=(s[i]||0)+1}}),Object.entries(s).map(([t,a])=>({milestone:t,count:a})).sort((t,a)=>{const r=parseInt(t.milestone),i=parseInt(a.milestone);return r-i}).slice(0,10)},[d]),W=()=>{try{const s=[["Celebration Analytics Report"],[`Generated: ${new Date().toLocaleString()}`],[`Date Range: Last ${h} days`],[],["SUMMARY METRICS"],["Total Celebrations",n.totalCelebrations],["Active Celebrations",n.activeCelebrations],["Upcoming (30 days)",n.upcomingCelebrations],["Conversion Rate",`${n.conversionRate.toFixed(1)}%`],[],["CELEBRATIONS BY TYPE"],...y.map(i=>[i.name,i.value])].map(i=>i.join(",")).join(`
`),t=new Blob([s],{type:"text/csv"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`Celebration_Analytics_${new Date().toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(a),Z("Report exported successfully")}catch(s){const t=s instanceof Error?s.message:"Unknown error";k("Failed to export report",t),S.error("Failed to export report",s)}};return z?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D91C81] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading celebration analytics..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>I("/admin/reports"),className:"gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Celebration Analytics"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Anniversary celebrations and award recognition insights"})]})]}),e.jsxs(C,{onClick:W,className:"bg-[#D91C81] hover:bg-[#B01669] text-white gap-2",size:"sm",children:[e.jsx(ee,{className:"w-4 h-4"}),"Export Report"]})]}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Date Range:"})]}),e.jsx("div",{className:"flex gap-2",children:["30","90","180","365","all"].map(s=>e.jsx(C,{size:"sm",variant:h===s?"default":"outline",onClick:()=>_(s),className:h===s?"bg-[#D91C81] hover:bg-[#B01669]":"",children:s==="all"?"All Time":`${s} Days`},s))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-[#D91C81]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Celebrations"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalCelebrations})]})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-[#1B2A5E]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.activeCelebrations})]})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Conversion Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[n.conversionRate.toFixed(1),"%"]})]})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Upcoming (30 days)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.upcomingCelebrations})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Celebrations by Type"})}),e.jsx(c,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(re,{children:[e.jsx(ne,{data:y,cx:"50%",cy:"50%",labelLine:!1,label:s=>`${s.name}: ${s.value}`,outerRadius:100,dataKey:"value",children:y.map((s,t)=>e.jsx(ae,{fill:s.fill},`cell-${t}`))}),e.jsx(N,{})]})})})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Celebration Trend (12 Months)"})}),e.jsx(c,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(le,{data:u,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"month"}),e.jsx(R,{}),e.jsx(N,{}),e.jsx(ie,{type:"monotone",dataKey:"celebrations",stroke:g.primary,fill:g.primary,fillOpacity:.3})]})})})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Celebrations by Calendar Month"})}),e.jsx(c,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(F,{data:J,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"month"}),e.jsx(R,{}),e.jsx(N,{}),e.jsx(U,{dataKey:"count",fill:g.tertiary})]})})})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Anniversary Milestones"})}),e.jsx(c,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(F,{data:H,layout:"vertical",children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(D,{type:"number"}),e.jsx(R,{dataKey:"milestone",type:"category",width:80}),e.jsx(N,{}),e.jsx(U,{dataKey:"count",fill:g.purple})]})})})]})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Celebration Type Summary"})}),e.jsx(c,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",style:{borderLeftWidth:"4px",borderLeftColor:s.fill},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(s.value/n.totalCelebrations*100).toFixed(1),"% of total"]})]}),e.jsx("p",{className:"text-2xl font-bold",style:{color:s.fill},children:s.value})]},t))})})]}),e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(j,{children:"Key Insights"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 rounded-lg",children:[e.jsx(O,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Recognition Impact"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n.conversionRate.toFixed(1),"% of celebrations result in gift orders, showing strong engagement with the recognition program."]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-green-50 rounded-lg",children:[e.jsx(M,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Upcoming Opportunities"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n.upcomingCelebrations," celebrations scheduled in the next 30 days. Plan ahead for gift fulfillment and personalization."]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-purple-50 rounded-lg",children:[e.jsx(L,{className:"w-5 h-5 text-purple-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Program Growth"}),e.jsx("p",{className:"text-sm text-gray-600",children:u.length>1&&u[u.length-1].celebrations>u[0].celebrations?"Celebration volume is trending upward, indicating growing program adoption.":"Monitor celebration trends to optimize recognition program timing and resources."})]})]})]})})]})]})}export{Ce as CelebrationAnalytics};
