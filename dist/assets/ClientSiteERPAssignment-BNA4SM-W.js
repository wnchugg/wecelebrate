import{r as l,j as e,B as S,a4 as E}from"./index-BKvtyMRF.js";import{s as g,a as P}from"./errorHandling-D_CdsDrI.js";import{C as D}from"./circle-alert-DcZKv8iA.js";import{S as N}from"./save-CKwfZUrw.js";import{M as R}from"./map-pin-C0sKjYXC.js";import{C as F}from"./circle-check-big-BvCQpXTh.js";class O{constructor(){const n="your-project-id";this.baseUrl=`https://${n}.supabase.co/functions/v1/make-server-6fcaeea3`}async getERPConnections(){try{const n=await fetch(`${this.baseUrl}/erp/connections`,{headers:{Authorization:"Bearer undefined"}});if(!n.ok)throw new Error("Failed to fetch ERP connections");return await n.json()}catch(n){return console.error("Error fetching ERP connections:",n),this.getMockERPConnections()}}async getERPConnection(n){try{const t=await fetch(`${this.baseUrl}/erp/connections/${n}`,{headers:{Authorization:"Bearer undefined"}});if(!t.ok)throw new Error("Failed to fetch ERP connection");return await t.json()}catch(t){throw console.error("Error fetching ERP connection:",t),t}}async createERPConnection(n){try{const t=await fetch(`${this.baseUrl}/erp/connections/enhanced`,{method:"POST",headers:{Authorization:"Bearer undefined","Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok){const a=await t.json().catch(()=>({}));throw new Error(a.error||"Failed to create ERP connection")}return await t.json()}catch(t){throw console.error("Error creating ERP connection:",t),t}}async updateERPConnection(n,t){try{const a=await fetch(`${this.baseUrl}/erp/connections/${n}`,{method:"PATCH",headers:{Authorization:"Bearer undefined","Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to update ERP connection");return await a.json()}catch(a){throw console.error("Error updating ERP connection:",a),a}}async deleteERPConnection(n){try{if(!(await fetch(`${this.baseUrl}/erp/connections/${n}`,{method:"DELETE",headers:{Authorization:"Bearer undefined"}})).ok)throw new Error("Failed to delete ERP connection")}catch(t){throw console.error("Error deleting ERP connection:",t),t}}async testERPConnection(n){try{const t=await fetch(`${this.baseUrl}/erp/connections/${n}/test`,{method:"POST",headers:{Authorization:"Bearer undefined"}});if(!t.ok)throw new Error("Failed to test ERP connection");return await t.json()}catch(t){return console.error("Error testing ERP connection:",t),{success:!1,message:"Connection test failed",errors:[t instanceof Error?t.message:"Unknown error"]}}}async getSyncConfigurations(n){try{const t=await fetch(`${this.baseUrl}/erp/connections/${n}/sync-configs`,{headers:{Authorization:"Bearer undefined"}});if(!t.ok)throw new Error("Failed to fetch sync configurations");return await t.json()}catch(t){return console.error("Error fetching sync configurations:",t),this.getMockSyncConfigurations()}}async createSyncConfiguration(n){try{const t=await fetch(`${this.baseUrl}/erp/sync-configs`,{method:"POST",headers:{Authorization:"Bearer undefined","Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok)throw new Error("Failed to create sync configuration");return await t.json()}catch(t){throw console.error("Error creating sync configuration:",t),t}}async updateSyncConfiguration(n,t){try{const a=await fetch(`${this.baseUrl}/erp/sync-configs/${n}`,{method:"PATCH",headers:{Authorization:"Bearer undefined","Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to update sync configuration");return await a.json()}catch(a){throw console.error("Error updating sync configuration:",a),a}}async triggerSync(n,t,a){try{const r=await fetch(`${this.baseUrl}/erp/connections/${n}/sync`,{method:"POST",headers:{Authorization:"Bearer undefined","Content-Type":"application/json"},body:JSON.stringify({dataType:t,direction:a})});if(!r.ok)throw new Error("Failed to trigger sync");return await r.json()}catch(r){throw console.error("Error triggering sync:",r),r}}async getSyncLogs(n,t,a=50){try{const r=new URLSearchParams;n&&r.append("erpConnectionId",n),t&&r.append("dataType",t),r.append("limit",a.toString());const m=await fetch(`${this.baseUrl}/erp/sync-logs?${r}`,{headers:{Authorization:"Bearer undefined"}});if(!m.ok)throw new Error("Failed to fetch sync logs");return await m.json()}catch(r){return console.error("Error fetching sync logs:",r),this.getMockSyncLogs()}}async getSyncStatistics(n){try{const t=await fetch(`${this.baseUrl}/erp/connections/${n}/statistics`,{headers:{Authorization:"Bearer undefined"}});if(!t.ok)throw new Error("Failed to fetch sync statistics");return await t.json()}catch(t){return console.error("Error fetching sync statistics:",t),{totalSyncs:0,successfulSyncs:0,failedSyncs:0,avgSyncDuration:0,totalRecordsProcessed:0}}}async getClientERPAssignments(n){try{const t=await fetch(`${this.baseUrl}/clients/${n}/erp-assignments`,{headers:{Authorization:"Bearer undefined"}});if(!t.ok)throw new Error("Failed to fetch client ERP assignments");return await t.json()}catch(t){return console.error("Error fetching client ERP assignments:",t),[]}}async assignERPToClient(n){try{const t=await fetch(`${this.baseUrl}/clients/${n.clientId}/erp-assignments`,{method:"POST",headers:{Authorization:"Bearer undefined","Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok)throw new Error("Failed to assign ERP to client");return await t.json()}catch(t){throw console.error("Error assigning ERP to client:",t),t}}async getSiteERPAssignments(n){try{const t=await fetch(`${this.baseUrl}/sites/${n}/erp-assignments`,{headers:{Authorization:"Bearer undefined"}});if(!t.ok)throw new Error("Failed to fetch site ERP assignments");return await t.json()}catch(t){return console.error("Error fetching site ERP assignments:",t),[]}}async assignERPToSite(n){try{const t=await fetch(`${this.baseUrl}/sites/${n.siteId}/erp-assignments`,{method:"POST",headers:{Authorization:"Bearer undefined","Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok)throw new Error("Failed to assign ERP to site");return await t.json()}catch(t){throw console.error("Error assigning ERP to site:",t),t}}getMockERPConnections(){return[{id:"erp_001",name:"SAP Production",provider:"SAP",connectionMethod:"api",status:"active",credentials:{apiUrl:"https://sap.example.com/api",apiKey:"***********"},settings:{timeout:3e4,retryAttempts:3,retryDelay:5e3,batchSize:100,syncSchedule:"0 */6 * * *",enabledDataTypes:["orders","products","inventory","employees"]},createdAt:"2026-01-15T10:00:00Z",updatedAt:"2026-02-12T08:30:00Z",lastSyncAt:"2026-02-12T14:00:00Z"},{id:"erp_002",name:"NetSuite Integration",provider:"NetSuite",connectionMethod:"doi",status:"active",credentials:{doiEndpoint:"https://netsuite.example.com/doi",doiUsername:"api_user"},settings:{timeout:45e3,retryAttempts:2,retryDelay:1e4,batchSize:50,enabledDataTypes:["orders","invoices"]},createdAt:"2026-01-20T09:00:00Z",updatedAt:"2026-02-10T11:15:00Z",lastSyncAt:"2026-02-12T12:00:00Z"},{id:"erp_003",name:"Legacy SFTP System",provider:"Custom",connectionMethod:"sftp",status:"active",credentials:{sftpHost:"ftp.example.com",sftpPort:22,sftpUsername:"erp_sync",sftpPath:"/data/export"},settings:{timeout:6e4,retryAttempts:3,retryDelay:15e3,syncSchedule:"0 2 * * *",enabledDataTypes:["products","inventory"]},createdAt:"2026-01-10T08:00:00Z",updatedAt:"2026-02-11T07:00:00Z",lastSyncAt:"2026-02-12T02:00:00Z"}]}getMockSyncConfigurations(){return[{id:"sync_001",erpConnectionId:"erp_001",dataType:"orders",direction:"bidirectional",schedule:"0 */2 * * *",enabled:!0,lastSyncAt:"2026-02-12T14:00:00Z",nextSyncAt:"2026-02-12T16:00:00Z",status:"idle",settings:{autoSync:!0,syncInterval:120,syncOnDemand:!0,conflictResolution:"newest_wins"}},{id:"sync_002",erpConnectionId:"erp_001",dataType:"products",direction:"pull",schedule:"0 6 * * *",enabled:!0,lastSyncAt:"2026-02-12T06:00:00Z",nextSyncAt:"2026-02-13T06:00:00Z",status:"idle",settings:{autoSync:!0,syncInterval:1440,syncOnDemand:!0,conflictResolution:"erp_wins"}}]}getMockSyncLogs(){return[{id:"log_001",erpConnectionId:"erp_001",dataType:"orders",syncConfigId:"sync_001",startedAt:"2026-02-12T14:00:00Z",completedAt:"2026-02-12T14:02:30Z",status:"success",recordsProcessed:156,recordsSuccess:156,recordsFailed:0,duration:150},{id:"log_002",erpConnectionId:"erp_001",dataType:"products",syncConfigId:"sync_002",startedAt:"2026-02-12T06:00:00Z",completedAt:"2026-02-12T06:05:15Z",status:"success",recordsProcessed:2450,recordsSuccess:2448,recordsFailed:2,errorMessage:"2 products failed validation",duration:315}]}}const y=new O;function L(){const[x,n]=l.useState([]),[t,a]=l.useState(""),[r,m]=l.useState(""),[c,u]=l.useState(null),[i,d]=l.useState(null),[k,b]=l.useState(!0),[p,f]=l.useState(!1),A=[{id:"client_001",name:"Acme Corporation"},{id:"client_002",name:"Global Retail Co"},{id:"client_003",name:"Manufacturing Inc"}],j=[{id:"site_001",name:"Acme - North America",clientId:"client_001"},{id:"site_002",name:"Acme - Europe",clientId:"client_001"},{id:"site_003",name:"Global Retail - US West",clientId:"client_002"},{id:"site_004",name:"Global Retail - US East",clientId:"client_002"},{id:"site_005",name:"Manufacturing - Plant A",clientId:"client_003"}],w=[{id:"cat_001",name:"Standard Catalog"},{id:"cat_002",name:"Premium Catalog"},{id:"cat_003",name:"Executive Catalog"}];l.useEffect(()=>{T()},[]),l.useEffect(()=>{t&&v(t)},[t]),l.useEffect(()=>{r&&C(r)},[r]);const T=async()=>{try{b(!0);const s=await y.getERPConnections();n(s.filter(o=>o.status==="active"))}catch{g("Failed to load ERP connections")}finally{b(!1)}},v=async s=>{try{const o=await y.getClientERPAssignments(s);o.length>0?u(o[0]):u({clientId:s,erpConnectionId:"",catalogId:"",isDefault:!0,settings:{syncOrders:!0,syncProducts:!0,syncInventory:!0,syncEmployees:!1,syncInvoices:!1}})}catch(o){console.error("Failed to load client assignment:",o)}},C=async s=>{try{const o=await y.getSiteERPAssignments(s),h=j.find(_=>_.id===s);o.length>0?d(o[0]):h&&d({siteId:s,clientId:h.clientId,erpConnectionId:"",catalogId:"",overridesClient:!1,settings:{syncOrders:!0,syncProducts:!0,syncInventory:!0,syncEmployees:!1,syncInvoices:!1}})}catch(o){console.error("Failed to load site assignment:",o)}},I=async()=>{if(!c||!c.erpConnectionId){g("Please select an ERP connection");return}f(!0);try{await y.assignERPToClient(c),P("Client ERP assignment saved successfully"),await v(t)}catch{g("Failed to save client assignment")}finally{f(!1)}},$=async()=>{if(!i||!i.erpConnectionId){g("Please select an ERP connection");return}f(!0);try{await y.assignERPToSite(i),P("Site ERP assignment saved successfully"),await C(r)}catch{g("Failed to save site assignment")}finally{f(!1)}};return k?e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-12 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Client & Site ERP Assignment"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure which ERP connections and catalogs each client and site uses"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(D,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"Configuration Hierarchy"}),e.jsx("p",{children:"Client-level settings apply to all sites by default. Site-level settings can override client settings when needed."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-[#D91C81] rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Client Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Default ERP for all sites"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Client *"}),e.jsxs("select",{value:t,onChange:s=>a(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose a client..."}),A.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),t&&c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ERP Connection *"}),e.jsxs("select",{value:c.erpConnectionId||"",onChange:s=>u({...c,erpConnectionId:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select ERP connection..."}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.provider,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Catalog (Optional)"}),e.jsxs("select",{value:c.catalogId||"",onChange:s=>u({...c,catalogId:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"",children:"No catalog selected"}),w.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Data Sync Settings"}),e.jsx("div",{className:"space-y-2",children:[{key:"syncOrders",label:"Sync Orders"},{key:"syncProducts",label:"Sync Products"},{key:"syncInventory",label:"Sync Inventory"},{key:"syncEmployees",label:"Sync Employees"},{key:"syncInvoices",label:"Sync Invoices"}].map(s=>{var o;return e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((o=c.settings)==null?void 0:o[s.key])||!1,onChange:h=>u({...c,settings:{...c.settings,[s.key]:h.target.checked}}),className:"h-4 w-4 text-[#D91C81] focus:ring-[#D91C81] border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.label})]},s.key)})})]}),e.jsx("button",{onClick:I,disabled:p||!c.erpConnectionId,className:"w-full px-6 py-3 bg-[#D91C81] text-white rounded-lg hover:bg-[#B91670] transition-colors flex items-center justify-center gap-2 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5"}),"Save Client Configuration"]})})]}),!t&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Select a client to configure ERP settings"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-[#E94B9E] rounded-lg flex items-center justify-center",children:e.jsx(R,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Site Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Override client settings"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Site *"}),e.jsxs("select",{value:r,onChange:s=>m(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose a site..."}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),r&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.overridesClient||!1,onChange:s=>d({...i,overridesClient:s.target.checked}),className:"mt-1 h-4 w-4 text-[#D91C81] focus:ring-[#D91C81] border-gray-300 rounded"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Override Client Settings"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Enable this to use different ERP settings for this site"})]})]})}),i.overridesClient&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ERP Connection *"}),e.jsxs("select",{value:i.erpConnectionId||"",onChange:s=>d({...i,erpConnectionId:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select ERP connection..."}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.provider,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Site Catalog (Optional)"}),e.jsxs("select",{value:i.catalogId||"",onChange:s=>d({...i,catalogId:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D91C81] focus:border-transparent",children:[e.jsx("option",{value:"",children:"No catalog selected"}),w.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Data Sync Settings"}),e.jsx("div",{className:"space-y-2",children:[{key:"syncOrders",label:"Sync Orders"},{key:"syncProducts",label:"Sync Products"},{key:"syncInventory",label:"Sync Inventory"},{key:"syncEmployees",label:"Sync Employees"},{key:"syncInvoices",label:"Sync Invoices"}].map(s=>{var o;return e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((o=i.settings)==null?void 0:o[s.key])||!1,onChange:h=>d({...i,settings:{...i.settings,[s.key]:h.target.checked}}),className:"h-4 w-4 text-[#D91C81] focus:ring-[#D91C81] border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.label})]},s.key)})})]}),e.jsx("button",{onClick:$,disabled:p||!i.erpConnectionId,className:"w-full px-6 py-3 bg-[#D91C81] text-white rounded-lg hover:bg-[#B91670] transition-colors flex items-center justify-center gap-2 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5"}),"Save Site Configuration"]})})]}),!i.overridesClient&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-900 font-medium mb-2",children:"Using Client Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This site inherits ERP configuration from its client. Enable override to customize settings for this site."})]})]}),!r&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Select a site to configure ERP settings"})]})]})]})]})}export{L as ClientSiteERPAssignment,L as default};
