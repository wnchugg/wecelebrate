import{r as c,a6 as C,l as ae,j as e,C as z,a7 as Re,B as Te}from"./index-DAep3-17.js";import{C as d,d as m,a as p,b as j}from"./card-D7HVS59i.js";import{B as O}from"./badge-CKAfVDe6.js";import{T as Ae,a as Oe,b as k,c as L}from"./tabs-0I4LxGB_.js";import{s as le,a as Ee}from"./errorHandling-61HatLcx.js";import{u as Be}from"./useDateFormat-CL4PWcmD.js";import{D as Fe}from"./download-C6Tum4sE.js";import{C as ke}from"./calendar-R6FbzVZU.js";import{D as Le}from"./dollar-sign-BM7r3IOr.js";import{S as re}from"./shopping-cart-DG0hm3TK.js";import{T as $e}from"./trending-up-Bu-Iu6q7.js";import{C as ie}from"./circle-check-big-Dewj6UrC.js";import{E as Ge}from"./eye-BXXJW7Ry.js";import{P as ce}from"./package-BYXKoKMr.js";import{G as ne}from"./gift-HtAtRCOD.js";import{U as oe}from"./users-BInxthQ2.js";import{C as Me}from"./chart-column-C_x92HgH.js";import{R as v,C as E,X as B,Y as F,T as N,B as X,b as Y,a as de}from"./BarChart-CKM6f44k.js";import{A as Pe}from"./AreaChart-DYarr4_8.js";import{A as Ke}from"./Area-DJLsZOyd.js";import{L as Ie}from"./LineChart-BB-SBSuK.js";import{L as Ue}from"./Line-BEbX1I0M.js";import{P as me,a as xe}from"./PieChart-CGY_DfTN.js";import{C as _e}from"./clock-Cklh_US9.js";import{T as Ve}from"./truck-DsTgmSsy.js";import{C as ze}from"./circle-x-BFN1fzT3.js";import"./index-BBIAgE77.js";import"./index-b2qZ5oZ4.js";import"./index-Dxauqy8w.js";import"./index-GxwXKa5n.js";import"./index-CH-6Jnw9.js";import"./index-D_kBqr1b.js";import"./index-7D9TSwIG.js";const o={primary:"#D91C81",secondary:"#1B2A5E",tertiary:"#00B4CC",success:"#10B981",warning:"#F59E0B",danger:"#EF4444",purple:"#8B5CF6",cyan:"#06B6D4",indigo:"#6366F1",emerald:"#10B981",rose:"#F43F5E",amber:"#F59E0B"},Xe={pending:o.warning,confirmed:o.indigo,processing:o.secondary,shipped:o.purple,in_transit:o.tertiary,out_for_delivery:o.cyan,delivered:o.success,cancelled:o.danger,failed:o.rose};function Es(){const{formatShortDate:q,formatDate:H}=Be(),[J,he]=c.useState([]),[w,pe]=c.useState([]),[u,je]=c.useState([]),[S,ge]=c.useState([]),[$,ue]=c.useState([]),[G,fe]=c.useState([]),[ye,W]=c.useState(!0),[f,ve]=c.useState("30"),[M,Ye]=c.useState("all"),[P,qe]=c.useState("all"),[K,He]=c.useState("all"),[Je,We]=c.useState("none");c.useEffect(()=>{Q()},[]);const Q=async()=>{W(!0);try{const[s,t,a,i,h]=await Promise.all([C("/v2/orders").catch(()=>({data:[]})),C("/admin/gifts").catch(()=>({data:[]})),C("/v2/sites").catch(()=>({data:[]})),C("/v2/clients").catch(()=>({data:[]})),C("/celebrations").catch(()=>({data:[]}))]),D=s.data||[],b=t.data||[],R=a.data||[],y=i.data||[],I=h.data||[],U=D.map(x=>{const T=R.find(r=>r.id===x.siteId),g=b.find(r=>r.id===x.giftId);return{...x,siteName:T==null?void 0:T.name,giftCategory:g==null?void 0:g.category,totalAmount:x.totalAmount||(g==null?void 0:g.price)||0}});he(U),pe(b),ge(R),ue(y),fe(I);const _=R.map(x=>C(`/employees?siteId=${x.id}`).catch(()=>({data:[]}))),V=(await Promise.all(_)).flatMap(x=>x.data||[]);je(V)}catch(s){le("Failed to load analytics data",s instanceof Error?s.message:"Unknown error"),ae.error("Failed to load analytics data",s)}finally{W(!1)}},n=c.useMemo(()=>{let s=J;if(f!=="all"){const t=new Date,a=parseInt(f),i=new Date(t.getTime()-a*24*60*60*1e3);s=s.filter(h=>new Date(h.createdAt)>=i)}if(M!=="all"){const t=S.filter(a=>a.clientId===M).map(a=>a.id);s=s.filter(a=>t.includes(a.siteId))}return P!=="all"&&(s=s.filter(t=>t.siteId===P)),K!=="all"&&(s=s.filter(t=>t.status===K)),s},[J,f,M,P,K,S]),l=c.useMemo(()=>{const s=n.reduce((r,A)=>r+(A.totalAmount||0),0),t=n.length,a=t>0?s/t:0,i={pending:n.filter(r=>r.status==="pending").length,confirmed:n.filter(r=>r.status==="confirmed").length,processing:n.filter(r=>r.status==="processing").length,shipped:n.filter(r=>["shipped","in_transit","out_for_delivery"].includes(r.status)).length,delivered:n.filter(r=>r.status==="delivered").length,cancelled:n.filter(r=>r.status==="cancelled").length,failed:n.filter(r=>r.status==="failed").length},h=i.delivered,D=t>0?h/t*100:0,b=n.filter(r=>r.status==="delivered"),R=b.length>0?b.reduce((r,A)=>{const Se=new Date(A.createdAt),De=new Date(A.updatedAt||A.createdAt);return r+(De.getTime()-Se.getTime())/(1e3*60*60*24)},0)/b.length:0,y=u.filter(r=>r.status==="active").length,I=S.filter(r=>r.status==="active").length,U=$.filter(r=>r.status==="active").length,_=w.filter(r=>r.status==="active").length,te=G.length,V=G.filter(r=>r.status==="active").length,x=new Set(n.map(r=>r.employeeEmail)).size,T=y>0?x/y*100:0,g=y>0?s/y:0;return{totalRevenue:s,totalOrders:t,avgOrderValue:a,fulfillmentRate:D,avgFulfillmentDays:R,participationRate:T,costPerEmployee:g,uniqueEmployeesOrdered:x,...i,activeEmployees:y,activeSites:I,activeClients:U,activeGifts:_,totalEmployees:u.length,totalSites:S.length,totalClients:$.length,totalGifts:w.length,totalCelebrations:te,activeCelebrations:V}},[n,u,S,$,w,G]),Z=c.useMemo(()=>{const s={};return n.forEach(t=>{s[t.status]=(s[t.status]||0)+1}),Object.entries(s).map(([t,a])=>({name:t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()),value:a,fill:Xe[t]||o.secondary}))},[n]),ee=c.useMemo(()=>{const s={},t={};return n.forEach(a=>{const i=q(a.createdAt);s[i]=(s[i]||0)+1,t[i]=(t[i]||0)+(a.totalAmount||0)}),Object.entries(s).map(([a,i])=>({date:a,orders:i,revenue:t[a]||0})).sort((a,i)=>new Date(a.date).getTime()-new Date(i.date).getTime()).slice(-14)},[n,q]),Ne=c.useMemo(()=>{const s={};return n.forEach(t=>{const a=t.giftId,i=t.giftName||a;s[a]||(s[a]={name:i,count:0,revenue:0}),s[a].count+=1,s[a].revenue+=t.totalAmount||0}),Object.values(s).sort((t,a)=>a.count-t.count).slice(0,5).map(t=>({name:t.name.length>20?t.name.substring(0,20)+"...":t.name,orders:t.count,revenue:t.revenue}))},[n]),se=c.useMemo(()=>{const s={};return w.forEach(t=>{s[t.category]=(s[t.category]||0)+1}),Object.entries(s).map(([t,a],i)=>({name:t,value:a,fill:Object.values(o)[i%Object.values(o).length]})).sort((t,a)=>a.value-t.value).slice(0,6)},[w]),be=c.useMemo(()=>{const s={};return u.forEach(t=>{const a=new Date(t.createdAt),i=H(a,{year:"numeric",month:"short"});s[i]=(s[i]||0)+1}),Object.entries(s).map(([t,a])=>({month:t,employees:a})).sort((t,a)=>new Date(t.month).getTime()-new Date(a.month).getTime()).slice(-6)},[u,H]),Ce=c.useMemo(()=>{const s={};return u.forEach(t=>{const a=t.department||"Unassigned";s[a]=(s[a]||0)+1}),Object.entries(s).map(([t,a])=>({name:t,value:a})).sort((t,a)=>a.value-t.value).slice(0,5)},[u]),we=async s=>{try{const t=[["JALA 2 Analytics Report"],[`Generated: ${new Date().toLocaleString()}`],[`Date Range: Last ${f} days${f==="all"?" (All Time)":""}`],[],["KEY METRICS"],["Total Orders",l.totalOrders],["Total Revenue",`$${l.totalRevenue.toFixed(2)}`],["Average Order Value",`$${l.avgOrderValue.toFixed(2)}`],["Fulfillment Rate",`${l.fulfillmentRate.toFixed(1)}%`],[],["ORDER STATUS"],["Pending",l.pending],["Confirmed",l.confirmed],["Processing",l.processing],["Shipped",l.shipped],["Delivered",l.delivered],["Cancelled",l.cancelled],["Failed",l.failed],[],["PLATFORM STATS"],["Total Clients",l.totalClients],["Active Clients",l.activeClients],["Total Sites",l.totalSites],["Active Sites",l.activeSites],["Total Gifts",l.totalGifts],["Active Gifts",l.activeGifts],["Total Employees",l.totalEmployees],["Active Employees",l.activeEmployees],["Total Celebrations",l.totalCelebrations],["Active Celebrations",l.activeCelebrations]].map(D=>D.join(",")).join(`
`),a=new Blob([t],{type:"text/csv"}),i=URL.createObjectURL(a),h=document.createElement("a");h.href=i,h.download=`JALA2_Analytics_Report_${new Date().toISOString().split("T")[0]}.csv`,h.click(),URL.revokeObjectURL(i),Ee("Report exported successfully")}catch(t){le("Failed to export report",t.message),ae.error("Failed to export report",t)}};return ye?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#D91C81] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Reports & Analytics"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Comprehensive insights across your platform"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:Q,className:"gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs(z,{onClick:()=>we(),className:"bg-[#D91C81] hover:bg-[#B01669] text-white gap-2",size:"sm",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Export Report"]})]})]}),e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Date Range:"})]}),e.jsx("div",{className:"flex gap-2",children:["7","30","90","180","365","all"].map(s=>e.jsx(z,{size:"sm",variant:f===s?"default":"outline",onClick:()=>ve(s),className:f===s?"bg-[#D91C81] hover:bg-[#B01669]":"",children:s==="all"?"All Time":`${s} Days`},s))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(d,{children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 text-[#D91C81]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",l.totalRevenue.toFixed(2)]})]})]})})}),e.jsx(d,{children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-[#1B2A5E]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.totalOrders})]})]})})}),e.jsx(d,{children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-cyan-100 rounded-lg flex items-center justify-center",children:e.jsx($e,{className:"w-6 h-6 text-[#00B4CC]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Order Value"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",l.avgOrderValue.toFixed(2)]})]})]})})}),e.jsx(d,{children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Fulfillment Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[l.fulfillmentRate.toFixed(1),"%"]})]})]})})})]}),e.jsxs(d,{children:[e.jsx(p,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-[#D91C81]"}),"Platform Overview"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg",children:[e.jsx(Te,{className:"w-8 h-8 text-[#D91C81] mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.activeClients}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Clients"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["of ",l.totalClients," total"]})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg",children:[e.jsx(ce,{className:"w-8 h-8 text-[#1B2A5E] mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.activeSites}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Sites"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["of ",l.totalSites," total"]})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-lg",children:[e.jsx(ne,{className:"w-8 h-8 text-[#00B4CC] mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.activeGifts}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Gifts"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["of ",l.totalGifts," total"]})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg",children:[e.jsx(oe,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.activeEmployees}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Employees"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["of ",l.totalEmployees," total"]})]})]})})]}),e.jsxs(Ae,{defaultValue:"orders",className:"space-y-4",children:[e.jsxs(Oe,{className:"grid w-full grid-cols-4",children:[e.jsxs(k,{value:"orders",className:"gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Orders"]}),e.jsxs(k,{value:"gifts",className:"gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Gifts"]}),e.jsxs(k,{value:"employees",className:"gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Employees"]}),e.jsxs(k,{value:"status",className:"gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Status"]})]}),e.jsx(L,{value:"orders",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(j,{children:"Orders Over Time"})}),e.jsx(m,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(Pe,{data:ee,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"date"}),e.jsx(F,{}),e.jsx(N,{}),e.jsx(Ke,{type:"monotone",dataKey:"orders",stroke:o.primary,fill:o.primary,fillOpacity:.3})]})})})]}),e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(j,{children:"Revenue Over Time"})}),e.jsx(m,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(Ie,{data:ee,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"date"}),e.jsx(F,{}),e.jsx(N,{formatter:s=>`$${s.toFixed(2)}`}),e.jsx(Ue,{type:"monotone",dataKey:"revenue",stroke:o.success,strokeWidth:2})]})})})]})]})}),e.jsx(L,{value:"gifts",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(j,{children:"Top 5 Gifts by Orders"})}),e.jsx(m,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(X,{data:Ne,layout:"vertical",children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(B,{type:"number"}),e.jsx(F,{dataKey:"name",type:"category",width:120}),e.jsx(N,{}),e.jsx(Y,{dataKey:"orders",fill:o.primary})]})})})]}),e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(j,{children:"Gift Category Distribution"})}),e.jsx(m,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(me,{children:[e.jsx(xe,{data:se,cx:"50%",cy:"50%",labelLine:!1,label:s=>`${s.name}: ${s.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:se.map((s,t)=>e.jsx(de,{fill:s.fill},`cell-${t}`))}),e.jsx(N,{})]})})})]})]})}),e.jsx(L,{value:"employees",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(j,{children:"Employee Growth (6 Months)"})}),e.jsx(m,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(X,{data:be,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"month"}),e.jsx(F,{}),e.jsx(N,{}),e.jsx(Y,{dataKey:"employees",fill:o.tertiary})]})})})]}),e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(j,{children:"Top 5 Departments by Size"})}),e.jsx(m,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(X,{data:Ce,layout:"vertical",children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(B,{type:"number"}),e.jsx(F,{dataKey:"name",type:"category",width:100}),e.jsx(N,{}),e.jsx(Y,{dataKey:"value",fill:o.secondary})]})})})]})]})}),e.jsx(L,{value:"status",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(j,{children:"Order Status Distribution"})}),e.jsx(m,{children:e.jsx(v,{width:"100%",height:300,children:e.jsxs(me,{children:[e.jsx(xe,{data:Z,cx:"50%",cy:"50%",labelLine:!1,label:s=>`${s.name}: ${s.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:Z.map((s,t)=>e.jsx(de,{fill:s.fill},`cell-${t}`))}),e.jsx(N,{})]})})})]}),e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(j,{children:"Order Status Breakdown"})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Pending"})]}),e.jsx(O,{className:"bg-yellow-100 text-yellow-800",children:l.pending})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Processing"})]}),e.jsx(O,{className:"bg-blue-100 text-blue-800",children:l.processing})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Shipped"})]}),e.jsx(O,{className:"bg-purple-100 text-purple-800",children:l.shipped})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Delivered"})]}),e.jsx(O,{className:"bg-green-100 text-green-800",children:l.delivered})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Cancelled"})]}),e.jsx(O,{className:"bg-red-100 text-red-800",children:l.cancelled})]})]})})]})]})})]})]})}export{Es as ReportsAnalytics};
